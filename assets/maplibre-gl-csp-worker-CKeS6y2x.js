(function(){"use strict";var ko={};var Ao;function _c(){return Ao||(Ao=1,(function(){function W(r,e,t,n){return new(t||(t=Promise))((function(i,s){function o(u){try{l(n.next(u))}catch(c){s(c)}}function a(u){try{l(n.throw(u))}catch(c){s(c)}}function l(u){var c;u.done?i(u.value):(c=u.value,c instanceof t?c:new t((function(h){h(c)}))).then(o,a)}l((n=n.apply(r,[])).next())}))}function qt(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var yi=Zt;function Zt(r,e){this.x=r,this.y=e}Zt.prototype={clone:function(){return new Zt(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,t=r.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),t=Math.sin(r),n=t*this.x+e*this.y;return this.x=e*this.x-t*this.y,this.y=n,this},_rotateAround:function(r,e){var t=Math.cos(r),n=Math.sin(r),i=e.y+n*(this.x-e.x)+t*(this.y-e.y);return this.x=e.x+t*(this.x-e.x)-n*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Zt.convert=function(r){return r instanceof Zt?r:Array.isArray(r)?new Zt(r[0],r[1]):r};var R=qt(yi),Sc=Io;function Io(r,e,t,n){this.cx=3*r,this.bx=3*(t-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=t,this.p2y=n}let mi,ln;function xr(r,e,t){return Math.min(t,Math.max(e,r))}function et(r,...e){for(const t of e)for(const n in t)r[n]=t[n];return r}function gi(r,e,t){const n={};for(const i in r)n[i]=e.call(this,r[i],i,r);return n}function vt(r){return Array.isArray(r)?r.map(vt):typeof r=="object"&&r?gi(r,vt):r}Io.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var t=r,n=0;n<8;n++){var i=this.sampleCurveX(t)-r;if(Math.abs(i)<e)return t;var s=this.sampleCurveDerivativeX(t);if(Math.abs(s)<1e-6)break;t-=i/s}var o=0,a=1;for(t=r,n=0;n<20&&(i=this.sampleCurveX(t),!(Math.abs(i-r)<e));n++)r>i?o=t:a=t,t=.5*(a-o)+o;return t},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}},new(qt(Sc))(.25,.1,.25,1);const Mo={};function Ve(r){Mo[r]||(typeof console<"u"&&console.warn(r),Mo[r]=!0)}function bt(r,e,t){return(t.y-r.y)*(e.x-r.x)>(e.y-r.y)*(t.x-r.x)}function Gt(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}function xi(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}let vr,br;class wr{constructor(e,t,n){const i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const o=new Int32Array(this.arrayBuffer);e=o[0],this.d=(t=o[1])+2*(n=o[2]);for(let l=0;l<this.d*this.d;l++){const u=o[3+l],c=o[3+l+1];i.push(u===c?null:o.subarray(u,c))}const a=o[3+i.length+1];this.keys=o.subarray(o[3+i.length],a),this.bboxes=o.subarray(a),this.insert=this._insertReadonly}else{this.d=t+2*n;for(let o=0;o<this.d*this.d;o++)i.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;const s=n/t*e;this.min=-s,this.max=e+s}insert(e,t,n,i,s){this._forEachCell(t,n,i,s,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(s)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,t,n,i,s,o){this.cells[s].push(o)}query(e,t,n,i,s){const o=this.min,a=this.max;if(e<=o&&t<=o&&a<=n&&a<=i&&!s)return Array.prototype.slice.call(this.keys);{const l=[];return this._forEachCell(e,t,n,i,this._queryCell,l,{},s),l}}_queryCell(e,t,n,i,s,o,a,l){const u=this.cells[s];if(u!==null){const c=this.keys,h=this.bboxes;for(let p=0;p<u.length;p++){const f=u[p];if(a[f]===void 0){const d=4*f;(l?l(h[d+0],h[d+1],h[d+2],h[d+3]):e<=h[d+2]&&t<=h[d+3]&&n>=h[d+0]&&i>=h[d+1])?(a[f]=!0,o.push(c[f])):a[f]=!1}}}}_forEachCell(e,t,n,i,s,o,a,l){const u=this._convertToCellCoord(e),c=this._convertToCellCoord(t),h=this._convertToCellCoord(n),p=this._convertToCellCoord(i);for(let f=u;f<=h;f++)for(let d=c;d<=p;d++){const y=this.d*d+f;if((!l||l(this._convertFromCellCoord(f),this._convertFromCellCoord(d),this._convertFromCellCoord(f+1),this._convertFromCellCoord(d+1)))&&s.call(this,e,t,n,i,y,o,a,l))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,t=3+this.cells.length+1+1;let n=0;for(let o=0;o<this.cells.length;o++)n+=this.cells[o].length;const i=new Int32Array(t+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;let s=t;for(let o=0;o<e.length;o++){const a=e[o];i[3+o]=s,i.set(a,s),s+=a.length}return i[3+e.length]=s,i.set(this.keys,s),s+=this.keys.length,i[3+e.length+1]=s,i.set(this.bboxes,s),s+=this.bboxes.length,i.buffer}static serialize(e,t){const n=e.toArrayBuffer();return t&&t.push(n),{buffer:n}}static deserialize(e){return new wr(e.buffer)}}var _={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const kc=["type","source","source-layer","minzoom","maxzoom","filter","layout"];class z{constructor(e,t,n,i){this.message=(e?`${e}: `:"")+n,i&&(this.identifier=i),t!=null&&t.__line__&&(this.line=t.__line__)}}function Xt(r,...e){for(const t of e)for(const n in t)r[n]=t[n];return r}class tt extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class vi{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[n,i]of t)this.bindings[n]=i}concat(e){return new vi(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const _r={kind:"null"},P={kind:"number"},X={kind:"string"},q={kind:"boolean"},He={kind:"color"},Ht={kind:"object"},Z={kind:"value"},un={kind:"collator"},Sr={kind:"formatted"},cn={kind:"padding"},kr={kind:"resolvedImage"},hn={kind:"variableAnchorOffsetCollection"};function Te(r,e){return{kind:"array",itemType:r,N:e}}function oe(r){if(r.kind==="array"){const e=oe(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Ac=[_r,P,X,q,He,Sr,Ht,Te(Z),cn,kr,hn];function Ar(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ar(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const t of Ac)if(!Ar(t,e))return null}}return`Expected ${oe(r)} but found ${oe(e)} instead.`}function bi(r,e){return e.some((t=>t.kind===r.kind))}function zt(r,e){return e.some((t=>t==="null"?r===null:t==="array"?Array.isArray(r):t==="object"?r&&!Array.isArray(r)&&typeof r=="object":t===typeof r))}function Ir(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const zo=.96422,Po=.82521,Co=4/29,Yt=6/29,Bo=3*Yt*Yt,Ic=Yt*Yt*Yt,Mc=Math.PI/180,zc=180/Math.PI;function Vo(r){return(r%=360)<0&&(r+=360),r}function To([r,e,t,n]){let i,s;const o=_i((.2225045*(r=wi(r))+.7168786*(e=wi(e))+.0606169*(t=wi(t)))/1);r===e&&e===t?i=s=o:(i=_i((.4360747*r+.3850649*e+.1430804*t)/zo),s=_i((.0139322*r+.0971045*e+.7141733*t)/Po));const a=116*o-16;return[a<0?0:a,500*(i-o),200*(o-s),n]}function wi(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function _i(r){return r>Ic?Math.pow(r,1/3):r/Bo+Co}function Eo([r,e,t,n]){let i=(r+16)/116,s=isNaN(e)?i:i+e/500,o=isNaN(t)?i:i-t/200;return i=1*ki(i),s=zo*ki(s),o=Po*ki(o),[Si(3.1338561*s-1.6168667*i-.4906146*o),Si(-.9787684*s+1.9161415*i+.033454*o),Si(.0719453*s-.2289914*i+1.4052427*o),n]}function Si(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function ki(r){return r>Yt?r*r*r:Bo*(r-Co)}function pn(r){return parseInt(r.padEnd(2,r),16)/255}function Fo(r,e){return Jt(e?r/100:r,0,1)}function Jt(r,e,t){return Math.min(Math.max(e,r),t)}function Do(r){return!r.some(Number.isNaN)}const Pc={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Q{constructor(e,t,n,i=1,s=!0){this.r=e,this.g=t,this.b=n,this.a=i,s||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[e,t,n,i]))}static parse(e){if(e instanceof Q)return e;if(typeof e!="string")return;const t=(function(n){if((n=n.toLowerCase().trim())==="transparent")return[0,0,0,0];const i=Pc[n];if(i){const[o,a,l]=i;return[o/255,a/255,l/255,1]}if(n.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(n)){const o=n.length<6?1:2;let a=1;return[pn(n.slice(a,a+=o)),pn(n.slice(a,a+=o)),pn(n.slice(a,a+=o)),pn(n.slice(a,a+o)||"ff")]}if(n.startsWith("rgb")){const o=n.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(o){const[a,l,u,c,h,p,f,d,y,m,g,x]=o,v=[c||" ",f||" ",m].join("");if(v==="  "||v==="  /"||v===",,"||v===",,,"){const w=[u,p,y].join(""),b=w==="%%%"?100:w===""?255:0;if(b){const S=[Jt(+l/b,0,1),Jt(+h/b,0,1),Jt(+d/b,0,1),g?Fo(+g,x):1];if(Do(S))return S}}return}}const s=n.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(s){const[o,a,l,u,c,h,p,f,d]=s,y=[l||" ",c||" ",p].join("");if(y==="  "||y==="  /"||y===",,"||y===",,,"){const m=[+a,Jt(+u,0,100),Jt(+h,0,100),f?Fo(+f,d):1];if(Do(m))return(function([g,x,v,w]){function b(S){const A=(S+g/30)%12,C=x*Math.min(v,1-v);return v-C*Math.max(-1,Math.min(A-3,9-A,1))}return g=Vo(g),x/=100,v/=100,[b(0),b(8),b(4),w]})(m)}}})(e);return t?new Q(...t,!1):void 0}get rgb(){const{r:e,g:t,b:n,a:i}=this,s=i||1/0;return this.overwriteGetter("rgb",[e/s,t/s,n/s,i])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[t,n,i,s]=To(e),o=Math.sqrt(n*n+i*i);return[Math.round(1e4*o)?Vo(Math.atan2(i,n)*zc):NaN,o,t,s]})(this.rgb))}get lab(){return this.overwriteGetter("lab",To(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,n,i]=this.rgb;return`rgba(${[e,t,n].map((s=>Math.round(255*s))).join(",")},${i})`}}Q.black=new Q(0,0,0,1),Q.white=new Q(1,1,1,1),Q.transparent=new Q(0,0,0,0),Q.red=new Q(1,0,0,1);class Ai{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ii{constructor(e,t,n,i,s){this.text=e,this.image=t,this.scale=n,this.fontStack=i,this.textColor=s}}class Ee{constructor(e){this.sections=e}static fromString(e){return new Ee([new Ii(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof Ee?e:Ee.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class Fe{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Fe)return e;if(typeof e=="number")return new Fe([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if(typeof t!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Fe(e)}}toString(){return JSON.stringify(this.values)}}const Cc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ne{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ne)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let t=0;t<e.length;t+=2){const n=e[t],i=e[t+1];if(typeof n!="string"||!Cc.has(n)||!Array.isArray(i)||i.length!==2||typeof i[0]!="number"||typeof i[1]!="number")return}return new Ne(e)}}toString(){return JSON.stringify(this.values)}}class Ue{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ue({name:e,available:!1}):null}}function $o(r,e,t,n){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[r,e,t,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[r,e,t,n]:[r,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Mr(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Q||r instanceof Ai||r instanceof Ee||r instanceof Fe||r instanceof Ne||r instanceof Ue)return!0;if(Array.isArray(r)){for(const e of r)if(!Mr(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Mr(r[e]))return!1;return!0}return!1}function ye(r){if(r===null)return _r;if(typeof r=="string")return X;if(typeof r=="boolean")return q;if(typeof r=="number")return P;if(r instanceof Q)return He;if(r instanceof Ai)return un;if(r instanceof Ee)return Sr;if(r instanceof Fe)return cn;if(r instanceof Ne)return hn;if(r instanceof Ue)return kr;if(Array.isArray(r)){const e=r.length;let t;for(const n of r){const i=ye(n);if(t){if(t===i)continue;t=Z;break}t=i}return Te(t||Z,e)}return Ht}function zr(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Q||r instanceof Ee||r instanceof Fe||r instanceof Ne||r instanceof Ue?r.toString():JSON.stringify(r)}class Pt{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Mr(e[1]))return t.error("invalid value");const n=e[1];let i=ye(n);const s=t.expectedType;return i.kind!=="array"||i.N!==0||!s||s.kind!=="array"||typeof s.N=="number"&&s.N!==0||(i=s),new Pt(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class fe{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const fn={string:X,number:P,boolean:q,object:Ht};class Ye{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,i=1;const s=e[0];if(s==="array"){let a,l;if(e.length>2){const u=e[1];if(typeof u!="string"||!(u in fn)||u==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);a=fn[u],i++}else a=Z;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);l=e[2],i++}n=Te(a,l)}else{if(!fn[s])throw new Error(`Types doesn't contain name = ${s}`);n=fn[s]}const o=[];for(;i<e.length;i++){const a=t.parse(e[i],i,Z);if(!a)return null;o.push(a)}return new Ye(n,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!Ar(this.type,ye(n)))return n;if(t===this.args.length-1)throw new fe(`Expected value to be of type ${oe(this.type)}, but found ${oe(ye(n))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Lo={"to-boolean":q,"to-color":He,"to-number":P,"to-string":X};class wt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if(!Lo[n])throw new Error(`Can't parse ${n} as it is not part of the known types`);if((n==="to-boolean"||n==="to-string")&&e.length!==2)return t.error("Expected one argument.");const i=Lo[n],s=[];for(let o=1;o<e.length;o++){const a=t.parse(e[o],o,Z);if(!a)return null;s.push(a)}return new wt(i,s)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let t,n;for(const i of this.args){if(t=i.evaluate(e),n=null,t instanceof Q)return t;if(typeof t=="string"){const s=e.parseColor(t);if(s)return s}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:$o(t[0],t[1],t[2],t[3]),!n))return new Q(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new fe(n||`Could not parse color from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const n of this.args){t=n.evaluate(e);const i=Fe.parse(t);if(i)return i}throw new fe(`Could not parse padding from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const n of this.args){t=n.evaluate(e);const i=Ne.parse(t);if(i)return i}throw new fe(`Could not parse variableAnchorOffsetCollection from value '${typeof t=="string"?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const n of this.args){if(t=n.evaluate(e),t===null)return 0;const i=Number(t);if(!isNaN(i))return i}throw new fe(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return Ee.fromString(zr(this.args[0].evaluate(e)));case"resolvedImage":return Ue.fromString(zr(this.args[0].evaluate(e)));default:return zr(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Bc=["Unknown","Point","LineString","Polygon"];class Oo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Bc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Q.parse(e)),t}}class dn{constructor(e,t,n=[],i,s=new vi,o=[]){this.registry=e,this.path=n,this.key=n.map((a=>`[${a}]`)).join(""),this.scope=s,this.errors=o,this.expectedType=i,this._isConstant=t}parse(e,t,n,i,s={}){return t?this.concat(t,n,i)._parse(e,s):this._parse(e,s)}_parse(e,t){function n(i,s,o){return o==="assert"?new Ye(s,[i]):o==="coerce"?new wt(s,[i]):i}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=e[0];if(typeof i!="string")return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const s=this.registry[i];if(s){let o=s.parse(e,this);if(!o)return null;if(this.expectedType){const a=this.expectedType,l=o.type;if(a.kind!=="string"&&a.kind!=="number"&&a.kind!=="boolean"&&a.kind!=="object"&&a.kind!=="array"||l.kind!=="value")if(a.kind!=="color"&&a.kind!=="formatted"&&a.kind!=="resolvedImage"||l.kind!=="value"&&l.kind!=="string")if(a.kind!=="padding"||l.kind!=="value"&&l.kind!=="number"&&l.kind!=="array")if(a.kind!=="variableAnchorOffsetCollection"||l.kind!=="value"&&l.kind!=="array"){if(this.checkSubtype(a,l))return null}else o=n(o,a,t.typeAnnotation||"coerce");else o=n(o,a,t.typeAnnotation||"coerce");else o=n(o,a,t.typeAnnotation||"coerce");else o=n(o,a,t.typeAnnotation||"assert")}if(!(o instanceof Pt)&&o.type.kind!=="resolvedImage"&&this._isConstant(o)){const a=new Oo;try{o=new Pt(o.type,o.evaluate(a))}catch(l){return this.error(l.message),null}}return o}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const i=typeof e=="number"?this.path.concat(e):this.path,s=n?this.scope.concat(n):this.scope;return new dn(this.registry,this._isConstant,i,t||null,s,this.errors)}error(e,...t){const n=`${this.key}${t.map((i=>`[${i}]`)).join("")}`;this.errors.push(new tt(n,e))}checkSubtype(e,t){const n=Ar(e,t);return n&&this.error(n),n}}class yn{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let s=1;s<e.length-1;s+=2){const o=e[s];if(typeof o!="string")return t.error(`Expected string, but found ${typeof o} instead.`,s);if(/[^a-zA-Z0-9_]/.test(o))return t.error("Variable names must contain only alphanumeric characters or '_'.",s);const a=t.parse(e[s+1],s+1);if(!a)return null;n.push([o,a])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return i?new yn(n,i):null}outputDefined(){return this.result.outputDefined()}}class mn{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new mn(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Mi{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,P),i=t.parse(e[2],2,Te(t.expectedType||Z));return n&&i?new Mi(i.type.itemType,n,i):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new fe(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new fe(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new fe(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class zi{constructor(e,t){this.type=q,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Z),i=t.parse(e[2],2,Z);return n&&i?bi(n.type,[q,X,P,_r,Z])?new zi(n,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${oe(n.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!zt(t,["boolean","string","number","null"]))throw new fe(`Expected first argument to be of type boolean, string, number or null, but found ${oe(ye(t))} instead.`);if(!zt(n,["string","array"]))throw new fe(`Expected second argument to be of type array or string, but found ${oe(ye(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class gn{constructor(e,t,n){this.type=P,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Z),i=t.parse(e[2],2,Z);if(!n||!i)return null;if(!bi(n.type,[q,X,P,_r,Z]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${oe(n.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,P);return s?new gn(n,i,s):null}return new gn(n,i)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!zt(t,["boolean","string","number","null"]))throw new fe(`Expected first argument to be of type boolean, string, number or null, but found ${oe(ye(t))} instead.`);let i;if(this.fromIndex&&(i=this.fromIndex.evaluate(e)),zt(n,["string"])){const s=n.indexOf(t,i);return s===-1?-1:[...n.slice(0,s)].length}if(zt(n,["array"]))return n.indexOf(t,i);throw new fe(`Expected second argument to be of type array or string, but found ${oe(ye(n))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Pi{constructor(e,t,n,i,s,o){this.inputType=e,this.type=t,this.input=n,this.cases=i,this.outputs=s,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,i;t.expectedType&&t.expectedType.kind!=="value"&&(i=t.expectedType);const s={},o=[];for(let u=2;u<e.length-1;u+=2){let c=e[u];const h=e[u+1];Array.isArray(c)||(c=[c]);const p=t.concat(u);if(c.length===0)return p.error("Expected at least one branch label.");for(const d of c){if(typeof d!="number"&&typeof d!="string")return p.error("Branch labels must be numbers or strings.");if(typeof d=="number"&&Math.abs(d)>Number.MAX_SAFE_INTEGER)return p.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof d=="number"&&Math.floor(d)!==d)return p.error("Numeric branch labels must be integer values.");if(n){if(p.checkSubtype(n,ye(d)))return null}else n=ye(d);if(s[String(d)]!==void 0)return p.error("Branch labels must be unique.");s[String(d)]=o.length}const f=t.parse(h,u,i);if(!f)return null;i=i||f.type,o.push(f)}const a=t.parse(e[1],1,Z);if(!a)return null;const l=t.parse(e[e.length-1],e.length-1,i);return l?a.type.kind!=="value"&&t.concat(1).checkSubtype(n,a.type)?null:new Pi(n,i,a,s,o,l):null}evaluate(e){const t=this.input.evaluate(e);return(ye(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class Ci{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&t.expectedType.kind!=="value"&&(n=t.expectedType);const i=[];for(let o=1;o<e.length-1;o+=2){const a=t.parse(e[o],o,q);if(!a)return null;const l=t.parse(e[o+1],o+1,n);if(!l)return null;i.push([a,l]),n=n||l.type}const s=t.parse(e[e.length-1],e.length-1,n);if(!s)return null;if(!n)throw new Error("Can't infer output type");return new Ci(n,i,s)}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}}class xn{constructor(e,t,n,i){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,Z),i=t.parse(e[2],2,P);if(!n||!i)return null;if(!bi(n.type,[Te(Z),X,Z]))return t.error(`Expected first argument to be of type array or string, but found ${oe(n.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,P);return s?new xn(n.type,n,i,s):null}return new xn(n.type,n,i)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);let i;if(this.endIndex&&(i=this.endIndex.evaluate(e)),zt(t,["string"]))return[...t].slice(n,i).join("");if(zt(t,["array"]))return t.slice(n,i);throw new fe(`Expected first argument to be of type array or string, but found ${oe(ye(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function vn(r,e){const t=r.length-1;let n,i,s=0,o=t,a=0;for(;s<=o;)if(a=Math.floor((s+o)/2),n=r[a],i=r[a+1],n<=e){if(a===t||e<i)return a;s=a+1}else{if(!(n>e))throw new fe("Input is not a number.");o=a-1}return 0}class Pr{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,s]of n)this.labels.push(i),this.outputs.push(s)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,P);if(!n)return null;const i=[];let s=null;t.expectedType&&t.expectedType.kind!=="value"&&(s=t.expectedType);for(let o=1;o<e.length;o+=2){const a=o===1?-1/0:e[o],l=e[o+1],u=o,c=o+1;if(typeof a!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(i.length&&i[i.length-1][0]>=a)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);const h=t.parse(l,c,s);if(!h)return null;s=s||h.type,i.push([a,h])}return new Pr(s,n,i)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const s=t.length;return i>=t[s-1]?n[s-1].evaluate(e):n[vn(t,i)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Vc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Tc=jo;function jo(r,e,t,n){this.cx=3*r,this.bx=3*(t-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=t,this.p2y=n}jo.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var t=r,n=0;n<8;n++){var i=this.sampleCurveX(t)-r;if(Math.abs(i)<e)return t;var s=this.sampleCurveDerivativeX(t);if(Math.abs(s)<1e-6)break;t-=i/s}var o=0,a=1;for(t=r,n=0;n<20&&(i=this.sampleCurveX(t),!(Math.abs(i-r)<e));n++)r>i?o=t:a=t,t=.5*(a-o)+o;return t},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var Ec=Vc(Tc);function Ct(r,e,t){return r+t*(e-r)}function bn(r,e,t){return r.map(((n,i)=>Ct(n,e[i],t)))}const rt={number:Ct,color:function(r,e,t,n="rgb"){switch(n){case"rgb":{const[i,s,o,a]=bn(r.rgb,e.rgb,t);return new Q(i,s,o,a,!1)}case"hcl":{const[i,s,o,a]=r.hcl,[l,u,c,h]=e.hcl;let p,f;if(isNaN(i)||isNaN(l))isNaN(i)?isNaN(l)?p=NaN:(p=l,o!==1&&o!==0||(f=u)):(p=i,c!==1&&c!==0||(f=s));else{let x=l-i;l>i&&x>180?x-=360:l<i&&i-l>180&&(x+=360),p=i+t*x}const[d,y,m,g]=(function([x,v,w,b]){return x=isNaN(x)?0:x*Mc,Eo([w,Math.cos(x)*v,Math.sin(x)*v,b])})([p,f??Ct(s,u,t),Ct(o,c,t),Ct(a,h,t)]);return new Q(d,y,m,g,!1)}case"lab":{const[i,s,o,a]=Eo(bn(r.lab,e.lab,t));return new Q(i,s,o,a,!1)}}},array:bn,padding:function(r,e,t){return new Fe(bn(r.values,e.values,t))},variableAnchorOffsetCollection:function(r,e,t){const n=r.values,i=e.values;if(n.length!==i.length)throw new fe(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${e.toString()}`);const s=[];for(let o=0;o<n.length;o+=2){if(n[o]!==i[o])throw new fe(`Cannot interpolate values containing mismatched anchors. from[${o}]: ${n[o]}, to[${o}]: ${i[o]}`);s.push(n[o]);const[a,l]=n[o+1],[u,c]=i[o+1];s.push([Ct(a,u,t),Ct(l,c,t)])}return new Ne(s)}};class qe{constructor(e,t,n,i,s){this.type=e,this.operator=t,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[o,a]of s)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(e,t,n,i){let s=0;if(e.name==="exponential")s=Bi(t,e.base,n,i);else if(e.name==="linear")s=Bi(t,1,n,i);else if(e.name==="cubic-bezier"){const o=e.controlPoints;s=new Ec(o[0],o[1],o[2],o[3]).solve(Bi(t,1,n,i))}return s}static parse(e,t){let[n,i,s,...o]=e;if(!Array.isArray(i)||i.length===0)return t.error("Expected an interpolation type expression.",1);if(i[0]==="linear")i={name:"linear"};else if(i[0]==="exponential"){const u=i[1];if(typeof u!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:u}}else{if(i[0]!=="cubic-bezier")return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const u=i.slice(1);if(u.length!==4||u.some((c=>typeof c!="number"||c<0||c>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:u}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(s=t.parse(s,2,P),!s)return null;const a=[];let l=null;n==="interpolate-hcl"||n==="interpolate-lab"?l=He:t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);for(let u=0;u<o.length;u+=2){const c=o[u],h=o[u+1],p=u+3,f=u+4;if(typeof c!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(a.length&&a[a.length-1][0]>=c)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',p);const d=t.parse(h,f,l);if(!d)return null;l=l||d.type,a.push([c,d])}return Ir(l,P)||Ir(l,He)||Ir(l,cn)||Ir(l,hn)||Ir(l,Te(P))?new qe(l,n,i,s,a):t.error(`Type ${oe(l)} is not interpolatable.`)}evaluate(e){const t=this.labels,n=this.outputs;if(t.length===1)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const s=t.length;if(i>=t[s-1])return n[s-1].evaluate(e);const o=vn(t,i),a=qe.interpolationFactor(this.interpolation,i,t[o],t[o+1]),l=n[o].evaluate(e),u=n[o+1].evaluate(e);switch(this.operator){case"interpolate":return rt[this.type.kind](l,u,a);case"interpolate-hcl":return rt.color(l,u,a,"hcl");case"interpolate-lab":return rt.color(l,u,a,"lab")}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Bi(r,e,t,n){const i=n-t,s=r-t;return i===0?0:e===1?s/i:(Math.pow(e,s)-1)/(Math.pow(e,i)-1)}class wn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const i=t.expectedType;i&&i.kind!=="value"&&(n=i);const s=[];for(const a of e.slice(1)){const l=t.parse(a,1+s.length,n,void 0,{typeAnnotation:"omit"});if(!l)return null;n=n||l.type,s.push(l)}if(!n)throw new Error("No output type");const o=i&&s.some((a=>Ar(i,a.type)));return new wn(o?Z:n,s)}evaluate(e){let t,n=null,i=0;for(const s of this.args)if(i++,n=s.evaluate(e),n&&n instanceof Ue&&!n.available&&(t||(t=n.name),n=null,i===this.args.length&&(n=t)),n!==null)break;return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function Ro(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function No(r,e,t,n){return n.compare(e,t)===0}function Kt(r,e,t){const n=r!=="=="&&r!=="!=";return class wc{constructor(s,o,a){this.type=q,this.lhs=s,this.rhs=o,this.collator=a,this.hasUntypedArgument=s.type.kind==="value"||o.type.kind==="value"}static parse(s,o){if(s.length!==3&&s.length!==4)return o.error("Expected two or three arguments.");const a=s[0];let l=o.parse(s[1],1,Z);if(!l)return null;if(!Ro(a,l.type))return o.concat(1).error(`"${a}" comparisons are not supported for type '${oe(l.type)}'.`);let u=o.parse(s[2],2,Z);if(!u)return null;if(!Ro(a,u.type))return o.concat(2).error(`"${a}" comparisons are not supported for type '${oe(u.type)}'.`);if(l.type.kind!==u.type.kind&&l.type.kind!=="value"&&u.type.kind!=="value")return o.error(`Cannot compare types '${oe(l.type)}' and '${oe(u.type)}'.`);n&&(l.type.kind==="value"&&u.type.kind!=="value"?l=new Ye(u.type,[l]):l.type.kind!=="value"&&u.type.kind==="value"&&(u=new Ye(l.type,[u])));let c=null;if(s.length===4){if(l.type.kind!=="string"&&u.type.kind!=="string"&&l.type.kind!=="value"&&u.type.kind!=="value")return o.error("Cannot use collator to compare non-string types.");if(c=o.parse(s[3],3,un),!c)return null}return new wc(l,u,c)}evaluate(s){const o=this.lhs.evaluate(s),a=this.rhs.evaluate(s);if(n&&this.hasUntypedArgument){const l=ye(o),u=ye(a);if(l.kind!==u.kind||l.kind!=="string"&&l.kind!=="number")throw new fe(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${l.kind}, ${u.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const l=ye(o),u=ye(a);if(l.kind!=="string"||u.kind!=="string")return e(s,o,a)}return this.collator?t(s,o,a,this.collator.evaluate(s)):e(s,o,a)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}}}const Fc=Kt("==",(function(r,e,t){return e===t}),No),Dc=Kt("!=",(function(r,e,t){return e!==t}),(function(r,e,t,n){return!No(0,e,t,n)})),$c=Kt("<",(function(r,e,t){return e<t}),(function(r,e,t,n){return n.compare(e,t)<0})),Lc=Kt(">",(function(r,e,t){return e>t}),(function(r,e,t,n){return n.compare(e,t)>0})),Oc=Kt("<=",(function(r,e,t){return e<=t}),(function(r,e,t,n){return n.compare(e,t)<=0})),jc=Kt(">=",(function(r,e,t){return e>=t}),(function(r,e,t,n){return n.compare(e,t)>=0}));class _n{constructor(e,t,n){this.type=un,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return t.error("Collator options argument must be an object.");const i=t.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,q);if(!i)return null;const s=t.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,q);if(!s)return null;let o=null;return n.locale&&(o=t.parse(n.locale,1,X),!o)?null:new _n(i,s,o)}evaluate(e){return new Ai(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Vi{constructor(e,t,n,i,s){this.type=X,this.number=e,this.locale=t,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=s}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const n=t.parse(e[1],1,P);if(!n)return null;const i=e[2];if(typeof i!="object"||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let s=null;if(i.locale&&(s=t.parse(i.locale,1,X),!s))return null;let o=null;if(i.currency&&(o=t.parse(i.currency,1,X),!o))return null;let a=null;if(i["min-fraction-digits"]&&(a=t.parse(i["min-fraction-digits"],1,P),!a))return null;let l=null;return i["max-fraction-digits"]&&(l=t.parse(i["max-fraction-digits"],1,P),!l)?null:new Vi(n,s,o,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Sn{constructor(e){this.type=Sr,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return t.error("First argument must be an image or text section.");const i=[];let s=!1;for(let o=1;o<=e.length-1;++o){const a=e[o];if(s&&typeof a=="object"&&!Array.isArray(a)){s=!1;let l=null;if(a["font-scale"]&&(l=t.parse(a["font-scale"],1,P),!l))return null;let u=null;if(a["text-font"]&&(u=t.parse(a["text-font"],1,Te(X)),!u))return null;let c=null;if(a["text-color"]&&(c=t.parse(a["text-color"],1,He),!c))return null;const h=i[i.length-1];h.scale=l,h.font=u,h.textColor=c}else{const l=t.parse(e[o],1,Z);if(!l)return null;const u=l.type.kind;if(u!=="string"&&u!=="value"&&u!=="null"&&u!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,i.push({content:l,scale:null,font:null,textColor:null})}}return new Sn(i)}evaluate(e){return new Ee(this.sections.map((t=>{const n=t.content.evaluate(e);return ye(n)===kr?new Ii("",n,null,null,null):new Ii(zr(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}}class Ti{constructor(e){this.type=kr,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const n=t.parse(e[1],1,X);return n?new Ti(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=Ue.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}}class Ei{constructor(e){this.type=P,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${oe(n.type)} instead.`):new Ei(n):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string")return[...t].length;if(Array.isArray(t))return t.length;throw new fe(`Expected value to be of type string or array, but found ${oe(ye(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const nt=8192;function Rc(r,e){const t=(180+r[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return[Math.round(t*i*nt),Math.round(n*i*nt)]}function Fi(r,e){const t=Math.pow(2,e.z);return[(i=(r[0]/nt+e.x)/t,360*i-180),(n=(r[1]/nt+e.y)/t,360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90)];var n,i}function Cr(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Br(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Nc(r,e,t){const n=r[0]-e[0],i=r[1]-e[1],s=r[0]-t[0],o=r[1]-t[1];return n*o-s*i==0&&n*s<=0&&i*o<=0}function kn(r,e,t,n){return(i=[n[0]-t[0],n[1]-t[1]])[0]*(s=[e[0]-r[0],e[1]-r[1]])[1]-i[1]*s[0]!=0&&!(!qo(r,e,t,n)||!qo(t,n,r,e));var i,s}function Uc(r,e,t){for(const n of t)for(let i=0;i<n.length-1;++i)if(kn(r,e,n[i],n[i+1]))return!0;return!1}function Wt(r,e,t=!1){let n=!1;for(const a of e)for(let l=0;l<a.length-1;l++){if(Nc(r,a[l],a[l+1]))return t;(s=a[l])[1]>(i=r)[1]!=(o=a[l+1])[1]>i[1]&&i[0]<(o[0]-s[0])*(i[1]-s[1])/(o[1]-s[1])+s[0]&&(n=!n)}var i,s,o;return n}function qc(r,e){for(const t of e)if(Wt(r,t))return!0;return!1}function Uo(r,e){for(const t of r)if(!Wt(t,e))return!1;for(let t=0;t<r.length-1;++t)if(Uc(r[t],r[t+1],e))return!1;return!0}function Zc(r,e){for(const t of e)if(Uo(r,t))return!0;return!1}function qo(r,e,t,n){const i=n[0]-t[0],s=n[1]-t[1],o=(r[0]-t[0])*s-i*(r[1]-t[1]),a=(e[0]-t[0])*s-i*(e[1]-t[1]);return o>0&&a<0||o<0&&a>0}function Di(r,e,t){const n=[];for(let i=0;i<r.length;i++){const s=[];for(let o=0;o<r[i].length;o++){const a=Rc(r[i][o],t);Cr(e,a),s.push(a)}n.push(s)}return n}function Zo(r,e,t){const n=[];for(let i=0;i<r.length;i++){const s=Di(r[i],e,t);n.push(s)}return n}function Go(r,e,t,n){if(r[0]<t[0]||r[0]>t[2]){const i=.5*n;let s=r[0]-t[0]>i?-n:t[0]-r[0]>i?n:0;s===0&&(s=r[0]-t[2]>i?-n:t[2]-r[0]>i?n:0),r[0]+=s}Cr(e,r)}function Xo(r,e,t,n){const i=Math.pow(2,n.z)*nt,s=[n.x*nt,n.y*nt],o=[];for(const a of r)for(const l of a){const u=[l.x+s[0],l.y+s[1]];Go(u,e,t,i),o.push(u)}return o}function Ho(r,e,t,n){const i=Math.pow(2,n.z)*nt,s=[n.x*nt,n.y*nt],o=[];for(const l of r){const u=[];for(const c of l){const h=[c.x+s[0],c.y+s[1]];Cr(e,h),u.push(h)}o.push(u)}if(e[2]-e[0]<=i/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const l of o)for(const u of l)Go(u,e,t,i)}var a;return o}class Bt{constructor(e,t){this.type=q,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Mr(e[1])){const n=e[1];if(n.type==="FeatureCollection"){const i=[];for(const s of n.features){const{type:o,coordinates:a}=s.geometry;o==="Polygon"&&i.push(a),o==="MultiPolygon"&&i.push(...a)}if(i.length)return new Bt(n,{type:"MultiPolygon",coordinates:i})}else if(n.type==="Feature"){const i=n.geometry.type;if(i==="Polygon"||i==="MultiPolygon")return new Bt(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new Bt(n,n)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(t,n){const i=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],o=t.canonicalID();if(n.type==="Polygon"){const a=Di(n.coordinates,s,o),l=Xo(t.geometry(),i,s,o);if(!Br(i,s))return!1;for(const u of l)if(!Wt(u,a))return!1}if(n.type==="MultiPolygon"){const a=Zo(n.coordinates,s,o),l=Xo(t.geometry(),i,s,o);if(!Br(i,s))return!1;for(const u of l)if(!qc(u,a))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(t,n){const i=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],o=t.canonicalID();if(n.type==="Polygon"){const a=Di(n.coordinates,s,o),l=Ho(t.geometry(),i,s,o);if(!Br(i,s))return!1;for(const u of l)if(!Uo(u,a))return!1}if(n.type==="MultiPolygon"){const a=Zo(n.coordinates,s,o),l=Ho(t.geometry(),i,s,o);if(!Br(i,s))return!1;for(const u of l)if(!Zc(u,a))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Yo=class{constructor(r=[],e=((t,n)=>t<n?-1:t>n?1:0)){if(this.data=r,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:e,compare:t}=this,n=e[r];for(;r>0;){const i=r-1>>1,s=e[i];if(t(n,s)>=0)break;e[r]=s,r=i}e[r]=n}_down(r){const{data:e,compare:t}=this,n=this.length>>1,i=e[r];for(;r<n;){let s=1+(r<<1);const o=s+1;if(o<this.length&&t(e[o],e[s])<0&&(s=o),t(e[s],i)>=0)break;e[r]=e[s],r=s}e[r]=i}};function Gc(r,e,t,n,i){Jo(r,e,t,n||r.length-1,i||Xc)}function Jo(r,e,t,n,i){for(;n>t;){if(n-t>600){var s=n-t+1,o=e-t+1,a=Math.log(s),l=.5*Math.exp(2*a/3),u=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1);Jo(r,e,Math.max(t,Math.floor(e-o*l/s+u)),Math.min(n,Math.floor(e+(s-o)*l/s+u)),i)}var c=r[e],h=t,p=n;for(Vr(r,t,e),i(r[n],c)>0&&Vr(r,t,n);h<p;){for(Vr(r,h,p),h++,p--;i(r[h],c)<0;)h++;for(;i(r[p],c)>0;)p--}i(r[t],c)===0?Vr(r,t,p):Vr(r,++p,n),p<=e&&(t=p+1),e<=p&&(n=p-1)}}function Vr(r,e,t){var n=r[e];r[e]=r[t],r[t]=n}function Xc(r,e){return r<e?-1:r>e?1:0}function An(r,e){if(r.length<=1)return[r];const t=[];let n,i;for(const s of r){const o=Yc(s);o!==0&&(s.area=Math.abs(o),i===void 0&&(i=o<0),i===o<0?(n&&t.push(n),n=[s]):n.push(s))}if(n&&t.push(n),e>1)for(let s=0;s<t.length;s++)t[s].length<=e||(Gc(t[s],e,1,t[s].length-1,Hc),t[s]=t[s].slice(0,e));return t}function Hc(r,e){return e.area-r.area}function Yc(r){let e=0;for(let t,n,i=0,s=r.length,o=s-1;i<s;o=i++)t=r[i],n=r[o],e+=(n.x-t.x)*(t.y+n.y);return e}const Ko=1/298.257223563,Wo=Ko*(2-Ko),Qo=Math.PI/180;class $i{constructor(e){const t=6378.137*Qo*1e3,n=Math.cos(e*Qo),i=1/(1-Wo*(1-n*n)),s=Math.sqrt(i);this.kx=t*s*n,this.ky=t*s*i*(1-Wo)}distance(e,t){const n=this.wrap(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+i*i)}pointOnLine(e,t){let n,i,s,o,a=1/0;for(let l=0;l<e.length-1;l++){let u=e[l][0],c=e[l][1],h=this.wrap(e[l+1][0]-u)*this.kx,p=(e[l+1][1]-c)*this.ky,f=0;h===0&&p===0||(f=(this.wrap(t[0]-u)*this.kx*h+(t[1]-c)*this.ky*p)/(h*h+p*p),f>1?(u=e[l+1][0],c=e[l+1][1]):f>0&&(u+=h/this.kx*f,c+=p/this.ky*f)),h=this.wrap(t[0]-u)*this.kx,p=(t[1]-c)*this.ky;const d=h*h+p*p;d<a&&(a=d,n=u,i=c,s=l,o=f)}return{point:[n,i],index:s,t:Math.max(0,Math.min(1,o))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function ea(r,e){return e[0]-r[0]}function In(r){return r[1]-r[0]+1}function pt(r,e){return r[1]>=r[0]&&r[1]<e}function Li(r,e){if(r[0]>r[1])return[null,null];const t=In(r);if(e){if(t===2)return[r,null];const i=Math.floor(t/2);return[[r[0],r[0]+i],[r[0]+i,r[1]]]}if(t===1)return[r,null];const n=Math.floor(t/2)-1;return[[r[0],r[0]+n],[r[0]+n+1,r[1]]]}function Oi(r,e){if(!pt(e,r.length))return[1/0,1/0,-1/0,-1/0];const t=[1/0,1/0,-1/0,-1/0];for(let n=e[0];n<=e[1];++n)Cr(t,r[n]);return t}function ji(r){const e=[1/0,1/0,-1/0,-1/0];for(const t of r)for(const n of t)Cr(e,n);return e}function ta(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function Ri(r,e,t){if(!ta(r)||!ta(e))return NaN;let n=0,i=0;return r[2]<e[0]&&(n=e[0]-r[2]),r[0]>e[2]&&(n=r[0]-e[2]),r[1]>e[3]&&(i=r[1]-e[3]),r[3]<e[1]&&(i=e[1]-r[3]),t.distance([0,0],[n,i])}function Vt(r,e,t){const n=t.pointOnLine(e,r);return t.distance(r,n.point)}function Ni(r,e,t,n,i){const s=Math.min(Vt(r,[t,n],i),Vt(e,[t,n],i)),o=Math.min(Vt(t,[r,e],i),Vt(n,[r,e],i));return Math.min(s,o)}function Jc(r,e,t,n,i){if(!pt(e,r.length)||!pt(n,t.length))return 1/0;let s=1/0;for(let o=e[0];o<e[1];++o){const a=r[o],l=r[o+1];for(let u=n[0];u<n[1];++u){const c=t[u],h=t[u+1];if(kn(a,l,c,h))return 0;s=Math.min(s,Ni(a,l,c,h,i))}}return s}function Kc(r,e,t,n,i){if(!pt(e,r.length)||!pt(n,t.length))return NaN;let s=1/0;for(let o=e[0];o<=e[1];++o)for(let a=n[0];a<=n[1];++a)if(s=Math.min(s,i.distance(r[o],t[a])),s===0)return s;return s}function Wc(r,e,t){if(Wt(r,e,!0))return 0;let n=1/0;for(const i of e){const s=i[0],o=i[i.length-1];if(s!==o&&(n=Math.min(n,Vt(r,[o,s],t)),n===0))return n;const a=t.pointOnLine(i,r);if(n=Math.min(n,t.distance(r,a.point)),n===0)return n}return n}function Qc(r,e,t,n){if(!pt(e,r.length))return NaN;for(let s=e[0];s<=e[1];++s)if(Wt(r[s],t,!0))return 0;let i=1/0;for(let s=e[0];s<e[1];++s){const o=r[s],a=r[s+1];for(const l of t)for(let u=0,c=l.length,h=c-1;u<c;h=u++){const p=l[h],f=l[u];if(kn(o,a,p,f))return 0;i=Math.min(i,Ni(o,a,p,f,n))}}return i}function ra(r,e){for(const t of r)for(const n of t)if(Wt(n,e,!0))return!0;return!1}function eh(r,e,t,n=1/0){const i=ji(r),s=ji(e);if(n!==1/0&&Ri(i,s,t)>=n)return n;if(Br(i,s)){if(ra(r,e))return 0}else if(ra(e,r))return 0;let o=1/0;for(const a of r)for(let l=0,u=a.length,c=u-1;l<u;c=l++){const h=a[c],p=a[l];for(const f of e)for(let d=0,y=f.length,m=y-1;d<y;m=d++){const g=f[m],x=f[d];if(kn(h,p,g,x))return 0;o=Math.min(o,Ni(h,p,g,x,t))}}return o}function na(r,e,t,n,i,s){if(!s)return;const o=Ri(Oi(n,s),i,t);o<e&&r.push([o,s,[0,0]])}function Mn(r,e,t,n,i,s,o){if(!s||!o)return;const a=Ri(Oi(n,s),Oi(i,o),t);a<e&&r.push([a,s,o])}function zn(r,e,t,n,i=1/0){let s=Math.min(n.distance(r[0],t[0][0]),i);if(s===0)return s;const o=new Yo([[0,[0,r.length-1],[0,0]]],ea),a=ji(t);for(;o.length>0;){const l=o.pop();if(l[0]>=s)continue;const u=l[1],c=e?50:100;if(In(u)<=c){if(!pt(u,r.length))return NaN;if(e){const h=Qc(r,u,t,n);if(isNaN(h)||h===0)return h;s=Math.min(s,h)}else for(let h=u[0];h<=u[1];++h){const p=Wc(r[h],t,n);if(s=Math.min(s,p),s===0)return 0}}else{const h=Li(u,e);na(o,s,n,r,a,h[0]),na(o,s,n,r,a,h[1])}}return s}function Pn(r,e,t,n,i,s=1/0){let o=Math.min(s,i.distance(r[0],t[0]));if(o===0)return o;const a=new Yo([[0,[0,r.length-1],[0,t.length-1]]],ea);for(;a.length>0;){const l=a.pop();if(l[0]>=o)continue;const u=l[1],c=l[2],h=e?50:100,p=n?50:100;if(In(u)<=h&&In(c)<=p){if(!pt(u,r.length)&&pt(c,t.length))return NaN;let f;if(e&&n)f=Jc(r,u,t,c,i),o=Math.min(o,f);else if(e&&!n){const d=r.slice(u[0],u[1]+1);for(let y=c[0];y<=c[1];++y)if(f=Vt(t[y],d,i),o=Math.min(o,f),o===0)return o}else if(!e&&n){const d=t.slice(c[0],c[1]+1);for(let y=u[0];y<=u[1];++y)if(f=Vt(r[y],d,i),o=Math.min(o,f),o===0)return o}else f=Kc(r,u,t,c,i),o=Math.min(o,f)}else{const f=Li(u,e),d=Li(c,n);Mn(a,o,i,r,t,f[0],d[0]),Mn(a,o,i,r,t,f[0],d[1]),Mn(a,o,i,r,t,f[1],d[0]),Mn(a,o,i,r,t,f[1],d[1])}}return o}function Ui(r){return r.type==="MultiPolygon"?r.coordinates.map((e=>({type:"Polygon",coordinates:e}))):r.type==="MultiLineString"?r.coordinates.map((e=>({type:"LineString",coordinates:e}))):r.type==="MultiPoint"?r.coordinates.map((e=>({type:"Point",coordinates:e}))):[r]}class Tt{constructor(e,t){this.type=P,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Mr(e[1])){const n=e[1];if(n.type==="FeatureCollection")return new Tt(n,n.features.map((i=>Ui(i.geometry))).flat());if(n.type==="Feature")return new Tt(n,Ui(n.geometry));if("type"in n&&"coordinates"in n)return new Tt(n,Ui(n))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(t,n){const i=t.geometry(),s=i.flat().map((l=>Fi([l.x,l.y],t.canonical)));if(i.length===0)return NaN;const o=new $i(s[0][1]);let a=1/0;for(const l of n){switch(l.type){case"Point":a=Math.min(a,Pn(s,!1,[l.coordinates],!1,o,a));break;case"LineString":a=Math.min(a,Pn(s,!1,l.coordinates,!0,o,a));break;case"Polygon":a=Math.min(a,zn(s,!1,l.coordinates,o,a))}if(a===0)return a}return a})(e,this.geometries);if(e.geometryType()==="LineString")return(function(t,n){const i=t.geometry(),s=i.flat().map((l=>Fi([l.x,l.y],t.canonical)));if(i.length===0)return NaN;const o=new $i(s[0][1]);let a=1/0;for(const l of n){switch(l.type){case"Point":a=Math.min(a,Pn(s,!0,[l.coordinates],!1,o,a));break;case"LineString":a=Math.min(a,Pn(s,!0,l.coordinates,!0,o,a));break;case"Polygon":a=Math.min(a,zn(s,!0,l.coordinates,o,a))}if(a===0)return a}return a})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(t,n){const i=t.geometry();if(i.length===0||i[0].length===0)return NaN;const s=An(i,0).map((l=>l.map((u=>u.map((c=>Fi([c.x,c.y],t.canonical))))))),o=new $i(s[0][0][0][1]);let a=1/0;for(const l of n)for(const u of s){switch(l.type){case"Point":a=Math.min(a,zn([l.coordinates],!1,u,o,a));break;case"LineString":a=Math.min(a,zn(l.coordinates,!0,u,o,a));break;case"Polygon":a=Math.min(a,eh(u,l.coordinates,o,a))}if(a===0)return a}return a})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Qt={"==":Fc,"!=":Dc,">":Lc,"<":$c,">=":jc,"<=":Oc,array:Ye,at:Mi,boolean:Ye,case:Ci,coalesce:wn,collator:_n,format:Sn,image:Ti,in:zi,"index-of":gn,interpolate:qe,"interpolate-hcl":qe,"interpolate-lab":qe,length:Ei,let:yn,literal:Pt,match:Pi,number:Ye,"number-format":Vi,object:Ye,slice:xn,step:Pr,string:Ye,"to-boolean":wt,"to-color":wt,"to-number":wt,"to-string":wt,var:mn,within:Bt,distance:Tt};class Ze{constructor(e,t,n,i){this.name=e,this.type=t,this._evaluate=n,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const n=e[0],i=Ze.definitions[n];if(!i)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,a=o.filter((([u])=>!Array.isArray(u)||u.length===e.length-1));let l=null;for(const[u,c]of a){l=new dn(t.registry,Cn,t.path,null,t.scope);const h=[];let p=!1;for(let f=1;f<e.length;f++){const d=e[f],y=Array.isArray(u)?u[f-1]:u.type,m=l.parse(d,1+h.length,y);if(!m){p=!0;break}h.push(m)}if(!p)if(Array.isArray(u)&&u.length!==h.length)l.error(`Expected ${u.length} arguments, but found ${h.length} instead.`);else{for(let f=0;f<h.length;f++){const d=Array.isArray(u)?u[f]:u.type,y=h[f];l.concat(f+1).checkSubtype(d,y.type)}if(l.errors.length===0)return new Ze(n,s,c,h)}}if(a.length===1)t.errors.push(...l.errors);else{const u=(a.length?a:o).map((([h])=>{return p=h,Array.isArray(p)?`(${p.map(oe).join(", ")})`:`(${oe(p.type)}...)`;var p})).join(" | "),c=[];for(let h=1;h<e.length;h++){const p=t.parse(e[h],1+c.length);if(!p)return null;c.push(oe(p.type))}t.error(`Expected arguments of type ${u}, but found (${c.join(", ")}) instead.`)}return null}static register(e,t){Ze.definitions=t;for(const n in t)e[n]=Ze}}function ia(r,[e,t,n,i]){e=e.evaluate(r),t=t.evaluate(r),n=n.evaluate(r);const s=i?i.evaluate(r):1,o=$o(e,t,n,s);if(o)throw new fe(o);return new Q(e/255,t/255,n/255,s,!1)}function sa(r,e){return r in e}function qi(r,e){const t=e[r];return t===void 0?null:t}function Et(r){return{type:r}}function Cn(r){if(r instanceof mn)return Cn(r.boundExpression);if(r instanceof Ze&&r.name==="error"||r instanceof _n||r instanceof Bt||r instanceof Tt)return!1;const e=r instanceof wt||r instanceof Ye;let t=!0;return r.eachChild((n=>{t=e?t&&Cn(n):t&&n instanceof Pt})),!!t&&Bn(r)&&Vn(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Bn(r){if(r instanceof Ze&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Bt||r instanceof Tt)return!1;let e=!0;return r.eachChild((t=>{e&&!Bn(t)&&(e=!1)})),e}function Tr(r){if(r instanceof Ze&&r.name==="feature-state")return!1;let e=!0;return r.eachChild((t=>{e&&!Tr(t)&&(e=!1)})),e}function Vn(r,e){if(r instanceof Ze&&e.indexOf(r.name)>=0)return!1;let t=!0;return r.eachChild((n=>{t&&!Vn(n,e)&&(t=!1)})),t}function oa(r){return{result:"success",value:r}}function er(r){return{result:"error",value:r}}function tr(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function aa(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Zi(r){return!!r.expression&&r.expression.interpolated}function J(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Tn(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function th(r){return r}function la(r,e){const t=e.type==="color",n=r.stops&&typeof r.stops[0][0]=="object",i=n||!(n||r.property!==void 0),s=r.type||(Zi(e)?"exponential":"interval");if(t||e.type==="padding"){const c=t?Q.parse:Fe.parse;(r=Xt({},r)).stops&&(r.stops=r.stops.map((h=>[h[0],c(h[1])]))),r.default=c(r.default?r.default:e.default)}if(r.colorSpace&&(o=r.colorSpace)!=="rgb"&&o!=="hcl"&&o!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var o;let a,l,u;if(s==="exponential")a=ua;else if(s==="interval")a=nh;else if(s==="categorical"){a=rh,l=Object.create(null);for(const c of r.stops)l[c[0]]=c[1];u=typeof r.stops[0][0]}else{if(s!=="identity")throw new Error(`Unknown function type "${s}"`);a=ih}if(n){const c={},h=[];for(let d=0;d<r.stops.length;d++){const y=r.stops[d],m=y[0].zoom;c[m]===void 0&&(c[m]={zoom:m,type:r.type,property:r.property,default:r.default,stops:[]},h.push(m)),c[m].stops.push([y[0].value,y[1]])}const p=[];for(const d of h)p.push([c[d].zoom,la(c[d],e)]);const f={name:"linear"};return{kind:"composite",interpolationType:f,interpolationFactor:qe.interpolationFactor.bind(void 0,f),zoomStops:p.map((d=>d[0])),evaluate:({zoom:d},y)=>ua({stops:p,base:r.base},e,d).evaluate(d,y)}}if(i){const c=s==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:c,interpolationFactor:qe.interpolationFactor.bind(void 0,c),zoomStops:r.stops.map((h=>h[0])),evaluate:({zoom:h})=>a(r,e,h,l,u)}}return{kind:"source",evaluate(c,h){const p=h&&h.properties?h.properties[r.property]:void 0;return p===void 0?Er(r.default,e.default):a(r,e,p,l,u)}}}function Er(r,e,t){return r!==void 0?r:e!==void 0?e:t!==void 0?t:void 0}function rh(r,e,t,n,i){return Er(typeof t===i?n[t]:void 0,r.default,e.default)}function nh(r,e,t){if(J(t)!=="number")return Er(r.default,e.default);const n=r.stops.length;if(n===1||t<=r.stops[0][0])return r.stops[0][1];if(t>=r.stops[n-1][0])return r.stops[n-1][1];const i=vn(r.stops.map((s=>s[0])),t);return r.stops[i][1]}function ua(r,e,t){const n=r.base!==void 0?r.base:1;if(J(t)!=="number")return Er(r.default,e.default);const i=r.stops.length;if(i===1||t<=r.stops[0][0])return r.stops[0][1];if(t>=r.stops[i-1][0])return r.stops[i-1][1];const s=vn(r.stops.map((c=>c[0])),t),o=(function(c,h,p,f){const d=f-p,y=c-p;return d===0?0:h===1?y/d:(Math.pow(h,y)-1)/(Math.pow(h,d)-1)})(t,n,r.stops[s][0],r.stops[s+1][0]),a=r.stops[s][1],l=r.stops[s+1][1],u=rt[e.type]||th;return typeof a.evaluate=="function"?{evaluate(...c){const h=a.evaluate.apply(void 0,c),p=l.evaluate.apply(void 0,c);if(h!==void 0&&p!==void 0)return u(h,p,o,r.colorSpace)}}:u(a,l,o,r.colorSpace)}function ih(r,e,t){switch(e.type){case"color":t=Q.parse(t);break;case"formatted":t=Ee.fromString(t.toString());break;case"resolvedImage":t=Ue.fromString(t.toString());break;case"padding":t=Fe.parse(t);break;default:J(t)===e.type||e.type==="enum"&&e.values[t]||(t=void 0)}return Er(t,r.default,e.default)}Ze.register(Qt,{error:[{kind:"error"},[X],(r,[e])=>{throw new fe(e.evaluate(r))}],typeof:[X,[Z],(r,[e])=>oe(ye(e.evaluate(r)))],"to-rgba":[Te(P,4),[He],(r,[e])=>{const[t,n,i,s]=e.evaluate(r).rgb;return[255*t,255*n,255*i,s]}],rgb:[He,[P,P,P],ia],rgba:[He,[P,P,P,P],ia],has:{type:q,overloads:[[[X],(r,[e])=>sa(e.evaluate(r),r.properties())],[[X,Ht],(r,[e,t])=>sa(e.evaluate(r),t.evaluate(r))]]},get:{type:Z,overloads:[[[X],(r,[e])=>qi(e.evaluate(r),r.properties())],[[X,Ht],(r,[e,t])=>qi(e.evaluate(r),t.evaluate(r))]]},"feature-state":[Z,[X],(r,[e])=>qi(e.evaluate(r),r.featureState||{})],properties:[Ht,[],r=>r.properties()],"geometry-type":[X,[],r=>r.geometryType()],id:[Z,[],r=>r.id()],zoom:[P,[],r=>r.globals.zoom],"heatmap-density":[P,[],r=>r.globals.heatmapDensity||0],"line-progress":[P,[],r=>r.globals.lineProgress||0],accumulated:[Z,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[P,Et(P),(r,e)=>{let t=0;for(const n of e)t+=n.evaluate(r);return t}],"*":[P,Et(P),(r,e)=>{let t=1;for(const n of e)t*=n.evaluate(r);return t}],"-":{type:P,overloads:[[[P,P],(r,[e,t])=>e.evaluate(r)-t.evaluate(r)],[[P],(r,[e])=>-e.evaluate(r)]]},"/":[P,[P,P],(r,[e,t])=>e.evaluate(r)/t.evaluate(r)],"%":[P,[P,P],(r,[e,t])=>e.evaluate(r)%t.evaluate(r)],ln2:[P,[],()=>Math.LN2],pi:[P,[],()=>Math.PI],e:[P,[],()=>Math.E],"^":[P,[P,P],(r,[e,t])=>Math.pow(e.evaluate(r),t.evaluate(r))],sqrt:[P,[P],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[P,[P],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[P,[P],(r,[e])=>Math.log(e.evaluate(r))],log2:[P,[P],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[P,[P],(r,[e])=>Math.sin(e.evaluate(r))],cos:[P,[P],(r,[e])=>Math.cos(e.evaluate(r))],tan:[P,[P],(r,[e])=>Math.tan(e.evaluate(r))],asin:[P,[P],(r,[e])=>Math.asin(e.evaluate(r))],acos:[P,[P],(r,[e])=>Math.acos(e.evaluate(r))],atan:[P,[P],(r,[e])=>Math.atan(e.evaluate(r))],min:[P,Et(P),(r,e)=>Math.min(...e.map((t=>t.evaluate(r))))],max:[P,Et(P),(r,e)=>Math.max(...e.map((t=>t.evaluate(r))))],abs:[P,[P],(r,[e])=>Math.abs(e.evaluate(r))],round:[P,[P],(r,[e])=>{const t=e.evaluate(r);return t<0?-Math.round(-t):Math.round(t)}],floor:[P,[P],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[P,[P],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[q,[X,Z],(r,[e,t])=>r.properties()[e.value]===t.value],"filter-id-==":[q,[Z],(r,[e])=>r.id()===e.value],"filter-type-==":[q,[X],(r,[e])=>r.geometryType()===e.value],"filter-<":[q,[X,Z],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n<i}],"filter-id-<":[q,[Z],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t<n}],"filter->":[q,[X,Z],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n>i}],"filter-id->":[q,[Z],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t>n}],"filter-<=":[q,[X,Z],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n<=i}],"filter-id-<=":[q,[Z],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t<=n}],"filter->=":[q,[X,Z],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n>=i}],"filter-id->=":[q,[Z],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t>=n}],"filter-has":[q,[Z],(r,[e])=>e.value in r.properties()],"filter-has-id":[q,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[q,[Te(X)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[q,[Te(Z)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[q,[X,Te(Z)],(r,[e,t])=>t.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[q,[X,Te(Z)],(r,[e,t])=>(function(n,i,s,o){for(;s<=o;){const a=s+o>>1;if(i[a]===n)return!0;i[a]>n?o=a-1:s=a+1}return!1})(r.properties()[e.value],t.value,0,t.value.length-1)],all:{type:q,overloads:[[[q,q],(r,[e,t])=>e.evaluate(r)&&t.evaluate(r)],[Et(q),(r,e)=>{for(const t of e)if(!t.evaluate(r))return!1;return!0}]]},any:{type:q,overloads:[[[q,q],(r,[e,t])=>e.evaluate(r)||t.evaluate(r)],[Et(q),(r,e)=>{for(const t of e)if(t.evaluate(r))return!0;return!1}]]},"!":[q,[q],(r,[e])=>!e.evaluate(r)],"is-supported-script":[q,[X],(r,[e])=>{const t=r.globals&&r.globals.isSupportedScript;return!t||t(e.evaluate(r))}],upcase:[X,[X],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[X,[X],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[X,Et(Z),(r,e)=>e.map((t=>zr(t.evaluate(r)))).join("")],"resolved-locale":[X,[un],(r,[e])=>e.evaluate(r).resolvedLocale()]});class Gi{constructor(e,t){var n;this.expression=e,this._warningHistory={},this._evaluator=new Oo,this._defaultValue=t?(n=t).type==="color"&&Tn(n.default)?new Q(0,0,0,0):n.type==="color"?Q.parse(n.default)||null:n.type==="padding"?Fe.parse(n.default)||null:n.type==="variableAnchorOffsetCollection"?Ne.parse(n.default)||null:n.default===void 0?null:n.default:null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,n,i,s,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,i,s,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o||null;try{const a=this.expression.evaluate(this._evaluator);if(a==null||typeof a=="number"&&a!=a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new fe(`Expected value to be one of ${Object.keys(this._enumValues).map((l=>JSON.stringify(l))).join(", ")}, but found ${JSON.stringify(a)} instead.`);return a}catch(a){return this._warningHistory[a.message]||(this._warningHistory[a.message]=!0,typeof console<"u"&&console.warn(a.message)),this._defaultValue}}}function En(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Qt}function rr(r,e){const t=new dn(Qt,Cn,[],e?(function(i){const s={color:He,string:X,number:P,enum:X,boolean:q,formatted:Sr,padding:cn,resolvedImage:kr,variableAnchorOffsetCollection:hn};return i.type==="array"?Te(s[i.value]||Z,i.length):s[i.type]})(e):void 0),n=t.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?oa(new Gi(n,e)):er(t.errors)}class Xi{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!Tr(t.expression)}evaluateWithoutErrorHandling(e,t,n,i,s,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,s,o)}evaluate(e,t,n,i,s,o){return this._styleExpression.evaluate(e,t,n,i,s,o)}}class Hi{constructor(e,t,n,i){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!Tr(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,n,i,s,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,s,o)}evaluate(e,t,n,i,s,o){return this._styleExpression.evaluate(e,t,n,i,s,o)}interpolationFactor(e,t,n){return this.interpolationType?qe.interpolationFactor(this.interpolationType,e,t,n):0}}function ca(r,e){const t=rr(r,e);if(t.result==="error")return t;const n=t.value.expression,i=Bn(n);if(!i&&!tr(e))return er([new tt("","data expressions not supported")]);const s=Vn(n,["zoom"]);if(!s&&!aa(e))return er([new tt("","zoom expressions not supported")]);const o=Dn(n);return o||s?o instanceof tt?er([o]):o instanceof qe&&!Zi(e)?er([new tt("",'"interpolate" expressions cannot be used with this property')]):oa(o?new Hi(i?"camera":"composite",t.value,o.labels,o instanceof qe?o.interpolation:void 0):new Xi(i?"constant":"source",t.value)):er([new tt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Fn{constructor(e,t){this._parameters=e,this._specification=t,Xt(this,la(this._parameters,this._specification))}static deserialize(e){return new Fn(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Dn(r){let e=null;if(r instanceof yn)e=Dn(r.result);else if(r instanceof wn){for(const t of r.args)if(e=Dn(t),e)break}else(r instanceof Pr||r instanceof qe)&&r.input instanceof Ze&&r.input.name==="zoom"&&(e=r);return e instanceof tt||r.eachChild((t=>{const n=Dn(t);n instanceof tt?e=n:!e&&n?e=new tt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new tt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Yi(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Yi(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const sh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ji(r){if(r==null)return{filter:()=>!0,needGeometry:!1};Yi(r)||(r=$n(r));const e=rr(r,sh);if(e.result==="error")throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return{filter:(t,n,i)=>e.value.evaluate(t,n,{},i),needGeometry:ha(r)}}function oh(r,e){return r<e?-1:r>e?1:0}function ha(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(ha(r[e]))return!0;return!1}function $n(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Ki(r[1],r[2],"=="):e==="!="?Ln(Ki(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ki(r[1],r[2],e):e==="any"?(t=r.slice(1),["any"].concat(t.map($n))):e==="all"?["all"].concat(r.slice(1).map($n)):e==="none"?["all"].concat(r.slice(1).map($n).map(Ln)):e==="in"?pa(r[1],r.slice(2)):e==="!in"?Ln(pa(r[1],r.slice(2))):e==="has"?fa(r[1]):e!=="!has"||Ln(fa(r[1]));var t}function Ki(r,e,t){switch(r){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,r,e]}}function pa(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",r,["literal",e.sort(oh)]]:["filter-in-small",r,["literal",e]]}}function fa(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Ln(r){return["!",r]}function Wi(r){const e=typeof r;if(e==="number"||e==="boolean"||e==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let i="[";for(const s of r)i+=`${Wi(s)},`;return`${i}]`}const t=Object.keys(r).sort();let n="{";for(let i=0;i<t.length;i++)n+=`${JSON.stringify(t[i])}:${Wi(r[t[i]])},`;return`${n}}`}function ah(r){let e="";for(const t of kc)e+=`/${Wi(r[t])}`;return e}function da(r){const e=r.value;return e?[new z(r.key,e,"constants have been deprecated as of v8")]:[]}function he(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Ft(r){if(Array.isArray(r))return r.map(Ft);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const t in r)e[t]=Ft(r[t]);return e}return he(r)}function Ge(r){const e=r.key,t=r.value,n=r.valueSpec||{},i=r.objectElementValidators||{},s=r.style,o=r.styleSpec,a=r.validateSpec;let l=[];const u=J(t);if(u!=="object")return[new z(e,t,`object expected, ${u} found`)];for(const c in t){const h=c.split(".")[0],p=n[h]||n["*"];let f;if(i[h])f=i[h];else if(n[h])f=a;else if(i["*"])f=i["*"];else{if(!n["*"]){l.push(new z(e,t[c],`unknown property "${c}"`));continue}f=a}l=l.concat(f({key:(e&&`${e}.`)+c,value:t[c],valueSpec:p,style:s,styleSpec:o,object:t,objectKey:c,validateSpec:a},t))}for(const c in n)i[c]||n[c].required&&n[c].default===void 0&&t[c]===void 0&&l.push(new z(e,t,`missing required property "${c}"`));return l}function Qi(r){const e=r.value,t=r.valueSpec,n=r.style,i=r.styleSpec,s=r.key,o=r.arrayElementValidator||r.validateSpec;if(J(e)!=="array")return[new z(s,e,`array expected, ${J(e)} found`)];if(t.length&&e.length!==t.length)return[new z(s,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new z(s,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let a={type:t.value,values:t.values};i.$version<7&&(a.function=t.function),J(t.value)==="object"&&(a=t.value);let l=[];for(let u=0;u<e.length;u++)l=l.concat(o({array:e,arrayIndex:u,value:e[u],valueSpec:a,validateSpec:r.validateSpec,style:n,styleSpec:i,key:`${s}[${u}]`}));return l}function es(r){const e=r.key,t=r.value,n=r.valueSpec;let i=J(t);return i==="number"&&t!=t&&(i="NaN"),i!=="number"?[new z(e,t,`number expected, ${i} found`)]:"minimum"in n&&t<n.minimum?[new z(e,t,`${t} is less than the minimum value ${n.minimum}`)]:"maximum"in n&&t>n.maximum?[new z(e,t,`${t} is greater than the maximum value ${n.maximum}`)]:[]}function ya(r){const e=r.valueSpec,t=he(r.value.type);let n,i,s,o={};const a=t!=="categorical"&&r.value.property===void 0,l=!a,u=J(r.value.stops)==="array"&&J(r.value.stops[0])==="array"&&J(r.value.stops[0][0])==="object",c=Ge({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(f){if(t==="identity")return[new z(f.key,f.value,'identity function may not have a "stops" property')];let d=[];const y=f.value;return d=d.concat(Qi({key:f.key,value:y,valueSpec:f.valueSpec,validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec,arrayElementValidator:h})),J(y)==="array"&&y.length===0&&d.push(new z(f.key,y,"array must have at least one stop")),d},default:function(f){return f.validateSpec({key:f.key,value:f.value,valueSpec:e,validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec})}}});return t==="identity"&&a&&c.push(new z(r.key,r.value,'missing required property "property"')),t==="identity"||r.value.stops||c.push(new z(r.key,r.value,'missing required property "stops"')),t==="exponential"&&r.valueSpec.expression&&!Zi(r.valueSpec)&&c.push(new z(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(l&&!tr(r.valueSpec)?c.push(new z(r.key,r.value,"property functions not supported")):a&&!aa(r.valueSpec)&&c.push(new z(r.key,r.value,"zoom functions not supported"))),t!=="categorical"&&!u||r.value.property!==void 0||c.push(new z(r.key,r.value,'"property" property is required')),c;function h(f){let d=[];const y=f.value,m=f.key;if(J(y)!=="array")return[new z(m,y,`array expected, ${J(y)} found`)];if(y.length!==2)return[new z(m,y,`array length 2 expected, length ${y.length} found`)];if(u){if(J(y[0])!=="object")return[new z(m,y,`object expected, ${J(y[0])} found`)];if(y[0].zoom===void 0)return[new z(m,y,"object stop key must have zoom")];if(y[0].value===void 0)return[new z(m,y,"object stop key must have value")];if(s&&s>he(y[0].zoom))return[new z(m,y[0].zoom,"stop zoom values must appear in ascending order")];he(y[0].zoom)!==s&&(s=he(y[0].zoom),i=void 0,o={}),d=d.concat(Ge({key:`${m}[0]`,value:y[0],valueSpec:{zoom:{}},validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{zoom:es,value:p}}))}else d=d.concat(p({key:`${m}[0]`,value:y[0],validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec},y));return En(Ft(y[1]))?d.concat([new z(`${m}[1]`,y[1],"expressions are not allowed in function stops.")]):d.concat(f.validateSpec({key:`${m}[1]`,value:y[1],valueSpec:e,validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec}))}function p(f,d){const y=J(f.value),m=he(f.value),g=f.value!==null?f.value:d;if(n){if(y!==n)return[new z(f.key,g,`${y} stop domain type must match previous stop domain type ${n}`)]}else n=y;if(y!=="number"&&y!=="string"&&y!=="boolean")return[new z(f.key,g,"stop domain value must be a number, string, or boolean")];if(y!=="number"&&t!=="categorical"){let x=`number expected, ${y} found`;return tr(e)&&t===void 0&&(x+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new z(f.key,g,x)]}return t!=="categorical"||y!=="number"||isFinite(m)&&Math.floor(m)===m?t!=="categorical"&&y==="number"&&i!==void 0&&m<i?[new z(f.key,g,"stop domain values must appear in ascending order")]:(i=m,t==="categorical"&&m in o?[new z(f.key,g,"stop domain values must be unique")]:(o[m]=!0,[])):[new z(f.key,g,`integer expected, found ${m}`)]}}function nr(r){const e=(r.expressionContext==="property"?ca:rr)(Ft(r.value),r.valueSpec);if(e.result==="error")return e.value.map((n=>new z(`${r.key}${n.key}`,r.value,n.message)));const t=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!t.outputDefined())return[new z(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Tr(t))return[new z(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Tr(t))return[new z(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Vn(t,["zoom","feature-state"]))return[new z(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Bn(t))return[new z(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fr(r){const e=r.key,t=r.value,n=r.valueSpec,i=[];return Array.isArray(n.values)?n.values.indexOf(he(t))===-1&&i.push(new z(e,t,`expected one of [${n.values.join(", ")}], ${JSON.stringify(t)} found`)):Object.keys(n.values).indexOf(he(t))===-1&&i.push(new z(e,t,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(t)} found`)),i}function ts(r){return Yi(Ft(r.value))?nr(Xt({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ma(r)}function ma(r){const e=r.value,t=r.key;if(J(e)!=="array")return[new z(t,e,`array expected, ${J(e)} found`)];const n=r.styleSpec;let i,s=[];if(e.length<1)return[new z(t,e,"filter array must have at least 1 element")];switch(s=s.concat(Fr({key:`${t}[0]`,value:e[0],valueSpec:n.filter_operator,style:r.style,styleSpec:r.styleSpec})),he(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&he(e[1])==="$type"&&s.push(new z(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&s.push(new z(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(i=J(e[1]),i!=="string"&&s.push(new z(`${t}[1]`,e[1],`string expected, ${i} found`)));for(let o=2;o<e.length;o++)i=J(e[o]),he(e[1])==="$type"?s=s.concat(Fr({key:`${t}[${o}]`,value:e[o],valueSpec:n.geometry_type,style:r.style,styleSpec:r.styleSpec})):i!=="string"&&i!=="number"&&i!=="boolean"&&s.push(new z(`${t}[${o}]`,e[o],`string, number, or boolean expected, ${i} found`));break;case"any":case"all":case"none":for(let o=1;o<e.length;o++)s=s.concat(ma({key:`${t}[${o}]`,value:e[o],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":i=J(e[1]),e.length!==2?s.push(new z(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):i!=="string"&&s.push(new z(`${t}[1]`,e[1],`string expected, ${i} found`))}return s}function ga(r,e){const t=r.key,n=r.validateSpec,i=r.style,s=r.styleSpec,o=r.value,a=r.objectKey,l=s[`${e}_${r.layerType}`];if(!l)return[];const u=a.match(/^(.*)-transition$/);if(e==="paint"&&u&&l[u[1]]&&l[u[1]].transition)return n({key:t,value:o,valueSpec:s.transition,style:i,styleSpec:s});const c=r.valueSpec||l[a];if(!c)return[new z(t,o,`unknown property "${a}"`)];let h;if(J(o)==="string"&&tr(c)&&!c.tokens&&(h=/^{([^}]+)}$/.exec(o)))return[new z(t,o,`"${a}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(h[1])} }\`.`)];const p=[];return r.layerType==="symbol"&&(a==="text-field"&&i&&!i.glyphs&&p.push(new z(t,o,'use of "text-field" requires a style "glyphs" property')),a==="text-font"&&Tn(Ft(o))&&he(o.type)==="identity"&&p.push(new z(t,o,'"text-font" does not support identity functions'))),p.concat(n({key:r.key,value:o,valueSpec:c,style:i,styleSpec:s,expressionContext:"property",propertyType:e,propertyKey:a}))}function xa(r){return ga(r,"paint")}function va(r){return ga(r,"layout")}function ba(r){let e=[];const t=r.value,n=r.key,i=r.style,s=r.styleSpec;t.type||t.ref||e.push(new z(n,t,'either "type" or "ref" is required'));let o=he(t.type);const a=he(t.ref);if(t.id){const l=he(t.id);for(let u=0;u<r.arrayIndex;u++){const c=i.layers[u];he(c.id)===l&&e.push(new z(n,t.id,`duplicate layer id "${t.id}", previously used at line ${c.id.__line__}`))}}if("ref"in t){let l;["type","source","source-layer","filter","layout"].forEach((u=>{u in t&&e.push(new z(n,t[u],`"${u}" is prohibited for ref layers`))})),i.layers.forEach((u=>{he(u.id)===a&&(l=u)})),l?l.ref?e.push(new z(n,t.ref,"ref cannot reference another ref layer")):o=he(l.type):e.push(new z(n,t.ref,`ref layer "${a}" not found`))}else if(o!=="background")if(t.source){const l=i.sources&&i.sources[t.source],u=l&&he(l.type);l?u==="vector"&&o==="raster"?e.push(new z(n,t.source,`layer "${t.id}" requires a raster source`)):u!=="raster-dem"&&o==="hillshade"?e.push(new z(n,t.source,`layer "${t.id}" requires a raster-dem source`)):u==="raster"&&o!=="raster"?e.push(new z(n,t.source,`layer "${t.id}" requires a vector source`)):u!=="vector"||t["source-layer"]?u==="raster-dem"&&o!=="hillshade"?e.push(new z(n,t.source,"raster-dem source can only be used with layer type 'hillshade'.")):o!=="line"||!t.paint||!t.paint["line-gradient"]||u==="geojson"&&l.lineMetrics||e.push(new z(n,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new z(n,t,`layer "${t.id}" must specify a "source-layer"`)):e.push(new z(n,t.source,`source "${t.source}" not found`))}else e.push(new z(n,t,'missing required property "source"'));return e=e.concat(Ge({key:n,value:t,valueSpec:s.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${n}.type`,value:t.type,valueSpec:s.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:t,objectKey:"type"}),filter:ts,layout:l=>Ge({layer:t,key:l.key,value:l.value,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":u=>va(Xt({layerType:o},u))}}),paint:l=>Ge({layer:t,key:l.key,value:l.value,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":u=>xa(Xt({layerType:o},u))}})}})),e}function Dt(r){const e=r.value,t=r.key,n=J(e);return n!=="string"?[new z(t,e,`string expected, ${n} found`)]:[]}const wa={promoteId:function({key:r,value:e}){if(J(e)==="string")return Dt({key:r,value:e});{const t=[];for(const n in e)t.push(...Dt({key:`${r}.${n}`,value:e[n]}));return t}}};function _a(r){const e=r.value,t=r.key,n=r.styleSpec,i=r.style,s=r.validateSpec;if(!e.type)return[new z(t,e,'"type" is required')];const o=he(e.type);let a;switch(o){case"vector":case"raster":return a=Ge({key:t,value:e,valueSpec:n[`source_${o.replace("-","_")}`],style:r.style,styleSpec:n,objectElementValidators:wa,validateSpec:s}),a;case"raster-dem":return a=(function(l){var u;const c=(u=l.sourceName)!==null&&u!==void 0?u:"",h=l.value,p=l.styleSpec,f=p.source_raster_dem,d=l.style;let y=[];const m=J(h);if(h===void 0)return y;if(m!=="object")return y.push(new z("source_raster_dem",h,`object expected, ${m} found`)),y;const g=he(h.encoding)==="custom",x=["redFactor","greenFactor","blueFactor","baseShift"],v=l.value.encoding?`"${l.value.encoding}"`:"Default";for(const w in h)!g&&x.includes(w)?y.push(new z(w,h[w],`In "${c}": "${w}" is only valid when "encoding" is set to "custom". ${v} encoding found`)):f[w]?y=y.concat(l.validateSpec({key:w,value:h[w],valueSpec:f[w],validateSpec:l.validateSpec,style:d,styleSpec:p})):y.push(new z(w,h[w],`unknown property "${w}"`));return y})({sourceName:t,value:e,style:r.style,styleSpec:n,validateSpec:s}),a;case"geojson":if(a=Ge({key:t,value:e,valueSpec:n.source_geojson,style:i,styleSpec:n,validateSpec:s,objectElementValidators:wa}),e.cluster)for(const l in e.clusterProperties){const[u,c]=e.clusterProperties[l],h=typeof u=="string"?[u,["accumulated"],["get",l]]:u;a.push(...nr({key:`${t}.${l}.map`,value:c,expressionContext:"cluster-map"})),a.push(...nr({key:`${t}.${l}.reduce`,value:h,expressionContext:"cluster-reduce"}))}return a;case"video":return Ge({key:t,value:e,valueSpec:n.source_video,style:i,validateSpec:s,styleSpec:n});case"image":return Ge({key:t,value:e,valueSpec:n.source_image,style:i,validateSpec:s,styleSpec:n});case"canvas":return[new z(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fr({key:`${t}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Sa(r){const e=r.value,t=r.styleSpec,n=t.light,i=r.style;let s=[];const o=J(e);if(e===void 0)return s;if(o!=="object")return s=s.concat([new z("light",e,`object expected, ${o} found`)]),s;for(const a in e){const l=a.match(/^(.*)-transition$/);s=s.concat(l&&n[l[1]]&&n[l[1]].transition?r.validateSpec({key:a,value:e[a],valueSpec:t.transition,validateSpec:r.validateSpec,style:i,styleSpec:t}):n[a]?r.validateSpec({key:a,value:e[a],valueSpec:n[a],validateSpec:r.validateSpec,style:i,styleSpec:t}):[new z(a,e[a],`unknown property "${a}"`)])}return s}function ka(r){const e=r.value,t=r.styleSpec,n=t.sky,i=r.style,s=J(e);if(e===void 0)return[];if(s!=="object")return[new z("sky",e,`object expected, ${s} found`)];let o=[];for(const a in e)o=o.concat(n[a]?r.validateSpec({key:a,value:e[a],valueSpec:n[a],style:i,styleSpec:t}):[new z(a,e[a],`unknown property "${a}"`)]);return o}function Aa(r){const e=r.value,t=r.styleSpec,n=t.terrain,i=r.style;let s=[];const o=J(e);if(e===void 0)return s;if(o!=="object")return s=s.concat([new z("terrain",e,`object expected, ${o} found`)]),s;for(const a in e)s=s.concat(n[a]?r.validateSpec({key:a,value:e[a],valueSpec:n[a],validateSpec:r.validateSpec,style:i,styleSpec:t}):[new z(a,e[a],`unknown property "${a}"`)]);return s}function Ia(r){let e=[];const t=r.value,n=r.key;if(Array.isArray(t)){const i=[],s=[];for(const o in t)t[o].id&&i.includes(t[o].id)&&e.push(new z(n,t,`all the sprites' ids must be unique, but ${t[o].id} is duplicated`)),i.push(t[o].id),t[o].url&&s.includes(t[o].url)&&e.push(new z(n,t,`all the sprites' URLs must be unique, but ${t[o].url} is duplicated`)),s.push(t[o].url),e=e.concat(Ge({key:`${n}[${o}]`,value:t[o],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return e}return Dt({key:n,value:t})}const Ma={"*":()=>[],array:Qi,boolean:function(r){const e=r.value,t=r.key,n=J(e);return n!=="boolean"?[new z(t,e,`boolean expected, ${n} found`)]:[]},number:es,color:function(r){const e=r.key,t=r.value,n=J(t);return n!=="string"?[new z(e,t,`color expected, ${n} found`)]:Q.parse(String(t))?[]:[new z(e,t,`color expected, "${t}" found`)]},constants:da,enum:Fr,filter:ts,function:ya,layer:ba,object:Ge,source:_a,light:Sa,sky:ka,terrain:Aa,projection:function(r){const e=r.value,t=r.styleSpec,n=t.projection,i=r.style,s=J(e);if(e===void 0)return[];if(s!=="object")return[new z("projection",e,`object expected, ${s} found`)];let o=[];for(const a in e)o=o.concat(n[a]?r.validateSpec({key:a,value:e[a],valueSpec:n[a],style:i,styleSpec:t}):[new z(a,e[a],`unknown property "${a}"`)]);return o},string:Dt,formatted:function(r){return Dt(r).length===0?[]:nr(r)},resolvedImage:function(r){return Dt(r).length===0?[]:nr(r)},padding:function(r){const e=r.key,t=r.value;if(J(t)==="array"){if(t.length<1||t.length>4)return[new z(e,t,`padding requires 1 to 4 values; ${t.length} values found`)];const n={type:"number"};let i=[];for(let s=0;s<t.length;s++)i=i.concat(r.validateSpec({key:`${e}[${s}]`,value:t[s],validateSpec:r.validateSpec,valueSpec:n}));return i}return es({key:e,value:t,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const e=r.key,t=r.value,n=J(t),i=r.styleSpec;if(n!=="array"||t.length<1||t.length%2!=0)return[new z(e,t,"variableAnchorOffsetCollection requires a non-empty array of even length")];let s=[];for(let o=0;o<t.length;o+=2)s=s.concat(Fr({key:`${e}[${o}]`,value:t[o],valueSpec:i.layout_symbol["text-anchor"]})),s=s.concat(Qi({key:`${e}[${o+1}]`,value:t[o+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:i}));return s},sprite:Ia};function On(r){const e=r.value,t=r.valueSpec,n=r.styleSpec;return r.validateSpec=On,t.expression&&Tn(he(e))?ya(r):t.expression&&En(Ft(e))?nr(r):t.type&&Ma[t.type]?Ma[t.type](r):Ge(Xt({},r,{valueSpec:t.type?n[t.type]:t}))}function za(r){const e=r.value,t=r.key,n=Dt(r);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new z(t,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new z(t,e,'"glyphs" url must include a "{range}" token'))),n}function Je(r,e=_){let t=[];return t=t.concat(On({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,validateSpec:On,objectElementValidators:{glyphs:za,"*":()=>[]}})),r.constants&&(t=t.concat(da({key:"constants",value:r.constants}))),Pa(t)}function it(r){return function(e){return r({...e,validateSpec:On})}}function Pa(r){return[].concat(r).sort(((e,t)=>e.line-t.line))}function st(r){return function(...e){return Pa(r.apply(this,e))}}Je.source=st(it(_a)),Je.sprite=st(it(Ia)),Je.glyphs=st(it(za)),Je.light=st(it(Sa)),Je.sky=st(it(ka)),Je.terrain=st(it(Aa)),Je.layer=st(it(ba)),Je.filter=st(it(ts)),Je.paintProperty=st(it(xa)),Je.layoutProperty=st(it(va));const Ca="AbortError";function Ba(){return new Error(Ca)}const rs={REGISTERED_PROTOCOLS:{}};function lh(r,e){rs.REGISTERED_PROTOCOLS[r]=e}function uh(r){delete rs.REGISTERED_PROTOCOLS[r]}const Va="global-dispatcher";class ns extends Error{constructor(e,t,n,i){super(`AJAXError: ${t} (${e}): ${n}`),this.status=e,this.statusText=t,this.url=n,this.body=i}}const Ta=()=>Gt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ea=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const n=rs.REGISTERED_PROTOCOLS[(t=r.url).substring(0,t.indexOf("://"))];if(n)return n(r,e);if(Gt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:Va},e)}var t;if(!(n=>/^file:/.test(n)||/^file:/.test(Ta())&&!/^\w+:/.test(n))(r.url)){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(n,i){return W(this,void 0,void 0,(function*(){const s=new Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,cache:n.cache,referrer:Ta(),signal:i.signal});n.type!=="json"||s.headers.has("Accept")||s.headers.set("Accept","application/json");const o=yield fetch(s);if(!o.ok){const u=yield o.blob();throw new ns(o.status,o.statusText,n.url,u)}let a;a=n.type==="arrayBuffer"||n.type==="image"?o.arrayBuffer():n.type==="json"?o.json():o.text();const l=yield a;if(i.signal.aborted)throw Ba();return{data:l,cacheControl:o.headers.get("Cache-Control"),expires:o.headers.get("Expires")}}))})(r,e);if(Gt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:Va},e)}return(function(n,i){return new Promise(((s,o)=>{var a;const l=new XMLHttpRequest;l.open(n.method||"GET",n.url,!0),n.type!=="arrayBuffer"&&n.type!=="image"||(l.responseType="arraybuffer");for(const u in n.headers)l.setRequestHeader(u,n.headers[u]);n.type==="json"&&(l.responseType="text",!((a=n.headers)===null||a===void 0)&&a.Accept||l.setRequestHeader("Accept","application/json")),l.withCredentials=n.credentials==="include",l.onerror=()=>{o(new Error(l.statusText))},l.onload=()=>{if(!i.signal.aborted)if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let u=l.response;if(n.type==="json")try{u=JSON.parse(l.response)}catch(c){return void o(c)}s({data:u,cacheControl:l.getResponseHeader("Cache-Control"),expires:l.getResponseHeader("Expires")})}else{const u=new Blob([l.response],{type:l.getResponseHeader("Content-Type")});o(new ns(l.status,l.statusText,n.url,u))}},i.signal.addEventListener("abort",(()=>{l.abort(),o(Ba())})),l.send(n.body)}))})(r,e)},ft={};function B(r,e,t={}){if(ft[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),ft[r]={klass:e,omit:t.omit||[],shallow:t.shallow||[]}}B("Object",Object),B("TransferableGridIndex",wr),B("Color",Q),B("Error",Error),B("AJAXError",ns),B("ResolvedImage",Ue),B("StylePropertyFunction",Fn),B("StyleExpression",Gi,{omit:["_evaluator"]}),B("ZoomDependentExpression",Hi),B("ZoomConstantExpression",Xi),B("CompoundExpression",Ze,{omit:["_evaluate"]});for(const r in Qt)Qt[r]._classRegistryKey||B(`Expression_${r}`,Qt[r]);function Fa(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function is(r){return r.$name||r.constructor._classRegistryKey}function Da(r){return!(function(e){if(e===null||typeof e!="object")return!1;const t=is(e);return!(!t||t==="Object")})(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||Fa(r)||xi(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function Dr(r,e){if(Da(r))return(Fa(r)||xi(r))&&e&&e.push(r),ArrayBuffer.isView(r)&&e&&e.push(r.buffer),r instanceof ImageData&&e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const s=[];for(const o of r)s.push(Dr(o,e));return s}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const t=is(r);if(!t)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!ft[t])throw new Error(`${t} is not registered.`);const{klass:n}=ft[t],i=n.serialize?n.serialize(r,e):{};if(n.serialize){if(e&&i===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const s in r){if(!r.hasOwnProperty(s)||ft[t].omit.indexOf(s)>=0)continue;const o=r[s];i[s]=ft[t].shallow.indexOf(s)>=0?o:Dr(o,e)}r instanceof Error&&(i.message=r.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return t!=="Object"&&(i.$name=t),i}function $r(r){if(Da(r))return r;if(Array.isArray(r))return r.map($r);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const e=is(r)||"Object";if(!ft[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:t}=ft[e];if(!t)throw new Error(`can't deserialize unregistered class ${e}`);if(t.deserialize)return t.deserialize(r);const n=Object.create(t.prototype);for(const i of Object.keys(r)){if(i==="$name")continue;const s=r[i];n[i]=ft[e].shallow.indexOf(i)>=0?s:$r(s)}return n}class ch{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}class hh{constructor(e,t){this.target=e,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new ch((()=>this.process())),this.subscription=(function(n,i,s,o){return n.addEventListener(i,s,!1),{unsubscribe:()=>{n.removeEventListener(i,s,!1)}}})(this.target,"message",(n=>this.receive(n))),this.globalScope=Gt(self)?e:window}registerMessageHandler(e,t){this.messageHandlers[e]=t}sendAsync(e,t){return new Promise(((n,i)=>{const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[s]={resolve:n,reject:i},t&&t.signal.addEventListener("abort",(()=>{delete this.resolveRejects[s];const l={id:s,type:"<cancel>",origin:location.origin,targetMapId:e.targetMapId,sourceMapId:this.mapId};this.target.postMessage(l)}),{once:!0});const o=[],a=Object.assign(Object.assign({},e),{id:s,sourceMapId:this.mapId,origin:location.origin,data:Dr(e.data,o)});this.target.postMessage(a,{transfer:o})}))}receive(e){const t=e.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const i=this.abortControllers[n];return delete this.abortControllers[n],void(i&&i.abort())}if(Gt(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(e,t)}processTask(e,t){return W(this,void 0,void 0,(function*(){if(t.type==="<response>"){const s=this.resolveRejects[e];return delete this.resolveRejects[e],s?void(t.error?s.reject($r(t.error)):s.resolve($r(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(e,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=$r(t.data),i=new AbortController;this.abortControllers[e]=i;try{const s=yield this.messageHandlers[t.type](t.sourceMapId,n,i);this.completeTask(e,null,s)}catch(s){this.completeTask(e,s)}}))}completeTask(e,t,n){const i=[];delete this.abortControllers[e];const s={id:e,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Dr(t):null,data:Dr(n,i)};this.target.postMessage(s,{transfer:i})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}}function $a(r,e,t){t[r]&&t[r].indexOf(e)!==-1||(t[r]=t[r]||[],t[r].push(e))}function ss(r,e,t){if(t&&t[r]){const n=t[r].indexOf(e);n!==-1&&t[r].splice(n,1)}}class La{constructor(e,t={}){et(this,t),this.type=e}}class Oa extends La{constructor(e,t={}){super("error",et({error:e},t))}}class ph{on(e,t){return this._listeners=this._listeners||{},$a(e,t,this._listeners),this}off(e,t){return ss(e,t,this._listeners),ss(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},$a(e,t,this._oneTimeListeners),this):new Promise((n=>this.once(e,n)))}fire(e,t){typeof e=="string"&&(e=new La(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const i=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const a of i)a.call(this,e);const s=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const a of s)ss(n,a,this._oneTimeListeners),a.call(this,e);const o=this._eventedParent;o&&(et(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),o.fire(e))}else e instanceof Oa&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}const os=Je,fh=os.paintProperty,dh=os.layoutProperty;class yh{constructor(){this.first=!0}update(e,t){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const H={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function as(r){for(const e of r)if(us(e.charCodeAt(0)))return!0;return!1}function mh(r){for(const e of r)if(!xh(e.charCodeAt(0)))return!1;return!0}function ls(r){const e=r.map((t=>{try{return new RegExp(`\\p{sc=${t}}`,"u").source}catch{return null}})).filter((t=>t));return new RegExp(e.join("|"),"u")}const gh=ls(["Arab","Dupl","Mong","Ougr","Syrc"]);function xh(r){return!gh.test(String.fromCodePoint(r))}const ja=ls(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function us(r){return!(r!==746&&r!==747&&(r<4352||!(H["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||H["CJK Compatibility"](r)||H["CJK Strokes"](r)||!(!H["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||H["Enclosed CJK Letters and Months"](r)||H["Ideographic Description Characters"](r)||H.Kanbun(r)||H.Katakana(r)&&r!==12540||!(!H["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!H["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||H["Vertical Forms"](r)||H["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||ja.test(String.fromCodePoint(r)))))}function Ra(r){return!(us(r)||(function(e){return!!(H["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||H["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||H["Letterlike Symbols"](e)||H["Number Forms"](e)||H["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||H["Control Pictures"](e)&&e!==9251||H["Optical Character Recognition"](e)||H["Enclosed Alphanumerics"](e)||H["Geometric Shapes"](e)||H["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||H["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||H["CJK Symbols and Punctuation"](e)||H.Katakana(e)||H["Private Use Area"](e)||H["CJK Compatibility Forms"](e)||H["Small Form Variants"](e)||H["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(r))}const vh=ls(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Na(r){return vh.test(String.fromCodePoint(r))}function bh(r,e){return!(!e&&Na(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||H.Khmer(r))}function wh(r){for(const e of r)if(Na(e.charCodeAt(0)))return!0;return!1}const Ce=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class ie{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new yh,this.transition={})}isSupportedScript(e){return(function(t,n){for(const i of t)if(!bh(i.charCodeAt(0),n))return!1;return!0})(e,Ce.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*t}}}class jn{constructor(e,t){this.property=e,this.value=t,this.expression=(function(n,i){if(Tn(n))return new Fn(n,i);if(En(n)){const s=ca(n,i);if(s.result==="error")throw new Error(s.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return s.value}{let s=n;return i.type==="color"&&typeof n=="string"?s=Q.parse(n):i.type!=="padding"||typeof n!="number"&&!Array.isArray(n)?i.type==="variableAnchorOffsetCollection"&&Array.isArray(n)&&(s=Ne.parse(n)):s=Fe.parse(n),{kind:"constant",evaluate:()=>s}}})(t===void 0?e.specification.default:t,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class cs{constructor(e){this.property=e,this.value=new jn(e,void 0)}transitioned(e,t){return new Ua(this.property,this.value,t,et({},e.transition,this.transition),e.now)}untransitioned(){return new Ua(this.property,this.value,null,{},0)}}class _h{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return vt(this._values[e].value.value)}setValue(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new cs(this._values[e].property)),this._values[e].value=new jn(this._values[e].property,t===null?void 0:vt(t))}getTransition(e){return vt(this._values[e].transition)}setTransition(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new cs(this._values[e].property)),this._values[e].transition=vt(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);n!==void 0&&(e[t]=n);const i=this.getTransition(t);i!==void 0&&(e[`${t}-transition`]=i)}return e}transitioned(e,t){const n=new qa(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(e,t._values[i]);return n}untransitioned(){const e=new qa(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Ua{constructor(e,t,n,i,s){this.property=e,this.value=t,this.begin=s+i.delay||0,this.end=this.begin+i.duration||0,e.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const i=e.now||0,s=this.value.possiblyEvaluate(e,t,n),o=this.prior;if(o){if(i>this.end)return this.prior=null,s;if(this.value.isDataDriven())return this.prior=null,s;if(i<this.begin)return o.possiblyEvaluate(e,t,n);{const a=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,n),s,(function(l){if(l<=0)return 0;if(l>=1)return 1;const u=l*l,c=u*l;return 4*(l<.5?c:3*(l-u)+c-.75)})(a))}}return s}}class qa{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const i=new Rn(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].possiblyEvaluate(e,t,n);return i}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Sh{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return vt(this._values[e].value)}setValue(e,t){this._values[e]=new jn(this._values[e].property,t===null?void 0:vt(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);n!==void 0&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const i=new Rn(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].possiblyEvaluate(e,t,n);return i}}class ot{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,t,n,i){return this.property.evaluate(this.value,this.parameters,e,t,n,i)}}class Rn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ${constructor(e){this.specification=e}possiblyEvaluate(e,t){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(t)}interpolate(e,t,n){const i=rt[this.specification.type];return i?i(e,t,n):e}}class O{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,i){return new ot(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},n,i)}:e.expression,t)}interpolate(e,t,n){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new ot(this,{kind:"constant",value:void 0},e.parameters);const i=rt[this.specification.type];if(i){const s=i(e.value.value,t.value.value,n);return new ot(this,{kind:"constant",value:s},e.parameters)}return e}evaluate(e,t,n,i,s,o){return e.kind==="constant"?e.value:e.evaluate(t,n,i,s,o)}}class Nn extends O{possiblyEvaluate(e,t,n,i){if(e.value===void 0)return new ot(this,{kind:"constant",value:void 0},t);if(e.expression.kind==="constant"){const s=e.expression.evaluate(t,null,{},n,i),o=e.property.specification.type==="resolvedImage"&&typeof s!="string"?s.name:s,a=this._calculate(o,o,o,t);return new ot(this,{kind:"constant",value:a},t)}if(e.expression.kind==="camera"){const s=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new ot(this,{kind:"constant",value:s},t)}return new ot(this,e.expression,t)}evaluate(e,t,n,i,s,o){if(e.kind==="source"){const a=e.evaluate(t,n,i,s,o);return this._calculate(a,a,a,t)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},n,i),e.evaluate({zoom:Math.floor(t.zoom)},n,i),e.evaluate({zoom:Math.floor(t.zoom)+1},n,i),t):e.value}_calculate(e,t,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class hs{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){if(e.value!==void 0){if(e.expression.kind==="constant"){const s=e.expression.evaluate(t,null,{},n,i);return this._calculate(s,s,s,t)}return this._calculate(e.expression.evaluate(new ie(Math.floor(t.zoom-1),t)),e.expression.evaluate(new ie(Math.floor(t.zoom),t)),e.expression.evaluate(new ie(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class ps{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){return!!e.expression.evaluate(t,null,{},n,i)}interpolate(){return!1}}class De{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const t in e){const n=e[t];n.specification.overridable&&this.overridableProperties.push(t);const i=this.defaultPropertyValues[t]=new jn(n,void 0),s=this.defaultTransitionablePropertyValues[t]=new cs(n);this.defaultTransitioningPropertyValues[t]=s.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=i.possiblyEvaluate({})}}}B("DataDrivenProperty",O),B("DataConstantProperty",$),B("CrossFadedDataDrivenProperty",Nn),B("CrossFadedProperty",hs),B("ColorRampProperty",ps);const Za="-transition";class at extends ph{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new Sh(t.layout)),t.paint)){this._transitionablePaint=new _h(t.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Rn(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,n={}){t!=null&&this._validate(dh,`layers.${this.id}.layout.${e}`,e,t,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return e.endsWith(Za)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,n={}){if(t!=null&&this._validate(fh,`layers.${this.id}.paint.${e}`,e,t,n))return!1;if(e.endsWith(Za))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;{const i=this._transitionablePaint._values[e],s=i.property.specification["property-type"]==="cross-faded-data-driven",o=i.value.isDataDriven(),a=i.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const l=this._transitionablePaint._values[e].value;return l.isDataDriven()||o||s||this._handleOverridablePaintPropertyUpdate(e,a,l)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),(function(t,n,i){const s={};for(const o in t)n.call(this,t[o],o,t)&&(s[o]=t[o]);return s})(e,((t,n)=>!(t===void 0||n==="layout"&&!Object.keys(t).length||n==="paint"&&!Object.keys(t).length)))}_validate(e,t,n,i,s={}){return(!s||s.validate!==!1)&&(function(o,a){let l=!1;if(a&&a.length)for(const u of a)o.fire(new Oa(new Error(u.message))),l=!0;return l})(this,e.call(os,{key:t,layerType:this.type,objectKey:n,value:i,styleSpec:_,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof ot&&tr(t.property.specification)&&(t.value.kind==="source"||t.value.kind==="composite")&&t.value.isStateDependent)return!0}return!1}}const kh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Lr{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class le{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function me(r,e=1){let t=0,n=0;return{members:r.map((i=>{const s=kh[i.type].BYTES_PER_ELEMENT,o=t=Ga(t,Math.max(e,s)),a=i.components||1;return n=Math.max(n,s),t+=s*a,{name:i.name,type:i.type,components:a,offset:o}})),size:Ga(t,Math.max(n,e)),alignment:e}}function Ga(r,e){return Math.ceil(r/e)*e}class Or extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.int16[i+0]=t,this.int16[i+1]=n,e}}Or.prototype.bytesPerElement=4,B("StructArrayLayout2i4",Or);class fs extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const s=3*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=i,e}}fs.prototype.bytesPerElement=6,B("StructArrayLayout3i6",fs);class Xa extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i)}emplace(e,t,n,i,s){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=i,this.int16[o+3]=s,e}}Xa.prototype.bytesPerElement=8,B("StructArrayLayout4i8",Xa);class ds extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,s,o)}emplace(e,t,n,i,s,o,a){const l=6*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.int16[l+2]=i,this.int16[l+3]=s,this.int16[l+4]=o,this.int16[l+5]=a,e}}ds.prototype.bytesPerElement=12,B("StructArrayLayout2i4i12",ds);class ys extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,s,o)}emplace(e,t,n,i,s,o,a){const l=4*e,u=8*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.uint8[u+4]=i,this.uint8[u+5]=s,this.uint8[u+6]=o,this.uint8[u+7]=a,e}}ys.prototype.bytesPerElement=8,B("StructArrayLayout2i4ub8",ys);class jr extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.float32[i+0]=t,this.float32[i+1]=n,e}}jr.prototype.bytesPerElement=8,B("StructArrayLayout2f8",jr);class ms extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,o,a,l,u,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,n,i,s,o,a,l,u,c)}emplace(e,t,n,i,s,o,a,l,u,c,h){const p=10*e;return this.uint16[p+0]=t,this.uint16[p+1]=n,this.uint16[p+2]=i,this.uint16[p+3]=s,this.uint16[p+4]=o,this.uint16[p+5]=a,this.uint16[p+6]=l,this.uint16[p+7]=u,this.uint16[p+8]=c,this.uint16[p+9]=h,e}}ms.prototype.bytesPerElement=20,B("StructArrayLayout10ui20",ms);class gs extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,o,a,l,u,c,h,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,n,i,s,o,a,l,u,c,h,p)}emplace(e,t,n,i,s,o,a,l,u,c,h,p,f){const d=12*e;return this.int16[d+0]=t,this.int16[d+1]=n,this.int16[d+2]=i,this.int16[d+3]=s,this.uint16[d+4]=o,this.uint16[d+5]=a,this.uint16[d+6]=l,this.uint16[d+7]=u,this.int16[d+8]=c,this.int16[d+9]=h,this.int16[d+10]=p,this.int16[d+11]=f,e}}gs.prototype.bytesPerElement=24,B("StructArrayLayout4i4ui4i24",gs);class xs extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const s=3*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=i,e}}xs.prototype.bytesPerElement=12,B("StructArrayLayout3f12",xs);class vs extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}vs.prototype.bytesPerElement=4,B("StructArrayLayout1ul4",vs);class bs extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,o,a,l,u){const c=this.length;return this.resize(c+1),this.emplace(c,e,t,n,i,s,o,a,l,u)}emplace(e,t,n,i,s,o,a,l,u,c){const h=10*e,p=5*e;return this.int16[h+0]=t,this.int16[h+1]=n,this.int16[h+2]=i,this.int16[h+3]=s,this.int16[h+4]=o,this.int16[h+5]=a,this.uint32[p+3]=l,this.uint16[h+8]=u,this.uint16[h+9]=c,e}}bs.prototype.bytesPerElement=20,B("StructArrayLayout6i1ul2ui20",bs);class ws extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,s,o)}emplace(e,t,n,i,s,o,a){const l=6*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.int16[l+2]=i,this.int16[l+3]=s,this.int16[l+4]=o,this.int16[l+5]=a,e}}ws.prototype.bytesPerElement=12,B("StructArrayLayout2i2i2i12",ws);class Ha extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,s)}emplace(e,t,n,i,s,o){const a=4*e,l=8*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=i,this.int16[l+6]=s,this.int16[l+7]=o,e}}Ha.prototype.bytesPerElement=16,B("StructArrayLayout2f1f2i16",Ha);class _s extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,s,o)}emplace(e,t,n,i,s,o,a){const l=16*e,u=4*e,c=8*e;return this.uint8[l+0]=t,this.uint8[l+1]=n,this.float32[u+1]=i,this.float32[u+2]=s,this.int16[c+6]=o,this.int16[c+7]=a,e}}_s.prototype.bytesPerElement=16,B("StructArrayLayout2ub2f2i16",_s);class Ss extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const s=3*e;return this.uint16[s+0]=t,this.uint16[s+1]=n,this.uint16[s+2]=i,e}}Ss.prototype.bytesPerElement=6,B("StructArrayLayout3ui6",Ss);class ks extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,o,a,l,u,c,h,p,f,d,y,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,t,n,i,s,o,a,l,u,c,h,p,f,d,y,m,g)}emplace(e,t,n,i,s,o,a,l,u,c,h,p,f,d,y,m,g,x){const v=24*e,w=12*e,b=48*e;return this.int16[v+0]=t,this.int16[v+1]=n,this.uint16[v+2]=i,this.uint16[v+3]=s,this.uint32[w+2]=o,this.uint32[w+3]=a,this.uint32[w+4]=l,this.uint16[v+10]=u,this.uint16[v+11]=c,this.uint16[v+12]=h,this.float32[w+7]=p,this.float32[w+8]=f,this.uint8[b+36]=d,this.uint8[b+37]=y,this.uint8[b+38]=m,this.uint32[w+10]=g,this.int16[v+22]=x,e}}ks.prototype.bytesPerElement=48,B("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ks);class As extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,o,a,l,u,c,h,p,f,d,y,m,g,x,v,w,b,S,A,C,M,I,V,E){const T=this.length;return this.resize(T+1),this.emplace(T,e,t,n,i,s,o,a,l,u,c,h,p,f,d,y,m,g,x,v,w,b,S,A,C,M,I,V,E)}emplace(e,t,n,i,s,o,a,l,u,c,h,p,f,d,y,m,g,x,v,w,b,S,A,C,M,I,V,E,T){const k=32*e,D=16*e;return this.int16[k+0]=t,this.int16[k+1]=n,this.int16[k+2]=i,this.int16[k+3]=s,this.int16[k+4]=o,this.int16[k+5]=a,this.int16[k+6]=l,this.int16[k+7]=u,this.uint16[k+8]=c,this.uint16[k+9]=h,this.uint16[k+10]=p,this.uint16[k+11]=f,this.uint16[k+12]=d,this.uint16[k+13]=y,this.uint16[k+14]=m,this.uint16[k+15]=g,this.uint16[k+16]=x,this.uint16[k+17]=v,this.uint16[k+18]=w,this.uint16[k+19]=b,this.uint16[k+20]=S,this.uint16[k+21]=A,this.uint16[k+22]=C,this.uint32[D+12]=M,this.float32[D+13]=I,this.float32[D+14]=V,this.uint16[k+30]=E,this.uint16[k+31]=T,e}}As.prototype.bytesPerElement=64,B("StructArrayLayout8i15ui1ul2f2ui64",As);class Un extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Un.prototype.bytesPerElement=4,B("StructArrayLayout1f4",Un);class Is extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const s=3*e;return this.uint16[6*e+0]=t,this.float32[s+1]=n,this.float32[s+2]=i,e}}Is.prototype.bytesPerElement=12,B("StructArrayLayout1ui2f12",Is);class Ms extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const s=4*e;return this.uint32[2*e+0]=t,this.uint16[s+2]=n,this.uint16[s+3]=i,e}}Ms.prototype.bytesPerElement=8,B("StructArrayLayout1ul2ui8",Ms);class zs extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,e}}zs.prototype.bytesPerElement=4,B("StructArrayLayout2ui4",zs);class Ya extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}Ya.prototype.bytesPerElement=2,B("StructArrayLayout1ui2",Ya);class Ps extends le{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i)}emplace(e,t,n,i,s){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.float32[o+3]=s,e}}Ps.prototype.bytesPerElement=16,B("StructArrayLayout4f16",Ps);class Ja extends Lr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new R(this.anchorPointX,this.anchorPointY)}}Ja.prototype.size=20;class Ka extends bs{get(e){return new Ja(this,e)}}B("CollisionBoxArray",Ka);class Wa extends Lr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Wa.prototype.size=48;class Qa extends ks{get(e){return new Wa(this,e)}}B("PlacedSymbolArray",Qa);class el extends Lr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}el.prototype.size=64;class tl extends As{get(e){return new el(this,e)}}B("SymbolInstanceArray",tl);class rl extends Un{getoffsetX(e){return this.float32[1*e+0]}}B("GlyphOffsetArray",rl);class nl extends fs{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}B("SymbolLineVertexArray",nl);class il extends Lr{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}il.prototype.size=12;class sl extends Is{get(e){return new il(this,e)}}B("TextAnchorOffsetArray",sl);class ol extends Lr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ol.prototype.size=8;class al extends Ms{get(e){return new ol(this,e)}}B("FeatureIndexArray",al);class Ah extends Or{}class Ih extends Or{}class Mh extends Or{}class zh extends ds{}class Ph extends ys{}class Ch extends jr{}class ir extends ms{}class Bh extends gs{}class Vh extends xs{}class Th extends vs{}class ll extends ws{}class Eh extends _s{}class Rr extends Ss{}class Cs extends zs{}const Fh=me([{name:"a_pos",components:2,type:"Int16"}],4),{members:Dh}=Fh;class ke{constructor(e=[]){this.segments=e}prepareSegment(e,t,n,i){let s=this.segments[this.segments.length-1];return e>ke.MAX_VERTEX_ARRAY_LENGTH&&Ve(`Max vertices per segment is ${ke.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!s||s.vertexLength+e>ke.MAX_VERTEX_ARRAY_LENGTH||s.sortKey!==i)&&(s={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},i!==void 0&&(s.sortKey=i),this.segments.push(s)),s}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,i){return new ke([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}function ul(r,e){return 256*(r=xr(Math.floor(r),0,255))+xr(Math.floor(e),0,255)}ke.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,B("SegmentVector",ke);const qn=me([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Zn={exports:{}},cl={exports:{}};cl.exports=function(r,e){var t,n,i,s,o,a,l,u;for(n=r.length-(t=3&r.length),i=e,o=3432918353,a=461845907,u=0;u<n;)l=255&r.charCodeAt(u)|(255&r.charCodeAt(++u))<<8|(255&r.charCodeAt(++u))<<16|(255&r.charCodeAt(++u))<<24,++u,i=27492+(65535&(s=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16);switch(l=0,t){case 3:l^=(255&r.charCodeAt(u+2))<<16;case 2:l^=(255&r.charCodeAt(u+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&r.charCodeAt(u)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return i^=r.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0};var $h=cl.exports,hl={exports:{}};hl.exports=function(r,e){for(var t,n=r.length,i=e^n,s=0;n>=4;)t=1540483477*(65535&(t=255&r.charCodeAt(s)|(255&r.charCodeAt(++s))<<8|(255&r.charCodeAt(++s))<<16|(255&r.charCodeAt(++s))<<24))+((1540483477*(t>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(t=1540483477*(65535&(t^=t>>>24))+((1540483477*(t>>>16)&65535)<<16)),n-=4,++s;switch(n){case 3:i^=(255&r.charCodeAt(s+2))<<16;case 2:i^=(255&r.charCodeAt(s+1))<<8;case 1:i=1540483477*(65535&(i^=255&r.charCodeAt(s)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0};var pl=$h,Lh=hl.exports;Zn.exports=pl,Zn.exports.murmur3=pl,Zn.exports.murmur2=Lh;var Bs=qt(Zn.exports);class Gn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,n,i){this.ids.push(fl(e)),this.positions.push(t,n,i)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const t=fl(e);let n=0,i=this.ids.length-1;for(;n<i;){const o=n+i>>1;this.ids[o]>=t?i=o:n=o+1}const s=[];for(;this.ids[n]===t;)s.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return s}static serialize(e,t){const n=new Float64Array(e.ids),i=new Uint32Array(e.positions);return Vs(n,i,0,n.length-1),t&&t.push(n.buffer,i.buffer),{ids:n,positions:i}}static deserialize(e){const t=new Gn;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function fl(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Bs(String(r))}function Vs(r,e,t,n){for(;t<n;){const i=r[t+n>>1];let s=t-1,o=n+1;for(;;){do s++;while(r[s]<i);do o--;while(r[o]>i);if(s>=o)break;Xn(r,s,o),Xn(e,3*s,3*o),Xn(e,3*s+1,3*o+1),Xn(e,3*s+2,3*o+2)}o-t<n-o?(Vs(r,e,t,o),t=o+1):(Vs(r,e,o+1,n),n=o)}}function Xn(r,e,t){const n=r[e];r[e]=r[t],r[t]=n}B("FeaturePositionMap",Gn);class Ts{constructor(e,t){this.gl=e.gl,this.location=t}}class Es extends Ts{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Oh extends Ts{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class jh extends Ts{constructor(e,t){super(e,t),this.current=Q.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}function Fs(r){return[ul(255*r.r,255*r.g),ul(255*r.b,255*r.a)]}class Nr{constructor(e,t,n){this.value=e,this.uniformNames=t.map((i=>`u_${i}`)),this.type=n}setUniform(e,t,n){e.set(n.constantOr(this.value))}getBinding(e,t,n){return this.type==="color"?new jh(e,t):new Es(e,t)}}class sr{constructor(e,t){this.uniformNames=t.map((n=>`u_${n}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr}setUniform(e,t,n,i){const s=i==="u_pattern_to"?this.patternTo:i==="u_pattern_from"?this.patternFrom:i==="u_pixel_ratio_to"?this.pixelRatioTo:i==="u_pixel_ratio_from"?this.pixelRatioFrom:null;s&&e.set(s)}getBinding(e,t,n){return n.substr(0,9)==="u_pattern"?new Oh(e,t):new Es(e,t)}}class dt{constructor(e,t,n,i){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map((s=>({name:`a_${s}`,type:"Float32",components:n==="color"?2:1,offset:0}))),this.paintVertexArray=new i}populatePaintArray(e,t,n,i,s){const o=this.paintVertexArray.length,a=this.expression.evaluate(new ie(0),t,{},i,[],s);this.paintVertexArray.resize(e),this._setPaintValue(o,e,a)}updatePaintArray(e,t,n,i){const s=this.expression.evaluate({zoom:0},n,i);this._setPaintValue(e,t,s)}_setPaintValue(e,t,n){if(this.type==="color"){const i=Fs(n);for(let s=e;s<t;s++)this.paintVertexArray.emplace(s,i[0],i[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ke{constructor(e,t,n,i,s,o){this.expression=e,this.uniformNames=t.map((a=>`u_${a}_t`)),this.type=n,this.useIntegerZoom=i,this.zoom=s,this.maxValue=0,this.paintVertexAttributes=t.map((a=>({name:`a_${a}`,type:"Float32",components:n==="color"?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,n,i,s){const o=this.expression.evaluate(new ie(this.zoom),t,{},i,[],s),a=this.expression.evaluate(new ie(this.zoom+1),t,{},i,[],s),l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(l,e,o,a)}updatePaintArray(e,t,n,i){const s=this.expression.evaluate({zoom:this.zoom},n,i),o=this.expression.evaluate({zoom:this.zoom+1},n,i);this._setPaintValue(e,t,s,o)}_setPaintValue(e,t,n,i){if(this.type==="color"){const s=Fs(n),o=Fs(i);for(let a=e;a<t;a++)this.paintVertexArray.emplace(a,s[0],s[1],o[0],o[1])}else{for(let s=e;s<t;s++)this.paintVertexArray.emplace(s,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){const n=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,i=xr(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(i)}getBinding(e,t,n){return new Es(e,t)}}class _t{constructor(e,t,n,i,s,o){this.expression=e,this.type=t,this.useIntegerZoom=n,this.zoom=i,this.layerId=o,this.zoomInPaintVertexArray=new s,this.zoomOutPaintVertexArray=new s}populatePaintArray(e,t,n){const i=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,i,s){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],s)}_setPaintValues(e,t,n,i){if(!i||!n)return;const{min:s,mid:o,max:a}=n,l=i[s],u=i[o],c=i[a];if(l&&u&&c)for(let h=e;h<t;h++)this.zoomInPaintVertexArray.emplace(h,u.tl[0],u.tl[1],u.br[0],u.br[1],l.tl[0],l.tl[1],l.br[0],l.br[1],u.pixelRatio,l.pixelRatio),this.zoomOutPaintVertexArray.emplace(h,u.tl[0],u.tl[1],u.br[0],u.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],u.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,qn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,qn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class dl{constructor(e,t,n){this.binders={},this._buffers=[];const i=[];for(const s in e.paint._values){if(!n(s))continue;const o=e.paint.get(s);if(!(o instanceof ot&&tr(o.property.specification)))continue;const a=Rh(s,e.type),l=o.value,u=o.property.specification.type,c=o.property.useIntegerZoom,h=o.property.specification["property-type"],p=h==="cross-faded"||h==="cross-faded-data-driven";if(l.kind==="constant")this.binders[s]=p?new sr(l.value,a):new Nr(l.value,a,u),i.push(`/u_${s}`);else if(l.kind==="source"||p){const f=yl(s,u,"source");this.binders[s]=p?new _t(l,u,c,t,f,e.id):new dt(l,a,u,f),i.push(`/a_${s}`)}else{const f=yl(s,u,"composite");this.binders[s]=new Ke(l,a,u,c,t,f),i.push(`/z_${s}`)}}this.cacheKey=i.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof dt||t instanceof Ke?t.maxValue:0}populatePaintArrays(e,t,n,i,s){for(const o in this.binders){const a=this.binders[o];(a instanceof dt||a instanceof Ke||a instanceof _t)&&a.populatePaintArray(e,t,n,i,s)}}setConstantPatternPositions(e,t){for(const n in this.binders){const i=this.binders[n];i instanceof sr&&i.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,n,i,s){let o=!1;for(const a in e){const l=t.getPositions(a);for(const u of l){const c=n.feature(u.index);for(const h in this.binders){const p=this.binders[h];if((p instanceof dt||p instanceof Ke||p instanceof _t)&&p.expression.isStateDependent===!0){const f=i.paint.get(h);p.expression=f.value,p.updatePaintArray(u.start,u.end,c,e[a],s),o=!0}}}}return o}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof Nr||n instanceof sr)&&e.push(...n.uniformNames.map((i=>`#define HAS_UNIFORM_${i}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof dt||n instanceof Ke)for(let i=0;i<n.paintVertexAttributes.length;i++)e.push(n.paintVertexAttributes[i].name);else if(n instanceof _t)for(let i=0;i<qn.members.length;i++)e.push(qn.members[i].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Nr||n instanceof sr||n instanceof Ke)for(const i of n.uniformNames)e.push(i)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const n=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Nr||s instanceof sr||s instanceof Ke){for(const o of s.uniformNames)if(t[o]){const a=s.getBinding(e,t[o],o);n.push({name:o,property:i,binding:a})}}}return n}setUniforms(e,t,n,i){for(const{name:s,property:o,binding:a}of t)this.binders[o].setUniform(a,i,n.get(o),s)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const n=this.binders[t];if(e&&n instanceof _t){const i=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;i&&this._buffers.push(i)}else(n instanceof dt||n instanceof Ke)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof dt||n instanceof Ke||n instanceof _t)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof dt||t instanceof Ke||t instanceof _t)&&t.destroy()}}}class $t{constructor(e,t,n=(()=>!0)){this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=new dl(i,t,n);this.needsUpload=!1,this._featureMap=new Gn,this._bufferOffset=0}populatePaintArrays(e,t,n,i,s,o){for(const a in this.programConfigurations)this.programConfigurations[a].populatePaintArrays(e,t,i,s,o);t.id!==void 0&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,i){for(const s of n)this.needsUpload=this.programConfigurations[s.id].updatePaintArrays(e,this._featureMap,t,s,i)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Rh(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function yl(r,e,t){const n={color:{source:jr,composite:Ps},number:{source:Un,composite:jr}},i=(function(s){return{"line-pattern":{source:ir,composite:ir},"fill-pattern":{source:ir,composite:ir},"fill-extrusion-pattern":{source:ir,composite:ir}}[s]})(r);return i&&i[t]||n[e][t]}B("ConstantBinder",Nr),B("CrossFadedConstantBinder",sr),B("SourceExpressionBinder",dt),B("CrossFadedCompositeBinder",_t),B("CompositeExpressionBinder",Ke),B("ProgramConfiguration",dl,{omit:["_buffers"]}),B("ProgramConfigurationSet",$t);const ue=8192,Ds=Math.pow(2,14)-1,ml=-Ds-1;function Lt(r){const e=ue/r.extent,t=r.loadGeometry();for(let n=0;n<t.length;n++){const i=t[n];for(let s=0;s<i.length;s++){const o=i[s],a=Math.round(o.x*e),l=Math.round(o.y*e);o.x=xr(a,ml,Ds),o.y=xr(l,ml,Ds),(a<o.x||a>o.x+1||l<o.y||l>o.y+1)&&Ve("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return t}function or(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Lt(r):[]}}function Hn(r,e,t,n,i){r.emplaceBack(2*e+(n+1)/2,2*t+(i+1)/2)}class $s{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ih,this.indexArray=new Rr,this.segments=new ke,this.programConfigurations=new $t(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(e,t,n){const i=this.layers[0],s=[];let o=null,a=!1;i.type==="circle"&&(o=i.layout.get("circle-sort-key"),a=!o.isConstant());for(const{feature:l,id:u,index:c,sourceLayerIndex:h}of e){const p=this.layers[0]._featureFilter.needGeometry,f=or(l,p);if(!this.layers[0]._featureFilter.filter(new ie(this.zoom),f,n))continue;const d=a?o.evaluate(f,{},n):void 0,y={id:u,properties:l.properties,type:l.type,sourceLayerIndex:h,index:c,geometry:p?f.geometry:Lt(l),patterns:{},sortKey:d};s.push(y)}a&&s.sort(((l,u)=>l.sortKey-u.sortKey));for(const l of s){const{geometry:u,index:c,sourceLayerIndex:h}=l,p=e[c].feature;this.addFeature(l,u,c,n),t.featureIndex.insert(p,u,c,h,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,i){for(const s of t)for(const o of s){const a=o.x,l=o.y;if(a<0||a>=ue||l<0||l>=ue)continue;const u=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),c=u.vertexLength;Hn(this.layoutVertexArray,a,l,-1,-1),Hn(this.layoutVertexArray,a,l,1,-1),Hn(this.layoutVertexArray,a,l,1,1),Hn(this.layoutVertexArray,a,l,-1,1),this.indexArray.emplaceBack(c,c+1,c+2),this.indexArray.emplaceBack(c,c+3,c+2),u.vertexLength+=4,u.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},i)}}function Nh(r,e){for(let t=0;t<r.length;t++)if(ar(e,r[t]))return!0;for(let t=0;t<e.length;t++)if(ar(r,e[t]))return!0;return!!Ls(r,e)}function Uh(r,e,t){return!!ar(r,e)||!!Os(e,r,t)}function gl(r,e){if(r.length===1)return vl(e,r[0]);for(let t=0;t<e.length;t++){const n=e[t];for(let i=0;i<n.length;i++)if(ar(r,n[i]))return!0}for(let t=0;t<r.length;t++)if(vl(e,r[t]))return!0;for(let t=0;t<e.length;t++)if(Ls(r,e[t]))return!0;return!1}function qh(r,e,t){if(r.length>1){if(Ls(r,e))return!0;for(let n=0;n<e.length;n++)if(Os(e[n],r,t))return!0}for(let n=0;n<r.length;n++)if(Os(r[n],e,t))return!0;return!1}function Ls(r,e){if(r.length===0||e.length===0)return!1;for(let t=0;t<r.length-1;t++){const n=r[t],i=r[t+1];for(let s=0;s<e.length-1;s++)if(Zh(n,i,e[s],e[s+1]))return!0}return!1}function Zh(r,e,t,n){return bt(r,t,n)!==bt(e,t,n)&&bt(r,e,t)!==bt(r,e,n)}function Os(r,e,t){const n=t*t;if(e.length===1)return r.distSqr(e[0])<n;for(let i=1;i<e.length;i++)if(xl(r,e[i-1],e[i])<n)return!0;return!1}function xl(r,e,t){const n=e.distSqr(t);if(n===0)return r.distSqr(e);const i=((r.x-e.x)*(t.x-e.x)+(r.y-e.y)*(t.y-e.y))/n;return r.distSqr(i<0?e:i>1?t:t.sub(e)._mult(i)._add(e))}function vl(r,e){let t,n,i,s=!1;for(let o=0;o<r.length;o++){t=r[o];for(let a=0,l=t.length-1;a<t.length;l=a++)n=t[a],i=t[l],n.y>e.y!=i.y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(s=!s)}return s}function ar(r,e){let t=!1;for(let n=0,i=r.length-1;n<r.length;i=n++){const s=r[n],o=r[i];s.y>e.y!=o.y>e.y&&e.x<(o.x-s.x)*(e.y-s.y)/(o.y-s.y)+s.x&&(t=!t)}return t}function Gh(r,e,t){const n=t[0],i=t[2];if(r.x<n.x&&e.x<n.x||r.x>i.x&&e.x>i.x||r.y<n.y&&e.y<n.y||r.y>i.y&&e.y>i.y)return!1;const s=bt(r,e,t[0]);return s!==bt(r,e,t[1])||s!==bt(r,e,t[2])||s!==bt(r,e,t[3])}function Ur(r,e,t){const n=e.paint.get(r).value;return n.kind==="constant"?n.value:t.programConfigurations.get(e.id).getMaxValue(r)}function Yn(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Jn(r,e,t,n,i){if(!e[0]&&!e[1])return r;const s=R.convert(e)._mult(i);t==="viewport"&&s._rotate(-n);const o=[];for(let a=0;a<r.length;a++)o.push(r[a].sub(s));return o}let bl,wl;B("CircleBucket",$s,{omit:["layers"]});var qr,Xh={get paint(){return wl=wl||new De({"circle-radius":new O(_.paint_circle["circle-radius"]),"circle-color":new O(_.paint_circle["circle-color"]),"circle-blur":new O(_.paint_circle["circle-blur"]),"circle-opacity":new O(_.paint_circle["circle-opacity"]),"circle-translate":new $(_.paint_circle["circle-translate"]),"circle-translate-anchor":new $(_.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $(_.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $(_.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new O(_.paint_circle["circle-stroke-width"]),"circle-stroke-color":new O(_.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new O(_.paint_circle["circle-stroke-opacity"])})},get layout(){return bl=bl||new De({"circle-sort-key":new O(_.layout_circle["circle-sort-key"])})}},_l=typeof Float32Array<"u"?Float32Array:Array;function Sl(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function js(r,e,t){var n=e[0],i=e[1],s=e[2],o=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*s+t[12]*o,r[1]=t[1]*n+t[5]*i+t[9]*s+t[13]*o,r[2]=t[2]*n+t[6]*i+t[10]*s+t[14]*o,r[3]=t[3]*n+t[7]*i+t[11]*s+t[15]*o,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)}),qr=new _l(4),_l!=Float32Array&&(qr[0]=0,qr[1]=0,qr[2]=0,qr[3]=0);class Hh extends at{constructor(e){super(e,Xh)}createBucket(e){return new $s(e)}queryRadius(e){const t=e;return Ur("circle-radius",this,t)+Ur("circle-stroke-width",this,t)+Yn(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,i,s,o,a,l){const u=Jn(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,a),c=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n),h=this.paint.get("circle-pitch-alignment")==="map",p=h?u:(function(d,y){return d.map((m=>kl(m,y)))})(u,l),f=h?c*a:c;for(const d of i)for(const y of d){const m=h?y:kl(y,l);let g=f;const x=js([],[y.x,y.y,0,1],l);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?g*=x[3]/o.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(g*=o.cameraToCenterDistance/x[3]),Uh(p,m,g))return!0}return!1}}function kl(r,e){const t=js([],[r.x,r.y,0,1],e);return new R(t[0]/t[3],t[1]/t[3])}class Al extends $s{}let Il;B("HeatmapBucket",Al,{omit:["layers"]});var Yh={get paint(){return Il=Il||new De({"heatmap-radius":new O(_.paint_heatmap["heatmap-radius"]),"heatmap-weight":new O(_.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $(_.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ps(_.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $(_.paint_heatmap["heatmap-opacity"])})}};function Rs(r,{width:e,height:t},n,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==e*t*n)throw new RangeError(`mismatched image size. expected: ${i.length} but got: ${e*t*n}`)}else i=new Uint8Array(e*t*n);return r.width=e,r.height=t,r.data=i,r}function Ml(r,{width:e,height:t},n){if(e===r.width&&t===r.height)return;const i=Rs({},{width:e,height:t},n);Ns(r,i,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,t)},n),r.width=e,r.height=t,r.data=i.data}function Ns(r,e,t,n,i,s){if(i.width===0||i.height===0)return e;if(i.width>r.width||i.height>r.height||t.x>r.width-i.width||t.y>r.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const o=r.data,a=e.data;if(o===a)throw new Error("srcData equals dstData, so image is already copied");for(let l=0;l<i.height;l++){const u=((t.y+l)*r.width+t.x)*s,c=((n.y+l)*e.width+n.x)*s;for(let h=0;h<i.width*s;h++)a[c+h]=o[u+h]}return e}class Zr{constructor(e,t){Rs(this,e,1,t)}resize(e){Ml(this,e,1)}clone(){return new Zr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,s){Ns(e,t,n,i,s,1)}}class $e{constructor(e,t){Rs(this,e,4,t)}resize(e){Ml(this,e,4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new $e({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,s){Ns(e,t,n,i,s,4)}}B("AlphaImage",Zr),B("RGBAImage",$e);const zl="big-fb";class Jh extends at{createBucket(e){return new Al(e)}constructor(e){super(e,Yh),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=(function(e){const t={},n=e.resolution||256,i=e.clips?e.clips.length:1,s=e.image||new $e({width:n,height:i});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const o=(a,l,u)=>{t[e.evaluationKey]=u;const c=e.expression.evaluate(t);s.data[a+l+0]=Math.floor(255*c.r/c.a),s.data[a+l+1]=Math.floor(255*c.g/c.a),s.data[a+l+2]=Math.floor(255*c.b/c.a),s.data[a+l+3]=Math.floor(255*c.a)};if(e.clips)for(let a=0,l=0;a<i;++a,l+=4*n)for(let u=0,c=0;u<n;u++,c+=4){const h=u/(n-1),{start:p,end:f}=e.clips[a];o(l,c,p*(1-h)+f*h)}else for(let a=0,l=0;a<n;a++,l+=4)o(0,l,a/(n-1));return s})({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(zl)&&this.heatmapFbos.delete(zl)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Pl;var Kh={get paint(){return Pl=Pl||new De({"hillshade-illumination-direction":new $(_.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $(_.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $(_.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $(_.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $(_.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $(_.paint_hillshade["hillshade-accent-color"])})}};class Wh extends at{constructor(e){super(e,Kh)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Qh=me([{name:"a_pos",components:2,type:"Int16"}],4),{members:ep}=Qh;function Cl(r,e,t=2){const n=e&&e.length,i=n?e[0]*t:r.length;let s=Bl(r,0,i,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,u;if(n&&(s=(function(c,h,p,f){const d=[];for(let y=0,m=h.length;y<m;y++){const g=Bl(c,h[y]*f,y<m-1?h[y+1]*f:c.length,f,!1);g===g.next&&(g.steiner=!0),d.push(lp(g))}d.sort(sp);for(let y=0;y<d.length;y++)p=op(d[y],p);return p})(r,e,s,t)),r.length>80*t){a=1/0,l=1/0;let c=-1/0,h=-1/0;for(let p=t;p<i;p+=t){const f=r[p],d=r[p+1];f<a&&(a=f),d<l&&(l=d),f>c&&(c=f),d>h&&(h=d)}u=Math.max(c-a,h-l),u=u!==0?32767/u:0}return Gr(s,o,t,a,l,u,0),o}function Bl(r,e,t,n,i){let s;if(i===(function(o,a,l,u){let c=0;for(let h=a,p=l-u;h<l;h+=u)c+=(o[p]-o[h])*(o[h+1]+o[p+1]),p=h;return c})(r,e,t,n)>0)for(let o=e;o<t;o+=n)s=El(o/n|0,r[o],r[o+1],s);else for(let o=t-n;o>=e;o-=n)s=El(o/n|0,r[o],r[o+1],s);return s&&Kn(s,s.next)&&(Hr(s),s=s.next),s}function Ot(r,e){if(!r)return r;e||(e=r);let t,n=r;do if(t=!1,n.steiner||!Kn(n,n.next)&&ce(n.prev,n,n.next)!==0)n=n.next;else{if(Hr(n),n=e=n.prev,n===n.next)break;t=!0}while(t||n!==e);return e}function Gr(r,e,t,n,i,s,o){if(!r)return;!o&&s&&(function(l,u,c,h){let p=l;do p.z===0&&(p.z=Us(p.x,p.y,u,c,h)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next;while(p!==l);p.prevZ.nextZ=null,p.prevZ=null,(function(f){let d,y=1;do{let m,g=f;f=null;let x=null;for(d=0;g;){d++;let v=g,w=0;for(let S=0;S<y&&(w++,v=v.nextZ,v);S++);let b=y;for(;w>0||b>0&&v;)w!==0&&(b===0||!v||g.z<=v.z)?(m=g,g=g.nextZ,w--):(m=v,v=v.nextZ,b--),x?x.nextZ=m:f=m,m.prevZ=x,x=m;g=v}x.nextZ=null,y*=2}while(d>1)})(p)})(r,n,i,s);let a=r;for(;r.prev!==r.next;){const l=r.prev,u=r.next;if(s?rp(r,n,i,s):tp(r))e.push(l.i,r.i,u.i),Hr(r),r=u.next,a=u.next;else if((r=u)===a){o?o===1?Gr(r=np(Ot(r),e),e,t,n,i,s,2):o===2&&ip(r,e,t,n,i,s):Gr(Ot(r),e,t,n,i,s,1);break}}}function tp(r){const e=r.prev,t=r,n=r.next;if(ce(e,t,n)>=0)return!1;const i=e.x,s=t.x,o=n.x,a=e.y,l=t.y,u=n.y,c=i<s?i<o?i:o:s<o?s:o,h=a<l?a<u?a:u:l<u?l:u,p=i>s?i>o?i:o:s>o?s:o,f=a>l?a>u?a:u:l>u?l:u;let d=n.next;for(;d!==e;){if(d.x>=c&&d.x<=p&&d.y>=h&&d.y<=f&&lr(i,a,s,l,o,u,d.x,d.y)&&ce(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function rp(r,e,t,n){const i=r.prev,s=r,o=r.next;if(ce(i,s,o)>=0)return!1;const a=i.x,l=s.x,u=o.x,c=i.y,h=s.y,p=o.y,f=a<l?a<u?a:u:l<u?l:u,d=c<h?c<p?c:p:h<p?h:p,y=a>l?a>u?a:u:l>u?l:u,m=c>h?c>p?c:p:h>p?h:p,g=Us(f,d,e,t,n),x=Us(y,m,e,t,n);let v=r.prevZ,w=r.nextZ;for(;v&&v.z>=g&&w&&w.z<=x;){if(v.x>=f&&v.x<=y&&v.y>=d&&v.y<=m&&v!==i&&v!==o&&lr(a,c,l,h,u,p,v.x,v.y)&&ce(v.prev,v,v.next)>=0||(v=v.prevZ,w.x>=f&&w.x<=y&&w.y>=d&&w.y<=m&&w!==i&&w!==o&&lr(a,c,l,h,u,p,w.x,w.y)&&ce(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;v&&v.z>=g;){if(v.x>=f&&v.x<=y&&v.y>=d&&v.y<=m&&v!==i&&v!==o&&lr(a,c,l,h,u,p,v.x,v.y)&&ce(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;w&&w.z<=x;){if(w.x>=f&&w.x<=y&&w.y>=d&&w.y<=m&&w!==i&&w!==o&&lr(a,c,l,h,u,p,w.x,w.y)&&ce(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function np(r,e){let t=r;do{const n=t.prev,i=t.next.next;!Kn(n,i)&&Vl(n,t,t.next,i)&&Xr(n,i)&&Xr(i,n)&&(e.push(n.i,t.i,i.i),Hr(t),Hr(t.next),t=r=i),t=t.next}while(t!==r);return Ot(t)}function ip(r,e,t,n,i,s){let o=r;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&up(o,a)){let l=Tl(o,a);return o=Ot(o,o.next),l=Ot(l,l.next),Gr(o,e,t,n,i,s,0),void Gr(l,e,t,n,i,s,0)}a=a.next}o=o.next}while(o!==r)}function sp(r,e){return r.x-e.x}function op(r,e){const t=(function(i,s){let o=s;const a=i.x,l=i.y;let u,c=-1/0;do{if(l<=o.y&&l>=o.next.y&&o.next.y!==o.y){const y=o.x+(l-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(y<=a&&y>c&&(c=y,u=o.x<o.next.x?o:o.next,y===a))return u}o=o.next}while(o!==s);if(!u)return null;const h=u,p=u.x,f=u.y;let d=1/0;o=u;do{if(a>=o.x&&o.x>=p&&a!==o.x&&lr(l<f?a:c,l,p,f,l<f?c:a,l,o.x,o.y)){const y=Math.abs(l-o.y)/(a-o.x);Xr(o,i)&&(y<d||y===d&&(o.x>u.x||o.x===u.x&&ap(u,o)))&&(u=o,d=y)}o=o.next}while(o!==h);return u})(r,e);if(!t)return e;const n=Tl(t,r);return Ot(n,n.next),Ot(t,t.next)}function ap(r,e){return ce(r.prev,r,e.prev)<0&&ce(e.next,r,r.next)<0}function Us(r,e,t,n,i){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-t)*i|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function lp(r){let e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function lr(r,e,t,n,i,s,o,a){return(i-o)*(e-a)>=(r-o)*(s-a)&&(r-o)*(n-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(i-o)*(n-a)}function up(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!(function(t,n){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==n.i&&i.next.i!==n.i&&Vl(i,i.next,t,n))return!0;i=i.next}while(i!==t);return!1})(r,e)&&(Xr(r,e)&&Xr(e,r)&&(function(t,n){let i=t,s=!1;const o=(t.x+n.x)/2,a=(t.y+n.y)/2;do i.y>a!=i.next.y>a&&i.next.y!==i.y&&o<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next;while(i!==t);return s})(r,e)&&(ce(r.prev,r,e.prev)||ce(r,e.prev,e))||Kn(r,e)&&ce(r.prev,r,r.next)>0&&ce(e.prev,e,e.next)>0)}function ce(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function Kn(r,e){return r.x===e.x&&r.y===e.y}function Vl(r,e,t,n){const i=Qn(ce(r,e,t)),s=Qn(ce(r,e,n)),o=Qn(ce(t,n,r)),a=Qn(ce(t,n,e));return i!==s&&o!==a||!(i!==0||!Wn(r,t,e))||!(s!==0||!Wn(r,n,e))||!(o!==0||!Wn(t,r,n))||!(a!==0||!Wn(t,e,n))}function Wn(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function Qn(r){return r>0?1:r<0?-1:0}function Xr(r,e){return ce(r.prev,r,r.next)<0?ce(r,e,r.next)>=0&&ce(r,r.prev,e)>=0:ce(r,e,r.prev)<0||ce(r,r.next,e)<0}function Tl(r,e){const t=qs(r.i,r.x,r.y),n=qs(e.i,e.x,e.y),i=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function El(r,e,t,n){const i=qs(r,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Hr(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function qs(r,e,t){return{i:r,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Zs(r,e,t){const n=t.patternDependencies;let i=!1;for(const s of e){const o=s.paint.get(`${r}-pattern`);o.isConstant()||(i=!0);const a=o.constantOr(null);a&&(i=!0,n[a.to]=!0,n[a.from]=!0)}return i}function Gs(r,e,t,n,i){const s=i.patternDependencies;for(const o of e){const a=o.paint.get(`${r}-pattern`).value;if(a.kind!=="constant"){let l=a.evaluate({zoom:n-1},t,{},i.availableImages),u=a.evaluate({zoom:n},t,{},i.availableImages),c=a.evaluate({zoom:n+1},t,{},i.availableImages);l=l&&l.name?l.name:l,u=u&&u.name?u.name:u,c=c&&c.name?c.name:c,s[l]=!0,s[u]=!0,s[c]=!0,t.patterns[o.id]={min:l,mid:u,max:c}}}return t}class Xs{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Mh,this.indexArray=new Rr,this.indexArray2=new Cs,this.programConfigurations=new $t(e.layers,e.zoom),this.segments=new ke,this.segments2=new ke,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(e,t,n){this.hasPattern=Zs("fill",this.layers,t);const i=this.layers[0].layout.get("fill-sort-key"),s=!i.isConstant(),o=[];for(const{feature:a,id:l,index:u,sourceLayerIndex:c}of e){const h=this.layers[0]._featureFilter.needGeometry,p=or(a,h);if(!this.layers[0]._featureFilter.filter(new ie(this.zoom),p,n))continue;const f=s?i.evaluate(p,{},n,t.availableImages):void 0,d={id:l,properties:a.properties,type:a.type,sourceLayerIndex:c,index:u,geometry:h?p.geometry:Lt(a),patterns:{},sortKey:f};o.push(d)}s&&o.sort(((a,l)=>a.sortKey-l.sortKey));for(const a of o){const{geometry:l,index:u,sourceLayerIndex:c}=a;if(this.hasPattern){const h=Gs("fill",this.layers,a,this.zoom,t);this.patternFeatures.push(h)}else this.addFeature(a,l,u,n,{});t.featureIndex.insert(e[u].feature,l,u,c,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}addFeatures(e,t,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,t,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ep),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,i,s){for(const o of An(t,500)){let a=0;for(const f of o)a+=f.length;const l=this.segments.prepareSegment(a,this.layoutVertexArray,this.indexArray),u=l.vertexLength,c=[],h=[];for(const f of o){if(f.length===0)continue;f!==o[0]&&h.push(c.length/2);const d=this.segments2.prepareSegment(f.length,this.layoutVertexArray,this.indexArray2),y=d.vertexLength;this.layoutVertexArray.emplaceBack(f[0].x,f[0].y),this.indexArray2.emplaceBack(y+f.length-1,y),c.push(f[0].x),c.push(f[0].y);for(let m=1;m<f.length;m++)this.layoutVertexArray.emplaceBack(f[m].x,f[m].y),this.indexArray2.emplaceBack(y+m-1,y+m),c.push(f[m].x),c.push(f[m].y);d.vertexLength+=f.length,d.primitiveLength+=f.length}const p=Cl(c,h);for(let f=0;f<p.length;f+=3)this.indexArray.emplaceBack(u+p[f],u+p[f+1],u+p[f+2]);l.vertexLength+=a,l.primitiveLength+=p.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,s,i)}}let Fl,Dl;B("FillBucket",Xs,{omit:["layers","patternFeatures"]});var cp={get paint(){return Dl=Dl||new De({"fill-antialias":new $(_.paint_fill["fill-antialias"]),"fill-opacity":new O(_.paint_fill["fill-opacity"]),"fill-color":new O(_.paint_fill["fill-color"]),"fill-outline-color":new O(_.paint_fill["fill-outline-color"]),"fill-translate":new $(_.paint_fill["fill-translate"]),"fill-translate-anchor":new $(_.paint_fill["fill-translate-anchor"]),"fill-pattern":new Nn(_.paint_fill["fill-pattern"])})},get layout(){return Fl=Fl||new De({"fill-sort-key":new O(_.layout_fill["fill-sort-key"])})}};class hp extends at{constructor(e){super(e,cp)}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Xs(e)}queryRadius(){return Yn(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,i,s,o,a){return gl(Jn(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,a),i)}isTileClipped(){return!0}}const pp=me([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),fp=me([{name:"a_centroid",components:2,type:"Int16"}],4),{members:dp}=pp;var lt={},yp=yi,$l=ur;function ur(r,e,t,n,i){this.properties={},this.extent=t,this.type=0,this._pbf=r,this._geometry=-1,this._keys=n,this._values=i,r.readFields(mp,this,e)}function mp(r,e,t){r==1?e.id=t.readVarint():r==2?(function(n,i){for(var s=n.readVarint()+n.pos;n.pos<s;){var o=i._keys[n.readVarint()],a=i._values[n.readVarint()];i.properties[o]=a}})(t,e):r==3?e.type=t.readVarint():r==4&&(e._geometry=t.pos)}function gp(r){for(var e,t,n=0,i=0,s=r.length,o=s-1;i<s;o=i++)n+=((t=r[o]).x-(e=r[i]).x)*(e.y+t.y);return n}ur.types=["Unknown","Point","LineString","Polygon"],ur.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,t=r.readVarint()+r.pos,n=1,i=0,s=0,o=0,a=[];r.pos<t;){if(i<=0){var l=r.readVarint();n=7&l,i=l>>3}if(i--,n===1||n===2)s+=r.readSVarint(),o+=r.readSVarint(),n===1&&(e&&a.push(e),e=[]),e.push(new yp(s,o));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&a.push(e),a},ur.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,t=1,n=0,i=0,s=0,o=1/0,a=-1/0,l=1/0,u=-1/0;r.pos<e;){if(n<=0){var c=r.readVarint();t=7&c,n=c>>3}if(n--,t===1||t===2)(i+=r.readSVarint())<o&&(o=i),i>a&&(a=i),(s+=r.readSVarint())<l&&(l=s),s>u&&(u=s);else if(t!==7)throw new Error("unknown command "+t)}return[o,l,a,u]},ur.prototype.toGeoJSON=function(r,e,t){var n,i,s=this.extent*Math.pow(2,t),o=this.extent*r,a=this.extent*e,l=this.loadGeometry(),u=ur.types[this.type];function c(f){for(var d=0;d<f.length;d++){var y=f[d];f[d]=[360*(y.x+o)/s-180,360/Math.PI*Math.atan(Math.exp((180-360*(y.y+a)/s)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<l.length;n++)h[n]=l[n][0];c(l=h);break;case 2:for(n=0;n<l.length;n++)c(l[n]);break;case 3:for(l=(function(f){var d=f.length;if(d<=1)return[f];for(var y,m,g=[],x=0;x<d;x++){var v=gp(f[x]);v!==0&&(m===void 0&&(m=v<0),m===v<0?(y&&g.push(y),y=[f[x]]):y.push(f[x]))}return y&&g.push(y),g})(l),n=0;n<l.length;n++)for(i=0;i<l[n].length;i++)c(l[n][i])}l.length===1?l=l[0]:u="Multi"+u;var p={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var xp=$l,Ll=Ol;function Ol(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(vp,this,e),this.length=this._features.length}function vp(r,e,t){r===15?e.version=t.readVarint():r===1?e.name=t.readString():r===5?e.extent=t.readVarint():r===2?e._features.push(t.pos):r===3?e._keys.push(t.readString()):r===4&&e._values.push((function(n){for(var i=null,s=n.readVarint()+n.pos;n.pos<s;){var o=n.readVarint()>>3;i=o===1?n.readString():o===2?n.readFloat():o===3?n.readDouble():o===4?n.readVarint64():o===5?n.readVarint():o===6?n.readSVarint():o===7?n.readBoolean():null}return i})(t))}Ol.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new xp(this._pbf,e,this.extent,this._keys,this._values)};var bp=Ll;function wp(r,e,t){if(r===3){var n=new bp(t,t.readVarint()+t.pos);n.length&&(e[n.name]=n)}}lt.VectorTile=function(r,e){this.layers=r.readFields(wp,{},e)},lt.VectorTileFeature=$l,lt.VectorTileLayer=Ll;const _p=lt.VectorTileFeature.types,Hs=Math.pow(2,13);function Yr(r,e,t,n,i,s,o,a){r.emplaceBack(e,t,2*Math.floor(n*Hs)+o,i*Hs*2,s*Hs*2,Math.round(a))}class Ys{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new zh,this.centroidVertexArray=new Ah,this.indexArray=new Rr,this.programConfigurations=new $t(e.layers,e.zoom),this.segments=new ke,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(e,t,n){this.features=[],this.hasPattern=Zs("fill-extrusion",this.layers,t);for(const{feature:i,id:s,index:o,sourceLayerIndex:a}of e){const l=this.layers[0]._featureFilter.needGeometry,u=or(i,l);if(!this.layers[0]._featureFilter.filter(new ie(this.zoom),u,n))continue;const c={id:s,sourceLayerIndex:a,index:o,geometry:l?u.geometry:Lt(i),properties:i.properties,type:i.type,patterns:{}};this.hasPattern?this.features.push(Gs("fill-extrusion",this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,o,n,{}),t.featureIndex.insert(i,c.geometry,o,a,this.index,!0)}}addFeatures(e,t,n){for(const i of this.features){const{geometry:s}=i;this.addFeature(i,s,i.index,t,n)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dp),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,fp.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,t,n,i,s){for(const o of An(t,500)){const a={x:0,y:0,vertexCount:0};let l=0;for(const d of o)l+=d.length;let u=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const d of o){if(d.length===0||kp(d))continue;let y=0;for(let m=0;m<d.length;m++){const g=d[m];if(m>=1){const x=d[m-1];if(!Sp(g,x)){u.vertexLength+4>ke.MAX_VERTEX_ARRAY_LENGTH&&(u=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const v=g.sub(x)._perp()._unit(),w=x.dist(g);y+w>32768&&(y=0),Yr(this.layoutVertexArray,g.x,g.y,v.x,v.y,0,0,y),Yr(this.layoutVertexArray,g.x,g.y,v.x,v.y,0,1,y),a.x+=2*g.x,a.y+=2*g.y,a.vertexCount+=2,y+=w,Yr(this.layoutVertexArray,x.x,x.y,v.x,v.y,0,0,y),Yr(this.layoutVertexArray,x.x,x.y,v.x,v.y,0,1,y),a.x+=2*x.x,a.y+=2*x.y,a.vertexCount+=2;const b=u.vertexLength;this.indexArray.emplaceBack(b,b+2,b+1),this.indexArray.emplaceBack(b+1,b+2,b+3),u.vertexLength+=4,u.primitiveLength+=2}}}}if(u.vertexLength+l>ke.MAX_VERTEX_ARRAY_LENGTH&&(u=this.segments.prepareSegment(l,this.layoutVertexArray,this.indexArray)),_p[e.type]!=="Polygon")continue;const c=[],h=[],p=u.vertexLength;for(const d of o)if(d.length!==0){d!==o[0]&&h.push(c.length/2);for(let y=0;y<d.length;y++){const m=d[y];Yr(this.layoutVertexArray,m.x,m.y,0,0,1,1,0),a.x+=m.x,a.y+=m.y,a.vertexCount+=1,c.push(m.x),c.push(m.y)}}const f=Cl(c,h);for(let d=0;d<f.length;d+=3)this.indexArray.emplaceBack(p+f[d],p+f[d+2],p+f[d+1]);u.primitiveLength+=f.length/3,u.vertexLength+=l;for(let d=0;d<a.vertexCount;d++){const y=Math.floor(a.x/a.vertexCount),m=Math.floor(a.y/a.vertexCount);this.centroidVertexArray.emplaceBack(y,m)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,s,i)}}function Sp(r,e){return r.x===e.x&&(r.x<0||r.x>ue)||r.y===e.y&&(r.y<0||r.y>ue)}function kp(r){return r.every((e=>e.x<0))||r.every((e=>e.x>ue))||r.every((e=>e.y<0))||r.every((e=>e.y>ue))}let jl;B("FillExtrusionBucket",Ys,{omit:["layers","features"]});var Ap={get paint(){return jl=jl||new De({"fill-extrusion-opacity":new $(_["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new O(_["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $(_["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $(_["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Nn(_["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new O(_["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new O(_["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $(_["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Ip extends at{constructor(e){super(e,Ap)}createBucket(e){return new Ys(e)}queryRadius(){return Yn(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,t,n,i,s,o,a,l){const u=Jn(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,a),c=this.paint.get("fill-extrusion-height").evaluate(t,n),h=this.paint.get("fill-extrusion-base").evaluate(t,n),p=(function(d,y,m,g){const x=[];for(const v of d){const w=[v.x,v.y,0,1];js(w,w,y),x.push(new R(w[0]/w[3],w[1]/w[3]))}return x})(u,l),f=(function(d,y,m,g){const x=[],v=[],w=g[8]*y,b=g[9]*y,S=g[10]*y,A=g[11]*y,C=g[8]*m,M=g[9]*m,I=g[10]*m,V=g[11]*m;for(const E of d){const T=[],k=[];for(const D of E){const F=D.x,j=D.y,G=g[0]*F+g[4]*j+g[12],U=g[1]*F+g[5]*j+g[13],ne=g[2]*F+g[6]*j+g[14],Ie=g[3]*F+g[7]*j+g[15],pe=ne+S,re=Ie+A,de=G+C,L=U+M,N=ne+I,ae=Ie+V,xe=new R((G+w)/re,(U+b)/re);xe.z=pe/re,T.push(xe);const _e=new R(de/ae,L/ae);_e.z=N/ae,k.push(_e)}x.push(T),v.push(k)}return[x,v]})(i,h,c,l);return(function(d,y,m){let g=1/0;gl(m,y)&&(g=Rl(m,y[0]));for(let x=0;x<y.length;x++){const v=y[x],w=d[x];for(let b=0;b<v.length-1;b++){const S=v[b],A=[S,v[b+1],w[b+1],w[b],S];Nh(m,A)&&(g=Math.min(g,Rl(m,A)))}}return g!==1/0&&g})(f[0],f[1],p)}}function Jr(r,e){return r.x*e.x+r.y*e.y}function Rl(r,e){if(r.length===1){let t=0;const n=e[t++];let i;for(;!i||n.equals(i);)if(i=e[t++],!i)return 1/0;for(;t<e.length;t++){const s=e[t],o=r[0],a=i.sub(n),l=s.sub(n),u=o.sub(n),c=Jr(a,a),h=Jr(a,l),p=Jr(l,l),f=Jr(u,a),d=Jr(u,l),y=c*p-h*h,m=(p*f-h*d)/y,g=(c*d-h*f)/y,x=n.z*(1-m-g)+i.z*m+s.z*g;if(isFinite(x))return x}return 1/0}{let t=1/0;for(const n of e)t=Math.min(t,n.z);return t}}const Mp=me([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:zp}=Mp,Pp=me([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Cp}=Pp,Bp=lt.VectorTileFeature.types,Vp=Math.cos(Math.PI/180*37.5),Nl=Math.pow(2,14)/.5;class Js{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((t=>t.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={}})),this.layoutVertexArray=new Ph,this.layoutVertexArray2=new Ch,this.indexArray=new Rr,this.programConfigurations=new $t(e.layers,e.zoom),this.segments=new ke,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}populate(e,t,n){this.hasPattern=Zs("line",this.layers,t);const i=this.layers[0].layout.get("line-sort-key"),s=!i.isConstant(),o=[];for(const{feature:a,id:l,index:u,sourceLayerIndex:c}of e){const h=this.layers[0]._featureFilter.needGeometry,p=or(a,h);if(!this.layers[0]._featureFilter.filter(new ie(this.zoom),p,n))continue;const f=s?i.evaluate(p,{},n):void 0,d={id:l,properties:a.properties,type:a.type,sourceLayerIndex:c,index:u,geometry:h?p.geometry:Lt(a),patterns:{},sortKey:f};o.push(d)}s&&o.sort(((a,l)=>a.sortKey-l.sortKey));for(const a of o){const{geometry:l,index:u,sourceLayerIndex:c}=a;if(this.hasPattern){const h=Gs("line",this.layers,a,this.zoom,t);this.patternFeatures.push(h)}else this.addFeature(a,l,u,n,{});t.featureIndex.insert(e[u].feature,l,u,c,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}addFeatures(e,t,n){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,t,n)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Cp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zp),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,i,s){const o=this.layers[0].layout,a=o.get("line-join").evaluate(e,{}),l=o.get("line-cap"),u=o.get("line-miter-limit"),c=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const h of t)this.addLine(h,e,a,l,u,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,s,i)}addLine(e,t,n,i,s,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let g=0;g<e.length-1;g++)this.totalDistance+=e[g].dist(e[g+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const a=Bp[t.type]==="Polygon";let l=e.length;for(;l>=2&&e[l-1].equals(e[l-2]);)l--;let u=0;for(;u<l-1&&e[u].equals(e[u+1]);)u++;if(l<(a?3:2))return;n==="bevel"&&(s=1.05);const c=this.overscaling<=16?15*ue/(512*this.overscaling):0,h=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray);let p,f,d,y,m;this.e1=this.e2=-1,a&&(p=e[l-2],m=e[u].sub(p)._unit()._perp());for(let g=u;g<l;g++){if(d=g===l-1?a?e[u+1]:void 0:e[g+1],d&&e[g].equals(d))continue;m&&(y=m),p&&(f=p),p=e[g],m=d?d.sub(p)._unit()._perp():y,y=y||m;let x=y.add(m);x.x===0&&x.y===0||x._unit();const v=y.x*m.x+y.y*m.y,w=x.x*m.x+x.y*m.y,b=w!==0?1/w:1/0,S=2*Math.sqrt(2-2*w),A=w<Vp&&f&&d,C=y.x*m.y-y.y*m.x>0;if(A&&g>u){const V=p.dist(f);if(V>2*c){const E=p.sub(p.sub(f)._mult(c/V)._round());this.updateDistance(f,E),this.addCurrentVertex(E,y,0,0,h),f=E}}const M=f&&d;let I=M?n:a?"butt":i;if(M&&I==="round"&&(b<o?I="miter":b<=2&&(I="fakeround")),I==="miter"&&b>s&&(I="bevel"),I==="bevel"&&(b>2&&(I="flipbevel"),b<s&&(I="miter")),f&&this.updateDistance(f,p),I==="miter")x._mult(b),this.addCurrentVertex(p,x,0,0,h);else if(I==="flipbevel"){if(b>100)x=m.mult(-1);else{const V=b*y.add(m).mag()/y.sub(m).mag();x._perp()._mult(V*(C?-1:1))}this.addCurrentVertex(p,x,0,0,h),this.addCurrentVertex(p,x.mult(-1),0,0,h)}else if(I==="bevel"||I==="fakeround"){const V=-Math.sqrt(b*b-1),E=C?V:0,T=C?0:V;if(f&&this.addCurrentVertex(p,y,E,T,h),I==="fakeround"){const k=Math.round(180*S/Math.PI/20);for(let D=1;D<k;D++){let F=D/k;if(F!==.5){const G=F-.5;F+=F*G*(F-1)*((1.0904+v*(v*(3.55645-1.43519*v)-3.2452))*G*G+(.848013+v*(.215638*v-1.06021)))}const j=m.sub(y)._mult(F)._add(y)._unit()._mult(C?-1:1);this.addHalfVertex(p,j.x,j.y,!1,C,0,h)}}d&&this.addCurrentVertex(p,m,-E,-T,h)}else if(I==="butt")this.addCurrentVertex(p,x,0,0,h);else if(I==="square"){const V=f?1:-1;this.addCurrentVertex(p,x,V,V,h)}else I==="round"&&(f&&(this.addCurrentVertex(p,y,0,0,h),this.addCurrentVertex(p,y,1,1,h,!0)),d&&(this.addCurrentVertex(p,m,-1,-1,h,!0),this.addCurrentVertex(p,m,0,0,h)));if(A&&g<l-1){const V=p.dist(d);if(V>2*c){const E=p.add(d.sub(p)._mult(c/V)._round());this.updateDistance(p,E),this.addCurrentVertex(E,m,0,0,h),p=E}}}}addCurrentVertex(e,t,n,i,s,o=!1){const a=t.y*i-t.x,l=-t.y-t.x*i;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,o,!1,n,s),this.addHalfVertex(e,a,l,o,!0,-i,s),this.distance>Nl/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,t,n,i,s,o))}addHalfVertex({x:e,y:t},n,i,s,o,a,l){const u=.5*(this.lineClips?this.scaledDistance*(Nl-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(s?1:0),(t<<1)+(o?1:0),Math.round(63*n)+128,Math.round(63*i)+128,1+(a===0?0:a<0?-1:1)|(63&u)<<2,u>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=l.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),l.primitiveLength++),o?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}let Ul,ql;B("LineBucket",Js,{omit:["layers","patternFeatures"]});var Zl={get paint(){return ql=ql||new De({"line-opacity":new O(_.paint_line["line-opacity"]),"line-color":new O(_.paint_line["line-color"]),"line-translate":new $(_.paint_line["line-translate"]),"line-translate-anchor":new $(_.paint_line["line-translate-anchor"]),"line-width":new O(_.paint_line["line-width"]),"line-gap-width":new O(_.paint_line["line-gap-width"]),"line-offset":new O(_.paint_line["line-offset"]),"line-blur":new O(_.paint_line["line-blur"]),"line-dasharray":new hs(_.paint_line["line-dasharray"]),"line-pattern":new Nn(_.paint_line["line-pattern"]),"line-gradient":new ps(_.paint_line["line-gradient"])})},get layout(){return Ul=Ul||new De({"line-cap":new $(_.layout_line["line-cap"]),"line-join":new O(_.layout_line["line-join"]),"line-miter-limit":new $(_.layout_line["line-miter-limit"]),"line-round-limit":new $(_.layout_line["line-round-limit"]),"line-sort-key":new O(_.layout_line["line-sort-key"])})}};class Tp extends O{possiblyEvaluate(e,t){return t=new ie(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,i){return t=et({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,i)}}let ei;class Ep extends at{constructor(e){super(e,Zl),this.gradientVersion=0,ei||(ei=new Tp(Zl.paint.properties["line-width"].specification),ei.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const t=this.gradientExpression();this.stepInterpolant=!!(function(n){return n._styleExpression!==void 0})(t)&&t._styleExpression.expression instanceof Pr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=ei.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Js(e)}queryRadius(e){const t=e,n=Gl(Ur("line-width",this,t),Ur("line-gap-width",this,t)),i=Ur("line-offset",this,t);return n/2+Math.abs(i)+Yn(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,i,s,o,a){const l=Jn(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,a),u=a/2*Gl(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),c=this.paint.get("line-offset").evaluate(t,n);return c&&(i=(function(h,p){const f=[];for(let d=0;d<h.length;d++){const y=h[d],m=[];for(let g=0;g<y.length;g++){const x=y[g-1],v=y[g],w=y[g+1],b=g===0?new R(0,0):v.sub(x)._unit()._perp(),S=g===y.length-1?new R(0,0):w.sub(v)._unit()._perp(),A=b._add(S)._unit(),C=A.x*S.x+A.y*S.y;C!==0&&A._mult(1/C),m.push(A._mult(p)._add(v))}f.push(m)}return f})(i,c*a)),(function(h,p,f){for(let d=0;d<p.length;d++){const y=p[d];if(h.length>=3){for(let m=0;m<y.length;m++)if(ar(h,y[m]))return!0}if(qh(h,y,f))return!0}return!1})(l,i,u)}isTileClipped(){return!0}}function Gl(r,e){return e>0?e+2*r:r}const Fp=me([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Dp=me([{name:"a_projected_pos",components:3,type:"Float32"}],4);me([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const $p=me([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);me([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Xl=me([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);function Lp(r,e,t){return r.sections.forEach((n=>{n.text=(function(i,s,o){const a=s.layout.get("text-transform").evaluate(o,{});return a==="uppercase"?i=i.toLocaleUpperCase():a==="lowercase"&&(i=i.toLocaleLowerCase()),Ce.applyArabicShaping&&(i=Ce.applyArabicShaping(i)),i})(n.text,e,t)})),r}me([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4),me([{name:"triangle",components:3,type:"Uint16"}]),me([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),me([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),me([{type:"Float32",name:"offsetX"}]),me([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),me([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Kr={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ge=24,Hl=K,Yl=function(r,e,t,n,i){var s,o,a=8*i-n-1,l=(1<<a)-1,u=l>>1,c=-7,h=i-1,p=-1,f=r[e+h];for(h+=p,s=f&(1<<-c)-1,f>>=-c,c+=a;c>0;s=256*s+r[e+h],h+=p,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=n;c>0;o=256*o+r[e+h],h+=p,c-=8);if(s===0)s=1-u;else{if(s===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,n),s-=u}return(f?-1:1)*o*Math.pow(2,s-n)},Jl=function(r,e,t,n,i,s){var o,a,l,u=8*s-i-1,c=(1<<u)-1,h=c>>1,p=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=0,d=1,y=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=c?(a=0,o=c):o+h>=1?(a=(e*l-1)*Math.pow(2,i),o+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;r[t+f]=255&a,f+=d,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;r[t+f]=255&o,f+=d,o/=256,u-=8);r[t+f-d]|=128*y};function K(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}K.Varint=0,K.Fixed64=1,K.Bytes=2,K.Fixed32=5;var Ks=4294967296,Kl=1/Ks,Wl=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function yt(r){return r.type===K.Bytes?r.readVarint()+r.pos:r.pos+1}function cr(r,e,t){return t?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function Ql(r,e,t){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));t.realloc(n);for(var i=t.pos-1;i>=r;i--)t.buf[i+n]=t.buf[i]}function Op(r,e){for(var t=0;t<r.length;t++)e.writeVarint(r[t])}function jp(r,e){for(var t=0;t<r.length;t++)e.writeSVarint(r[t])}function Rp(r,e){for(var t=0;t<r.length;t++)e.writeFloat(r[t])}function Np(r,e){for(var t=0;t<r.length;t++)e.writeDouble(r[t])}function Up(r,e){for(var t=0;t<r.length;t++)e.writeBoolean(r[t])}function qp(r,e){for(var t=0;t<r.length;t++)e.writeFixed32(r[t])}function Zp(r,e){for(var t=0;t<r.length;t++)e.writeSFixed32(r[t])}function Gp(r,e){for(var t=0;t<r.length;t++)e.writeFixed64(r[t])}function Xp(r,e){for(var t=0;t<r.length;t++)e.writeSFixed64(r[t])}function ti(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function hr(r,e,t){r[t]=e,r[t+1]=e>>>8,r[t+2]=e>>>16,r[t+3]=e>>>24}function eu(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}K.prototype={destroy:function(){this.buf=null},readFields:function(r,e,t){for(t=t||this.length;this.pos<t;){var n=this.readVarint(),i=n>>3,s=this.pos;this.type=7&n,r(i,e,this),this.pos===s&&this.skip(n)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=ti(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=eu(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=ti(this.buf,this.pos)+ti(this.buf,this.pos+4)*Ks;return this.pos+=8,r},readSFixed64:function(){var r=ti(this.buf,this.pos)+eu(this.buf,this.pos+4)*Ks;return this.pos+=8,r},readFloat:function(){var r=Yl(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Yl(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,t,n=this.buf;return e=127&(t=n[this.pos++]),t<128?e:(e|=(127&(t=n[this.pos++]))<<7,t<128?e:(e|=(127&(t=n[this.pos++]))<<14,t<128?e:(e|=(127&(t=n[this.pos++]))<<21,t<128?e:(function(i,s,o){var a,l,u=o.buf;if(a=(112&(l=u[o.pos++]))>>4,l<128||(a|=(127&(l=u[o.pos++]))<<3,l<128)||(a|=(127&(l=u[o.pos++]))<<10,l<128)||(a|=(127&(l=u[o.pos++]))<<17,l<128)||(a|=(127&(l=u[o.pos++]))<<24,l<128)||(a|=(1&(l=u[o.pos++]))<<31,l<128))return cr(i,a,s);throw new Error("Expected varint not more than 10 bytes")})(e|=(15&(t=n[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&Wl?(function(t,n,i){return Wl.decode(t.subarray(n,i))})(this.buf,e,r):(function(t,n,i){for(var s="",o=n;o<i;){var a,l,u,c=t[o],h=null,p=c>239?4:c>223?3:c>191?2:1;if(o+p>i)break;p===1?c<128&&(h=c):p===2?(192&(a=t[o+1]))==128&&(h=(31&c)<<6|63&a)<=127&&(h=null):p===3?(l=t[o+2],(192&(a=t[o+1]))==128&&(192&l)==128&&((h=(15&c)<<12|(63&a)<<6|63&l)<=2047||h>=55296&&h<=57343)&&(h=null)):p===4&&(l=t[o+2],u=t[o+3],(192&(a=t[o+1]))==128&&(192&l)==128&&(192&u)==128&&((h=(15&c)<<18|(63&a)<<12|(63&l)<<6|63&u)<=65535||h>=1114112)&&(h=null)),h===null?(h=65533,p=1):h>65535&&(h-=65536,s+=String.fromCharCode(h>>>10&1023|55296),h=56320|1023&h),s+=String.fromCharCode(h),o+=p}return s})(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==K.Bytes)return r.push(this.readVarint(e));var t=yt(this);for(r=r||[];this.pos<t;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==K.Bytes)return r.push(this.readSVarint());var e=yt(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==K.Bytes)return r.push(this.readBoolean());var e=yt(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==K.Bytes)return r.push(this.readFloat());var e=yt(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==K.Bytes)return r.push(this.readDouble());var e=yt(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==K.Bytes)return r.push(this.readFixed32());var e=yt(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==K.Bytes)return r.push(this.readSFixed32());var e=yt(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==K.Bytes)return r.push(this.readFixed64());var e=yt(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==K.Bytes)return r.push(this.readSFixed64());var e=yt(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===K.Varint)for(;this.buf[this.pos++]>127;);else if(e===K.Bytes)this.pos=this.readVarint()+this.pos;else if(e===K.Fixed32)this.pos+=4;else{if(e!==K.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),hr(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),hr(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),hr(this.buf,-1&r,this.pos),hr(this.buf,Math.floor(r*Kl),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),hr(this.buf,-1&r,this.pos),hr(this.buf,Math.floor(r*Kl),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?(function(e,t){var n,i;if(e>=0?(n=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,i=i+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),(function(s,o,a){a.buf[a.pos++]=127&s|128,s>>>=7,a.buf[a.pos++]=127&s|128,s>>>=7,a.buf[a.pos++]=127&s|128,s>>>=7,a.buf[a.pos++]=127&s|128,a.buf[a.pos]=127&(s>>>=7)})(n,0,t),(function(s,o){var a=(7&s)<<4;o.buf[o.pos++]|=a|((s>>>=3)?128:0),s&&(o.buf[o.pos++]=127&s|((s>>>=7)?128:0),s&&(o.buf[o.pos++]=127&s|((s>>>=7)?128:0),s&&(o.buf[o.pos++]=127&s|((s>>>=7)?128:0),s&&(o.buf[o.pos++]=127&s|((s>>>=7)?128:0),s&&(o.buf[o.pos++]=127&s)))))})(i,t)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=(function(n,i,s){for(var o,a,l=0;l<i.length;l++){if((o=i.charCodeAt(l))>55295&&o<57344){if(!a){o>56319||l+1===i.length?(n[s++]=239,n[s++]=191,n[s++]=189):a=o;continue}if(o<56320){n[s++]=239,n[s++]=191,n[s++]=189,a=o;continue}o=a-55296<<10|o-56320|65536,a=null}else a&&(n[s++]=239,n[s++]=191,n[s++]=189,a=null);o<128?n[s++]=o:(o<2048?n[s++]=o>>6|192:(o<65536?n[s++]=o>>12|224:(n[s++]=o>>18|240,n[s++]=o>>12&63|128),n[s++]=o>>6&63|128),n[s++]=63&o|128)}return s})(this.buf,r,this.pos);var t=this.pos-e;t>=128&&Ql(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(r){this.realloc(4),Jl(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Jl(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=r[t]},writeRawMessage:function(r,e){this.pos++;var t=this.pos;r(e,this);var n=this.pos-t;n>=128&&Ql(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeMessage:function(r,e,t){this.writeTag(r,K.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,Op,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,jp,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,Up,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,Rp,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,Np,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,qp,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,Zp,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,Gp,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,Xp,e)},writeBytesField:function(r,e){this.writeTag(r,K.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,K.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,K.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,K.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,K.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,K.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,K.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,K.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,K.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,K.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};var tu=qt(Hl);const ru=3;function nu(r){let e=0,t=0;for(const o of r)e+=o.w*o.h,t=Math.max(t,o.w);r.sort(((o,a)=>a.h-o.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),t),h:1/0}];let i=0,s=0;for(const o of r)for(let a=n.length-1;a>=0;a--){const l=n[a];if(!(o.w>l.w||o.h>l.h)){if(o.x=l.x,o.y=l.y,s=Math.max(s,o.y+o.h),i=Math.max(i,o.x+o.w),o.w===l.w&&o.h===l.h){const u=n.pop();a<n.length&&(n[a]=u)}else o.h===l.h?(l.x+=o.w,l.w-=o.w):o.w===l.w?(l.y+=o.h,l.h-=o.h):(n.push({x:l.x+o.w,y:l.y,w:l.w-o.w,h:o.h}),l.y+=o.h,l.h-=o.h);break}}return{w:i,h:s,fill:e/(i*s)||0}}const ze=1;class iu{constructor(e,{pixelRatio:t,version:n,stretchX:i,stretchY:s,content:o,textFitWidth:a,textFitHeight:l}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=i,this.stretchY=s,this.content=o,this.version=n,this.textFitWidth=a,this.textFitHeight=l}get tl(){return[this.paddedRect.x+ze,this.paddedRect.y+ze]}get br(){return[this.paddedRect.x+this.paddedRect.w-ze,this.paddedRect.y+this.paddedRect.h-ze]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ze)/this.pixelRatio,(this.paddedRect.h-2*ze)/this.pixelRatio]}}class su{constructor(e,t){const n={},i={};this.haveRenderCallbacks=[];const s=[];this.addImages(e,n,s),this.addImages(t,i,s);const{w:o,h:a}=nu(s),l=new $e({width:o||1,height:a||1});for(const u in e){const c=e[u],h=n[u].paddedRect;$e.copy(c.data,l,{x:0,y:0},{x:h.x+ze,y:h.y+ze},c.data)}for(const u in t){const c=t[u],h=i[u].paddedRect,p=h.x+ze,f=h.y+ze,d=c.data.width,y=c.data.height;$e.copy(c.data,l,{x:0,y:0},{x:p,y:f},c.data),$e.copy(c.data,l,{x:0,y:y-1},{x:p,y:f-1},{width:d,height:1}),$e.copy(c.data,l,{x:0,y:0},{x:p,y:f+y},{width:d,height:1}),$e.copy(c.data,l,{x:d-1,y:0},{x:p-1,y:f},{width:1,height:y}),$e.copy(c.data,l,{x:0,y:0},{x:p+d,y:f},{width:1,height:y})}this.image=l,this.iconPositions=n,this.patternPositions=i}addImages(e,t,n){for(const i in e){const s=e[i],o={x:0,y:0,w:s.data.width+2*ze,h:s.data.height+2*ze};n.push(o),t[i]=new iu(o,s),s.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)}patchUpdatedImage(e,t,n){if(!e||!t||e.version===t.version)return;e.version=t.version;const[i,s]=e.tl;n.update(t.data,void 0,{x:i,y:s})}}var Ae;B("ImagePosition",iu),B("ImageAtlas",su),(function(r){r[r.none=0]="none",r[r.horizontal=1]="horizontal",r[r.vertical=2]="vertical",r[r.horizontalOnly=3]="horizontalOnly"})(Ae||(Ae={}));const Wr=-17;class Qr{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const n=new Qr;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new Qr;return t.imageName=e,t}}class pr{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const n=new pr;for(let i=0;i<e.sections.length;i++){const s=e.sections[i];s.image?n.addImageSection(s):n.addTextSection(s,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=(function(e){let t="";for(let n=0;n<e.length;n++){const i=e.charCodeAt(n+1)||null,s=e.charCodeAt(n-1)||null;t+=i&&Ra(i)&&!Kr[e[n+1]]||s&&Ra(s)&&!Kr[e[n-1]]||!Kr[e[n]]?e[n]:Kr[e[n]]}return t})(this.text)}trim(){let e=0;for(let n=0;n<this.text.length&&ni[this.text.charCodeAt(n)];n++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&ni[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new pr;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Qr.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let i=0;i<e.text.length;++i)this.sectionIndex.push(n)}addImageSection(e){const t=e.image?e.image.name:"";if(t.length===0)return void Ve("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Qr.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Ve("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ri(r,e,t,n,i,s,o,a,l,u,c,h,p,f,d){const y=pr.fromFeature(r,i);let m;h===Ae.vertical&&y.verticalizePunctuation();const{processBidirectionalText:g,processStyledBidirectionalText:x}=Ce;if(g&&y.sections.length===1){m=[];const b=g(y.toString(),Ws(y,u,s,e,n,f));for(const S of b){const A=new pr;A.text=S,A.sections=y.sections;for(let C=0;C<S.length;C++)A.sectionIndex.push(0);m.push(A)}}else if(x){m=[];const b=x(y.text,y.sectionIndex,Ws(y,u,s,e,n,f));for(const S of b){const A=new pr;A.text=S[0],A.sectionIndex=S[1],A.sections=y.sections,m.push(A)}}else m=(function(b,S){const A=[],C=b.text;let M=0;for(const I of S)A.push(b.substring(M,I)),M=I;return M<C.length&&A.push(b.substring(M,C.length)),A})(y,Ws(y,u,s,e,n,f));const v=[],w={positionedLines:v,text:y.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:h,iconsInText:!1,verticalizable:!1};return(function(b,S,A,C,M,I,V,E,T,k,D,F){let j=0,G=Wr,U=0,ne=0;const Ie=E==="right"?1:E==="left"?0:.5;let pe=0;for(const ae of M){ae.trim();const xe=ae.getMaxScale(),_e=(xe-1)*ge,be={positionedGlyphs:[],lineOffset:0};b.positionedLines[pe]=be;const Me=be.positionedGlyphs;let we=0;if(!ae.length()){G+=I,++pe;continue}for(let Pe=0;Pe<ae.length();Pe++){const Y=ae.getSection(Pe),ee=ae.getSectionIndex(Pe),te=ae.getCharCode(Pe);let Be=0,se=null,gr=null,ut=null,ct=ge;const Xe=!(T===Ae.horizontal||!D&&!us(te)||D&&(ni[te]||(re=te,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(re)))));if(Y.imageName){const je=C[Y.imageName];if(!je)continue;ut=Y.imageName,b.iconsInText=b.iconsInText||!0,gr=je.paddedRect;const ve=je.displaySize;Y.scale=Y.scale*ge/F,se={width:ve[0],height:ve[1],left:ze,top:-ru,advance:Xe?ve[1]:ve[0]},Be=_e+(ge-ve[1]*Y.scale),ct=se.advance;const gt=Xe?ve[0]*Y.scale-ge*xe:ve[1]*Y.scale-ge*xe;gt>0&&gt>we&&(we=gt)}else{const je=A[Y.fontStack],ve=je&&je[te];if(ve&&ve.rect)gr=ve.rect,se=ve.metrics;else{const gt=S[Y.fontStack],an=gt&&gt[te];if(!an)continue;se=an.metrics}Be=(xe-Y.scale)*ge}Xe?(b.verticalizable=!0,Me.push({glyph:te,imageName:ut,x:j,y:G+Be,vertical:Xe,scale:Y.scale,fontStack:Y.fontStack,sectionIndex:ee,metrics:se,rect:gr}),j+=ct*Y.scale+k):(Me.push({glyph:te,imageName:ut,x:j,y:G+Be,vertical:Xe,scale:Y.scale,fontStack:Y.fontStack,sectionIndex:ee,metrics:se,rect:gr}),j+=se.advance*Y.scale+k)}Me.length!==0&&(U=Math.max(j-k,U),Kp(Me,0,Me.length-1,Ie,we)),j=0;const Oe=I*xe+we;be.lineOffset=Math.max(we,_e),G+=Oe,ne=Math.max(Oe,ne),++pe}var re;const de=G-Wr,{horizontalAlign:L,verticalAlign:N}=cu(V);(function(ae,xe,_e,be,Me,we,Oe,Pe,Y){const ee=(xe-_e)*Me;let te=0;te=we!==Oe?-Pe*be-Wr:(-be*Y+.5)*Oe;for(const Be of ae)for(const se of Be.positionedGlyphs)se.x+=ee,se.y+=te})(b.positionedLines,Ie,L,N,U,ne,I,de,M.length),b.top+=-N*de,b.bottom=b.top+de,b.left+=-L*U,b.right=b.left+U})(w,e,t,n,m,o,a,l,h,u,p,d),!(function(b){for(const S of b)if(S.positionedGlyphs.length!==0)return!1;return!0})(v)&&w}const ni={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Hp={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Yp={40:!0};function ou(r,e,t,n,i,s){if(e.imageName){const o=n[e.imageName];return o?o.displaySize[0]*e.scale*ge/s+i:0}{const o=t[e.fontStack],a=o&&o[r];return a?a.metrics.advance*e.scale+i:0}}function au(r,e,t,n){const i=Math.pow(r-e,2);return n?r<e?i/2:2*i:i+Math.abs(t)*t}function Jp(r,e,t){let n=0;return r===10&&(n-=1e4),t&&(n+=150),r!==40&&r!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function lu(r,e,t,n,i,s){let o=null,a=au(e,t,i,s);for(const l of n){const u=au(e-l.x,t,i,s)+l.badness;u<=a&&(o=l,a=u)}return{index:r,x:e,priorBreak:o,badness:a}}function uu(r){return r?uu(r.priorBreak).concat(r.index):[]}function Ws(r,e,t,n,i,s){if(!r)return[];const o=[],a=(function(h,p,f,d,y,m){let g=0;for(let x=0;x<h.length();x++){const v=h.getSection(x);g+=ou(h.getCharCode(x),v,d,y,p,m)}return g/Math.max(1,Math.ceil(g/f))})(r,e,t,n,i,s),l=r.text.indexOf("")>=0;let u=0;for(let h=0;h<r.length();h++){const p=r.getSection(h),f=r.getCharCode(h);if(ni[f]||(u+=ou(f,p,n,i,e,s)),h<r.length()-1){const d=!((c=f)<11904)&&(!!H["CJK Compatibility Forms"](c)||!!H["CJK Compatibility"](c)||!!H["CJK Strokes"](c)||!!H["CJK Symbols and Punctuation"](c)||!!H["Enclosed CJK Letters and Months"](c)||!!H["Halfwidth and Fullwidth Forms"](c)||!!H["Ideographic Description Characters"](c)||!!H["Vertical Forms"](c)||ja.test(String.fromCodePoint(c)));(Hp[f]||d||p.imageName||h!==r.length()-2&&Yp[r.getCharCode(h+1)])&&o.push(lu(h+1,u,a,o,Jp(f,r.getCharCode(h+1),d&&l),!1))}}var c;return uu(lu(r.length(),u,a,o,0,!0))}function cu(r){let e=.5,t=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0}return{horizontalAlign:e,verticalAlign:t}}function Kp(r,e,t,n,i){if(!n&&!i)return;const s=r[t],o=(r[t].x+s.metrics.advance*s.scale)*n;for(let a=e;a<=t;a++)r[a].x-=o,r[a].y+=i}function Wp(r,e,t){const{horizontalAlign:n,verticalAlign:i}=cu(t),s=e[0]-r.displaySize[0]*n,o=e[1]-r.displaySize[1]*i;return{image:r,top:o,bottom:o+r.displaySize[1],left:s,right:s+r.displaySize[0]}}function hu(r){var e,t;let n=r.left,i=r.top,s=r.right-n,o=r.bottom-i;const a=(e=r.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",l=(t=r.image.textFitHeight)!==null&&t!==void 0?t:"stretchOrShrink",u=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(l==="proportional"){if(a==="stretchOnly"&&s/o<u||a==="proportional"){const c=Math.ceil(o*u);n*=c/s,s=c}}else if(a==="proportional"&&l==="stretchOnly"&&u!==0&&s/o>u){const c=Math.ceil(s/u);i*=c/o,o=c}return{x1:n,y1:i,x2:n+s,y2:i+o}}function pu(r,e,t,n,i,s){const o=r.image;let a;if(o.content){const m=o.content,g=o.pixelRatio||1;a=[m[0]/g,m[1]/g,o.displaySize[0]-m[2]/g,o.displaySize[1]-m[3]/g]}const l=e.left*s,u=e.right*s;let c,h,p,f;t==="width"||t==="both"?(f=i[0]+l-n[3],h=i[0]+u+n[1]):(f=i[0]+(l+u-o.displaySize[0])/2,h=f+o.displaySize[0]);const d=e.top*s,y=e.bottom*s;return t==="height"||t==="both"?(c=i[1]+d-n[0],p=i[1]+y+n[2]):(c=i[1]+(d+y-o.displaySize[1])/2,p=c+o.displaySize[1]),{image:o,top:c,right:h,bottom:p,left:f,collisionPadding:a}}const en=255,jt=128,St=en*jt;function fu(r,e){const{expression:t}=e;if(t.kind==="constant")return{kind:"constant",layoutSize:t.evaluate(new ie(r+1))};if(t.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:i}=t;let s=0;for(;s<n.length&&n[s]<=r;)s++;s=Math.max(0,s-1);let o=s;for(;o<n.length&&n[o]<r+1;)o++;o=Math.min(n.length-1,o);const a=n[s],l=n[o];return t.kind==="composite"?{kind:"composite",minZoom:a,maxZoom:l,interpolationType:i}:{kind:"camera",minZoom:a,maxZoom:l,minSize:t.evaluate(new ie(a)),maxSize:t.evaluate(new ie(l)),interpolationType:i}}}function du(r,e,t){let n="never";const i=r.get(e);return i?n=i:r.get(t)&&(n="always"),n}const Qp=lt.VectorTileFeature.types,ef=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ii(r,e,t,n,i,s,o,a,l,u,c,h,p){const f=a?Math.min(St,Math.round(a[0])):0,d=a?Math.min(St,Math.round(a[1])):0;r.emplaceBack(e,t,Math.round(32*n),Math.round(32*i),s,o,(f<<1)+(l?1:0),d,16*u,16*c,256*h,256*p)}function yu(r,e,t){r.emplaceBack(e.x,e.y,t),r.emplaceBack(e.x,e.y,t),r.emplaceBack(e.x,e.y,t),r.emplaceBack(e.x,e.y,t)}function tf(r){for(const e of r.sections)if(wh(e.text))return!0;return!1}class Qs{constructor(e){this.layoutVertexArray=new Bh,this.indexArray=new Rr,this.programConfigurations=e,this.segments=new ke,this.dynamicLayoutVertexArray=new Vh,this.opacityVertexArray=new Th,this.hasVisibleVertices=!1,this.placedSymbolArray=new Qa}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,t,n,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Dp.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ef,!0),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}B("SymbolBuffers",Qs);class eo{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new ke,this.collisionVertexArray=new Eh}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,$p.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}B("CollisionBuffers",eo);class fr{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((o=>o.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Sl([]),this.placementViewportMatrix=Sl([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fu(this.zoom,t["text-size"]),this.iconSizeData=fu(this.zoom,t["icon-size"]);const n=this.layers[0].layout,i=n.get("symbol-sort-key"),s=n.get("symbol-z-order");this.canOverlap=du(n,"text-overlap","text-allow-overlap")!=="never"||du(n,"icon-overlap","icon-allow-overlap")!=="never"||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=s!=="viewport-y"&&!i.isConstant(),this.sortFeaturesByY=(s==="viewport-y"||s==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,n.get("symbol-placement")==="point"&&(this.writingModes=n.get("text-writing-mode").map((o=>Ae[o]))),this.stateDependentLayerIds=this.layers.filter((o=>o.isStateDependent())).map((o=>o.id)),this.sourceID=e.sourceID}createArrays(){this.text=new Qs(new $t(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Qs(new $t(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new rl,this.lineVertexArray=new nl,this.symbolInstances=new tl,this.textAnchorOffsets=new sl}calculateGlyphDependencies(e,t,n,i,s){for(let o=0;o<e.length;o++)if(t[e.charCodeAt(o)]=!0,(n||i)&&s){const a=Kr[e.charAt(o)];a&&(t[a.charCodeAt(0)]=!0)}}populate(e,t,n){const i=this.layers[0],s=i.layout,o=s.get("text-font"),a=s.get("text-field"),l=s.get("icon-image"),u=(a.value.kind!=="constant"||a.value.value instanceof Ee&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&(o.value.kind!=="constant"||o.value.value.length>0),c=l.value.kind!=="constant"||!!l.value.value||Object.keys(l.parameters).length>0,h=s.get("symbol-sort-key");if(this.features=[],!u&&!c)return;const p=t.iconDependencies,f=t.glyphDependencies,d=t.availableImages,y=new ie(this.zoom);for(const{feature:m,id:g,index:x,sourceLayerIndex:v}of e){const w=i._featureFilter.needGeometry,b=or(m,w);if(!i._featureFilter.filter(y,b,n))continue;let S,A;if(w||(b.geometry=Lt(m)),u){const M=i.getValueAndResolveTokens("text-field",b,n,d),I=Ee.factory(M),V=this.hasRTLText=this.hasRTLText||tf(I);(!V||Ce.getRTLTextPluginStatus()==="unavailable"||V&&Ce.isParsed())&&(S=Lp(I,i,b))}if(c){const M=i.getValueAndResolveTokens("icon-image",b,n,d);A=M instanceof Ue?M:Ue.fromString(M)}if(!S&&!A)continue;const C=this.sortFeaturesByKey?h.evaluate(b,{},n):void 0;if(this.features.push({id:g,text:S,icon:A,index:x,sourceLayerIndex:v,geometry:b.geometry,properties:m.properties,type:Qp[m.type],sortKey:C}),A&&(p[A.name]=!0),S){const M=o.evaluate(b,{},n).join(","),I=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ae.vertical)>=0;for(const V of S.sections)if(V.image)p[V.image.name]=!0;else{const E=as(S.toString()),T=V.fontStack||M,k=f[T]=f[T]||{};this.calculateGlyphDependencies(V.text,k,I,this.allowVerticalPlacement,E)}}}s.get("symbol-placement")==="line"&&(this.features=(function(m){const g={},x={},v=[];let w=0;function b(M){v.push(m[M]),w++}function S(M,I,V){const E=x[M];return delete x[M],x[I]=E,v[E].geometry[0].pop(),v[E].geometry[0]=v[E].geometry[0].concat(V[0]),E}function A(M,I,V){const E=g[I];return delete g[I],g[M]=E,v[E].geometry[0].shift(),v[E].geometry[0]=V[0].concat(v[E].geometry[0]),E}function C(M,I,V){const E=V?I[0][I[0].length-1]:I[0][0];return`${M}:${E.x}:${E.y}`}for(let M=0;M<m.length;M++){const I=m[M],V=I.geometry,E=I.text?I.text.toString():null;if(!E){b(M);continue}const T=C(E,V),k=C(E,V,!0);if(T in x&&k in g&&x[T]!==g[k]){const D=A(T,k,V),F=S(T,k,v[D].geometry);delete g[T],delete x[k],x[C(E,v[F].geometry,!0)]=F,v[D].geometry=null}else T in x?S(T,k,V):k in g?A(T,k,V):(b(M),g[T]=w-1,x[k]=w-1)}return v.filter((M=>M.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((m,g)=>m.sortKey-g.sortKey))}update(e,t,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(e.segment!==void 0){let i=e.dist(t[e.segment+1]),s=e.dist(t[e.segment]);const o={};for(let a=e.segment+1;a<t.length;a++)o[a]={x:t[a].x,y:t[a].y,tileUnitDistanceFromAnchor:i},a<t.length-1&&(i+=t[a+1].dist(t[a]));for(let a=e.segment||0;a>=0;a--)o[a]={x:t[a].x,y:t[a].y,tileUnitDistanceFromAnchor:s},a>0&&(s+=t[a-1].dist(t[a]));for(let a=0;a<t.length;a++){const l=o[a];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,t,n,i,s,o,a,l,u,c,h,p){const f=e.indexArray,d=e.layoutVertexArray,y=e.segments.prepareSegment(4*t.length,d,f,this.canOverlap?o.sortKey:void 0),m=this.glyphOffsetArray.length,g=y.vertexLength,x=this.allowVerticalPlacement&&a===Ae.vertical?Math.PI/2:0,v=o.text&&o.text.sections;for(let w=0;w<t.length;w++){const{tl:b,tr:S,bl:A,br:C,tex:M,pixelOffsetTL:I,pixelOffsetBR:V,minFontScaleX:E,minFontScaleY:T,glyphOffset:k,isSDF:D,sectionIndex:F}=t[w],j=y.vertexLength,G=k[1];ii(d,l.x,l.y,b.x,G+b.y,M.x,M.y,n,D,I.x,I.y,E,T),ii(d,l.x,l.y,S.x,G+S.y,M.x+M.w,M.y,n,D,V.x,I.y,E,T),ii(d,l.x,l.y,A.x,G+A.y,M.x,M.y+M.h,n,D,I.x,V.y,E,T),ii(d,l.x,l.y,C.x,G+C.y,M.x+M.w,M.y+M.h,n,D,V.x,V.y,E,T),yu(e.dynamicLayoutVertexArray,l,x),f.emplaceBack(j,j+1,j+2),f.emplaceBack(j+1,j+2,j+3),y.vertexLength+=4,y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(k[0]),w!==t.length-1&&F===t[w+1].sectionIndex||e.programConfigurations.populatePaintArrays(d.length,o,o.index,{},p,v&&v[F])}e.placedSymbolArray.emplaceBack(l.x,l.y,m,this.glyphOffsetArray.length-m,g,u,c,l.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],a,0,!1,0,h)}_addCollisionDebugVertex(e,t,n,i,s,o){return t.emplaceBack(0,0),e.emplaceBack(n.x,n.y,i,s,Math.round(o.x),Math.round(o.y))}addCollisionDebugVertices(e,t,n,i,s,o,a){const l=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),u=l.vertexLength,c=s.layoutVertexArray,h=s.collisionVertexArray,p=a.anchorX,f=a.anchorY;this._addCollisionDebugVertex(c,h,o,p,f,new R(e,t)),this._addCollisionDebugVertex(c,h,o,p,f,new R(n,t)),this._addCollisionDebugVertex(c,h,o,p,f,new R(n,i)),this._addCollisionDebugVertex(c,h,o,p,f,new R(e,i)),l.vertexLength+=4;const d=s.indexArray;d.emplaceBack(u,u+1),d.emplaceBack(u+1,u+2),d.emplaceBack(u+2,u+3),d.emplaceBack(u+3,u),l.primitiveLength+=4}addDebugCollisionBoxes(e,t,n,i){for(let s=e;s<t;s++){const o=this.collisionBoxArray.get(s);this.addCollisionDebugVertices(o.x1,o.y1,o.x2,o.y2,i?this.textCollisionBox:this.iconCollisionBox,o.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new eo(ll,Xl.members,Cs),this.iconCollisionBox=new eo(ll,Xl.members,Cs);for(let e=0;e<this.symbolInstances.length;e++){const t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}}_deserializeCollisionBoxesForSymbol(e,t,n,i,s,o,a,l,u){const c={};for(let h=t;h<n;h++){const p=e.get(h);c.textBox={x1:p.x1,y1:p.y1,x2:p.x2,y2:p.y2,anchorPointX:p.anchorPointX,anchorPointY:p.anchorPointY},c.textFeatureIndex=p.featureIndex;break}for(let h=i;h<s;h++){const p=e.get(h);c.verticalTextBox={x1:p.x1,y1:p.y1,x2:p.x2,y2:p.y2,anchorPointX:p.anchorPointX,anchorPointY:p.anchorPointY},c.verticalTextFeatureIndex=p.featureIndex;break}for(let h=o;h<a;h++){const p=e.get(h);c.iconBox={x1:p.x1,y1:p.y1,x2:p.x2,y2:p.y2,anchorPointX:p.anchorPointX,anchorPointY:p.anchorPointY},c.iconFeatureIndex=p.featureIndex;break}for(let h=l;h<u;h++){const p=e.get(h);c.verticalIconBox={x1:p.x1,y1:p.y1,x2:p.x2,y2:p.y2,anchorPointX:p.anchorPointX,anchorPointY:p.anchorPointY},c.verticalIconFeatureIndex=p.featureIndex;break}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),i=n.vertexStartIndex+4*n.numGlyphs;for(let s=n.vertexStartIndex;s<i;s+=4)e.indexArray.emplaceBack(s,s+1,s+2),e.indexArray.emplaceBack(s+1,s+2,s+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),i=[],s=[],o=[];for(let a=0;a<this.symbolInstances.length;++a){o.push(a);const l=this.symbolInstances.get(a);i.push(0|Math.round(t*l.anchorX+n*l.anchorY)),s.push(l.featureIndex)}return o.sort(((a,l)=>i[a]-i[l]||s[l]-s[a])),o}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const n=this.symbolInstances.get(t);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach(((i,s,o)=>{i>=0&&o.indexOf(i)===s&&this.addIndicesForPlacedSymbol(this.text,i)})),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let mu,gu;B("SymbolBucket",fr,{omit:["layers","collisionBoxArray","features","compareText"]}),fr.MAX_GLYPHS=65535,fr.addDynamicAttributes=yu;var to={get paint(){return gu=gu||new De({"icon-opacity":new O(_.paint_symbol["icon-opacity"]),"icon-color":new O(_.paint_symbol["icon-color"]),"icon-halo-color":new O(_.paint_symbol["icon-halo-color"]),"icon-halo-width":new O(_.paint_symbol["icon-halo-width"]),"icon-halo-blur":new O(_.paint_symbol["icon-halo-blur"]),"icon-translate":new $(_.paint_symbol["icon-translate"]),"icon-translate-anchor":new $(_.paint_symbol["icon-translate-anchor"]),"text-opacity":new O(_.paint_symbol["text-opacity"]),"text-color":new O(_.paint_symbol["text-color"],{runtimeType:He,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new O(_.paint_symbol["text-halo-color"]),"text-halo-width":new O(_.paint_symbol["text-halo-width"]),"text-halo-blur":new O(_.paint_symbol["text-halo-blur"]),"text-translate":new $(_.paint_symbol["text-translate"]),"text-translate-anchor":new $(_.paint_symbol["text-translate-anchor"])})},get layout(){return mu=mu||new De({"symbol-placement":new $(_.layout_symbol["symbol-placement"]),"symbol-spacing":new $(_.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $(_.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new O(_.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $(_.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $(_.layout_symbol["icon-allow-overlap"]),"icon-overlap":new $(_.layout_symbol["icon-overlap"]),"icon-ignore-placement":new $(_.layout_symbol["icon-ignore-placement"]),"icon-optional":new $(_.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $(_.layout_symbol["icon-rotation-alignment"]),"icon-size":new O(_.layout_symbol["icon-size"]),"icon-text-fit":new $(_.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $(_.layout_symbol["icon-text-fit-padding"]),"icon-image":new O(_.layout_symbol["icon-image"]),"icon-rotate":new O(_.layout_symbol["icon-rotate"]),"icon-padding":new O(_.layout_symbol["icon-padding"]),"icon-keep-upright":new $(_.layout_symbol["icon-keep-upright"]),"icon-offset":new O(_.layout_symbol["icon-offset"]),"icon-anchor":new O(_.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $(_.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $(_.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $(_.layout_symbol["text-rotation-alignment"]),"text-field":new O(_.layout_symbol["text-field"]),"text-font":new O(_.layout_symbol["text-font"]),"text-size":new O(_.layout_symbol["text-size"]),"text-max-width":new O(_.layout_symbol["text-max-width"]),"text-line-height":new $(_.layout_symbol["text-line-height"]),"text-letter-spacing":new O(_.layout_symbol["text-letter-spacing"]),"text-justify":new O(_.layout_symbol["text-justify"]),"text-radial-offset":new O(_.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $(_.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new O(_.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new O(_.layout_symbol["text-anchor"]),"text-max-angle":new $(_.layout_symbol["text-max-angle"]),"text-writing-mode":new $(_.layout_symbol["text-writing-mode"]),"text-rotate":new O(_.layout_symbol["text-rotate"]),"text-padding":new $(_.layout_symbol["text-padding"]),"text-keep-upright":new $(_.layout_symbol["text-keep-upright"]),"text-transform":new O(_.layout_symbol["text-transform"]),"text-offset":new O(_.layout_symbol["text-offset"]),"text-allow-overlap":new $(_.layout_symbol["text-allow-overlap"]),"text-overlap":new $(_.layout_symbol["text-overlap"]),"text-ignore-placement":new $(_.layout_symbol["text-ignore-placement"]),"text-optional":new $(_.layout_symbol["text-optional"])})}};class xu{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:_r,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}B("FormatSectionOverride",xu,{omit:["defaultValue"]});class si extends at{constructor(e){super(e,to)}recalculate(e,t){if(super.recalculate(e,t),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const n=this.layout.get("text-writing-mode");if(n){const i=[];for(const s of n)i.indexOf(s)<0&&i.push(s);this.layout._values["text-writing-mode"]=i}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,i){const s=this.layout.get(e).evaluate(t,{},n,i),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||En(o.value)||!s?s:(function(a,l){return l.replace(/{([^{}]+)}/g,((u,c)=>a&&c in a?String(a[c]):""))})(t.properties,s)}createBucket(e){return new fr(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of to.paint.overridableProperties){if(!si.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new xu(t),i=new Gi(n,t.property.specification);let s=null;s=t.value.kind==="constant"||t.value.kind==="source"?new Xi("source",i):new Hi("composite",i,t.value.zoomStops),this.paint._values[e]=new ot(t.property,s,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&si.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),i=to.paint.properties[t];let s=!1;const o=a=>{for(const l of a)if(i.overrides&&i.overrides.hasOverride(l))return void(s=!0)};if(n.value.kind==="constant"&&n.value.value instanceof Ee)o(n.value.value.sections);else if(n.value.kind==="source"){const a=u=>{s||(u instanceof Pt&&ye(u.value)===Sr?o(u.value.sections):u instanceof Sn?o(u.sections):u.eachChild(a))},l=n.value;l._styleExpression&&a(l._styleExpression.expression)}return s}}let vu;var rf={get paint(){return vu=vu||new De({"background-color":new $(_.paint_background["background-color"]),"background-pattern":new hs(_.paint_background["background-pattern"]),"background-opacity":new $(_.paint_background["background-opacity"])})}};class nf extends at{constructor(e){super(e,rf)}}let bu;var sf={get paint(){return bu=bu||new De({"raster-opacity":new $(_.paint_raster["raster-opacity"]),"raster-hue-rotate":new $(_.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $(_.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $(_.paint_raster["raster-brightness-max"]),"raster-saturation":new $(_.paint_raster["raster-saturation"]),"raster-contrast":new $(_.paint_raster["raster-contrast"]),"raster-resampling":new $(_.paint_raster["raster-resampling"]),"raster-fade-duration":new $(_.paint_raster["raster-fade-duration"])})}};class of extends at{constructor(e){super(e,sf)}}class af extends at{constructor(e){super(e,{}),this.onAdd=t=>{this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},this.onRemove=t=>{this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}function lf(r){if(r.type==="custom")return new af(r);switch(r.type){case"background":return new nf(r);case"circle":return new Hh(r);case"fill":return new hp(r);case"fill-extrusion":return new Ip(r);case"heatmap":return new Jh(r);case"hillshade":return new Wh(r);case"line":return new Ep(r);case"raster":return new of(r);case"symbol":return new si(r)}}class uf{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(e,t){for(const i of e){this._layerConfigs[i.id]=i;const s=this._layers[i.id]=lf(i);s._featureFilter=Ji(s.filter),this.keyCache[i.id]&&delete this.keyCache[i.id]}for(const i of t)delete this.keyCache[i],delete this._layerConfigs[i],delete this._layers[i];this.familiesBySource={};const n=(function(i,s){const o={};for(let l=0;l<i.length;l++){const u=s&&s[i[l].id]||ah(i[l]);s&&(s[i[l].id]=u);let c=o[u];c||(c=o[u]=[]),c.push(i[l])}const a=[];for(const l in o)a.push(o[l]);return a})(Object.values(this._layerConfigs),this.keyCache);for(const i of n){const s=i.map((h=>this._layers[h.id])),o=s[0];if(o.visibility==="none")continue;const a=o.source||"";let l=this.familiesBySource[a];l||(l=this.familiesBySource[a]={});const u=o.sourceLayer||"_geojsonTileLayer";let c=l[u];c||(c=l[u]=[]),c.push(s)}}}class wu{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class cf{constructor(e,t,n,i,s){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=n,e._y=i,this.properties=e.properties,this.id=s}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e}}class _u{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new wr(ue,16,0),this.grid3D=new wr(ue,16,0),this.featureIndexArray=new al,this.promoteId=t}insert(e,t,n,i,s,o){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,s);const l=o?this.grid3D:this.grid;for(let u=0;u<t.length;u++){const c=t[u],h=[1/0,1/0,-1/0,-1/0];for(let p=0;p<c.length;p++){const f=c[p];h[0]=Math.min(h[0],f.x),h[1]=Math.min(h[1],f.y),h[2]=Math.max(h[2],f.x),h[3]=Math.max(h[3],f.y)}h[0]<ue&&h[1]<ue&&h[2]>=0&&h[3]>=0&&l.insert(a,h[0],h[1],h[2],h[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new lt.VectorTile(new tu(this.rawTileData)).layers,this.sourceLayerCoder=new wu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,t,n,i){this.loadVTLayers();const s=e.params||{},o=ue/e.tileSize/e.scale,a=Ji(s.filter),l=e.queryGeometry,u=e.queryPadding*o,c=ku(l),h=this.grid.query(c.minX-u,c.minY-u,c.maxX+u,c.maxY+u),p=ku(e.cameraQueryGeometry),f=this.grid3D.query(p.minX-u,p.minY-u,p.maxX+u,p.maxY+u,((m,g,x,v)=>(function(w,b,S,A,C){for(const I of w)if(b<=I.x&&S<=I.y&&A>=I.x&&C>=I.y)return!0;const M=[new R(b,S),new R(b,C),new R(A,C),new R(A,S)];if(w.length>2){for(const I of M)if(ar(w,I))return!0}for(let I=0;I<w.length-1;I++)if(Gh(w[I],w[I+1],M))return!0;return!1})(e.cameraQueryGeometry,m-u,g-u,x+u,v+u)));for(const m of f)h.push(m);h.sort(hf);const d={};let y;for(let m=0;m<h.length;m++){const g=h[m];if(g===y)continue;y=g;const x=this.featureIndexArray.get(g);let v=null;this.loadMatchingFeature(d,x.bucketIndex,x.sourceLayerIndex,x.featureIndex,a,s.layers,s.availableImages,t,n,i,((w,b,S)=>(v||(v=Lt(w)),b.queryIntersectsFeature(l,w,S,v,this.z,e.transform,o,e.pixelPosMatrix))))}return d}loadMatchingFeature(e,t,n,i,s,o,a,l,u,c,h){const p=this.bucketLayerIDs[t];if(o&&!(function(m,g){for(let x=0;x<m.length;x++)if(g.indexOf(m[x])>=0)return!0;return!1})(o,p))return;const f=this.sourceLayerCoder.decode(n),d=this.vtLayers[f].feature(i);if(s.needGeometry){const m=or(d,!0);if(!s.filter(new ie(this.tileID.overscaledZ),m,this.tileID.canonical))return}else if(!s.filter(new ie(this.tileID.overscaledZ),d))return;const y=this.getId(d,f);for(let m=0;m<p.length;m++){const g=p[m];if(o&&o.indexOf(g)<0)continue;const x=l[g];if(!x)continue;let v={};y&&c&&(v=c.getState(x.sourceLayer||"_geojsonTileLayer",y));const w=et({},u[g]);w.paint=Su(w.paint,x.paint,d,v,a),w.layout=Su(w.layout,x.layout,d,v,a);const b=!h||h(d,x,v);if(!b)continue;const S=new cf(d,this.z,this.x,this.y,y);S.layer=w;let A=e[g];A===void 0&&(A=e[g]=[]),A.push({featureIndex:i,feature:S,intersectionZ:b})}}lookupSymbolFeatures(e,t,n,i,s,o,a,l){const u={};this.loadVTLayers();const c=Ji(s);for(const h of e)this.loadMatchingFeature(u,n,i,h,c,o,a,l,t);return u}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;return this.promoteId&&(n=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]],typeof n=="boolean"&&(n=Number(n))),n}}function Su(r,e,t,n,i){return gi(r,((s,o)=>{const a=e instanceof Rn?e.get(o):null;return a&&a.evaluate?a.evaluate(t,n,i):a}))}function ku(r){let e=1/0,t=1/0,n=-1/0,i=-1/0;for(const s of r)e=Math.min(e,s.x),t=Math.min(t,s.y),n=Math.max(n,s.x),i=Math.max(i,s.y);return{minX:e,minY:t,maxX:n,maxY:i}}function hf(r,e){return e-r}B("FeatureIndex",_u,{omit:["rawTileData","sourceLayerCoder"]});class kt extends R{constructor(e,t,n,i){super(e,t),this.angle=n,i!==void 0&&(this.segment=i)}clone(){return new kt(this.x,this.y,this.angle,this.segment)}}function Au(r,e,t,n,i){if(e.segment===void 0||t===0)return!0;let s=e,o=e.segment+1,a=0;for(;a>-t/2;){if(o--,o<0)return!1;a-=r[o].dist(s),s=r[o]}a+=r[o].dist(r[o+1]),o++;const l=[];let u=0;for(;a<t/2;){const c=r[o],h=r[o+1];if(!h)return!1;let p=r[o-1].angleTo(c)-c.angleTo(h);for(p=Math.abs((p+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:p}),u+=p;a-l[0].distance>n;)u-=l.shift().angleDelta;if(u>i)return!1;o++,a+=c.dist(h)}return!0}function Iu(r){let e=0;for(let t=0;t<r.length-1;t++)e+=r[t].dist(r[t+1]);return e}function Mu(r,e,t){return r?.6*e*t:0}function zu(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function pf(r,e,t,n,i,s){const o=Mu(t,i,s),a=zu(t,n)*s;let l=0;const u=Iu(r)/2;for(let c=0;c<r.length-1;c++){const h=r[c],p=r[c+1],f=h.dist(p);if(l+f>u){const d=(u-l)/f,y=rt.number(h.x,p.x,d),m=rt.number(h.y,p.y,d),g=new kt(y,m,p.angleTo(h),c);return g._round(),!o||Au(r,g,a,o,e)?g:void 0}l+=f}}function ff(r,e,t,n,i,s,o,a,l){const u=Mu(n,s,o),c=zu(n,i),h=c*o,p=r[0].x===0||r[0].x===l||r[0].y===0||r[0].y===l;return e-h<e/4&&(e=h+e/4),Pu(r,p?e/2*a%e:(c/2+2*s)*o*a%e,e,u,t,h,p,!1,l)}function Pu(r,e,t,n,i,s,o,a,l){const u=s/2,c=Iu(r);let h=0,p=e-t,f=[];for(let d=0;d<r.length-1;d++){const y=r[d],m=r[d+1],g=y.dist(m),x=m.angleTo(y);for(;p+t<h+g;){p+=t;const v=(p-h)/g,w=rt.number(y.x,m.x,v),b=rt.number(y.y,m.y,v);if(w>=0&&w<l&&b>=0&&b<l&&p-u>=0&&p+u<=c){const S=new kt(w,b,x,d);S._round(),n&&!Au(r,S,s,n,i)||f.push(S)}}h+=g}return a||f.length||o||(f=Pu(r,h/2,t,n,i,s,o,!0,l)),f}B("Anchor",kt);const dr=ze;function Cu(r,e,t,n){const i=[],s=r.image,o=s.pixelRatio,a=s.paddedRect.w-2*dr,l=s.paddedRect.h-2*dr;let u={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const c=s.stretchX||[[0,a]],h=s.stretchY||[[0,l]],p=(k,D)=>k+D[1]-D[0],f=c.reduce(p,0),d=h.reduce(p,0),y=a-f,m=l-d;let g=0,x=f,v=0,w=d,b=0,S=y,A=0,C=m;if(s.content&&n){const k=s.content,D=k[2]-k[0],F=k[3]-k[1];(s.textFitWidth||s.textFitHeight)&&(u=hu(r)),g=oi(c,0,k[0]),v=oi(h,0,k[1]),x=oi(c,k[0],k[2]),w=oi(h,k[1],k[3]),b=k[0]-g,A=k[1]-v,S=D-x,C=F-w}const M=u.x1,I=u.y1,V=u.x2-M,E=u.y2-I,T=(k,D,F,j)=>{const G=ai(k.stretch-g,x,V,M),U=li(k.fixed-b,S,k.stretch,f),ne=ai(D.stretch-v,w,E,I),Ie=li(D.fixed-A,C,D.stretch,d),pe=ai(F.stretch-g,x,V,M),re=li(F.fixed-b,S,F.stretch,f),de=ai(j.stretch-v,w,E,I),L=li(j.fixed-A,C,j.stretch,d),N=new R(G,ne),ae=new R(pe,ne),xe=new R(pe,de),_e=new R(G,de),be=new R(U/o,Ie/o),Me=new R(re/o,L/o),we=e*Math.PI/180;if(we){const Y=Math.sin(we),ee=Math.cos(we),te=[ee,-Y,Y,ee];N._matMult(te),ae._matMult(te),_e._matMult(te),xe._matMult(te)}const Oe=k.stretch+k.fixed,Pe=D.stretch+D.fixed;return{tl:N,tr:ae,bl:_e,br:xe,tex:{x:s.paddedRect.x+dr+Oe,y:s.paddedRect.y+dr+Pe,w:F.stretch+F.fixed-Oe,h:j.stretch+j.fixed-Pe},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:be,pixelOffsetBR:Me,minFontScaleX:S/o/V,minFontScaleY:C/o/E,isSDF:t}};if(n&&(s.stretchX||s.stretchY)){const k=Bu(c,y,f),D=Bu(h,m,d);for(let F=0;F<k.length-1;F++){const j=k[F],G=k[F+1];for(let U=0;U<D.length-1;U++)i.push(T(j,D[U],G,D[U+1]))}}else i.push(T({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:l+1}));return i}function oi(r,e,t){let n=0;for(const i of r)n+=Math.max(e,Math.min(t,i[1]))-Math.max(e,Math.min(t,i[0]));return n}function Bu(r,e,t){const n=[{fixed:-dr,stretch:0}];for(const[i,s]of r){const o=n[n.length-1];n.push({fixed:i-o.stretch,stretch:o.stretch}),n.push({fixed:i-o.stretch,stretch:o.stretch+(s-i)})}return n.push({fixed:e+dr,stretch:t}),n}function ai(r,e,t,n){return r/e*t+n}function li(r,e,t,n){return r-e*t/n}class ui{constructor(e,t,n,i,s,o,a,l,u,c){var h;if(this.boxStartIndex=e.length,u){let p=o.top,f=o.bottom;const d=o.collisionPadding;d&&(p-=d[1],f+=d[3]);let y=f-p;y>0&&(y=Math.max(10,y),this.circleDiameter=y)}else{const p=!((h=o.image)===null||h===void 0)&&h.content&&(o.image.textFitWidth||o.image.textFitHeight)?hu(o):{x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};p.y1=p.y1*a-l[0],p.y2=p.y2*a+l[2],p.x1=p.x1*a-l[3],p.x2=p.x2*a+l[1];const f=o.collisionPadding;if(f&&(p.x1-=f[0]*a,p.y1-=f[1]*a,p.x2+=f[2]*a,p.y2+=f[3]*a),c){const d=new R(p.x1,p.y1),y=new R(p.x2,p.y1),m=new R(p.x1,p.y2),g=new R(p.x2,p.y2),x=c*Math.PI/180;d._rotate(x),y._rotate(x),m._rotate(x),g._rotate(x),p.x1=Math.min(d.x,y.x,m.x,g.x),p.x2=Math.max(d.x,y.x,m.x,g.x),p.y1=Math.min(d.y,y.y,m.y,g.y),p.y2=Math.max(d.y,y.y,m.y,g.y)}e.emplaceBack(t.x,t.y,p.x1,p.y1,p.x2,p.y2,n,i,s)}this.boxEndIndex=e.length}}class df{constructor(e=[],t=((n,i)=>n<i?-1:n>i?1:0)){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const s=e-1>>1,o=t[s];if(n(i,o)>=0)break;t[e]=o,e=s}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,s=t[e];for(;e<i;){let o=1+(e<<1);const a=o+1;if(a<this.length&&n(t[a],t[o])<0&&(o=a),n(t[o],s)>=0)break;t[e]=t[o],e=o}t[e]=s}}function yf(r,e=1,t=!1){let n=1/0,i=1/0,s=-1/0,o=-1/0;const a=r[0];for(let f=0;f<a.length;f++){const d=a[f];(!f||d.x<n)&&(n=d.x),(!f||d.y<i)&&(i=d.y),(!f||d.x>s)&&(s=d.x),(!f||d.y>o)&&(o=d.y)}const l=Math.min(s-n,o-i);let u=l/2;const c=new df([],mf);if(l===0)return new R(n,i);for(let f=n;f<s;f+=l)for(let d=i;d<o;d+=l)c.push(new yr(f+u,d+u,u,r));let h=(function(f){let d=0,y=0,m=0;const g=f[0];for(let x=0,v=g.length,w=v-1;x<v;w=x++){const b=g[x],S=g[w],A=b.x*S.y-S.x*b.y;y+=(b.x+S.x)*A,m+=(b.y+S.y)*A,d+=3*A}return new yr(y/d,m/d,0,f)})(r),p=c.length;for(;c.length;){const f=c.pop();(f.d>h.d||!h.d)&&(h=f,t&&console.log("found best %d after %d probes",Math.round(1e4*f.d)/1e4,p)),f.max-h.d<=e||(u=f.h/2,c.push(new yr(f.p.x-u,f.p.y-u,u,r)),c.push(new yr(f.p.x+u,f.p.y-u,u,r)),c.push(new yr(f.p.x-u,f.p.y+u,u,r)),c.push(new yr(f.p.x+u,f.p.y+u,u,r)),p+=4)}return t&&(console.log(`num probes: ${p}`),console.log(`best distance: ${h.d}`)),h.p}function mf(r,e){return e.max-r.max}function yr(r,e,t,n){this.p=new R(r,e),this.h=t,this.d=(function(i,s){let o=!1,a=1/0;for(let l=0;l<s.length;l++){const u=s[l];for(let c=0,h=u.length,p=h-1;c<h;p=c++){const f=u[c],d=u[p];f.y>i.y!=d.y>i.y&&i.x<(d.x-f.x)*(i.y-f.y)/(d.y-f.y)+f.x&&(o=!o),a=Math.min(a,xl(i,f,d))}}return(o?1:-1)*Math.sqrt(a)})(this.p,n),this.max=this.d+this.h*Math.SQRT2}var ro;(function(r){r[r.center=1]="center",r[r.left=2]="left",r[r.right=3]="right",r[r.top=4]="top",r[r.bottom=5]="bottom",r[r["top-left"]=6]="top-left",r[r["top-right"]=7]="top-right",r[r["bottom-left"]=8]="bottom-left",r[r["bottom-right"]=9]="bottom-right"})(ro||(ro={}));const At=7,no=Number.POSITIVE_INFINITY;function Vu(r,e){return e[1]!==no?(function(t,n,i){let s=0,o=0;switch(n=Math.abs(n),i=Math.abs(i),t){case"top-right":case"top-left":case"top":o=i-At;break;case"bottom-right":case"bottom-left":case"bottom":o=-i+At}switch(t){case"top-right":case"bottom-right":case"right":s=-n;break;case"top-left":case"bottom-left":case"left":s=n}return[s,o]})(r,e[0],e[1]):(function(t,n){let i=0,s=0;n<0&&(n=0);const o=n/Math.SQRT2;switch(t){case"top-right":case"top-left":s=o-At;break;case"bottom-right":case"bottom-left":s=-o+At;break;case"bottom":s=-n+At;break;case"top":s=n-At}switch(t){case"top-right":case"bottom-right":i=-o;break;case"top-left":case"bottom-left":i=o;break;case"left":i=n;break;case"right":i=-n}return[i,s]})(r,e[0])}function Tu(r,e,t){var n;const i=r.layout,s=(n=i.get("text-variable-anchor-offset"))===null||n===void 0?void 0:n.evaluate(e,{},t);if(s){const a=s.values,l=[];for(let u=0;u<a.length;u+=2){const c=l[u]=a[u],h=a[u+1].map((p=>p*ge));c.startsWith("top")?h[1]-=At:c.startsWith("bottom")&&(h[1]+=At),l[u+1]=h}return new Ne(l)}const o=i.get("text-variable-anchor");if(o){let a;a=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[i.get("text-radial-offset").evaluate(e,{},t)*ge,no]:i.get("text-offset").evaluate(e,{},t).map((u=>u*ge));const l=[];for(const u of o)l.push(u,Vu(u,a));return new Ne(l)}return null}function gf(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=ue/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0],t=e.layout,n=e._unevaluatedLayout._values,i={layoutIconSize:n["icon-size"].possiblyEvaluate(new ie(r.bucket.zoom+1),r.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new ie(r.bucket.zoom+1),r.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new ie(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:u,maxZoom:c}=r.bucket.textSizeData;i.compositeTextSizes=[n["text-size"].possiblyEvaluate(new ie(u),r.canonical),n["text-size"].possiblyEvaluate(new ie(c),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:u,maxZoom:c}=r.bucket.iconSizeData;i.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new ie(u),r.canonical),n["icon-size"].possiblyEvaluate(new ie(c),r.canonical)]}const s=t.get("text-line-height")*ge,o=t.get("text-rotation-alignment")!=="viewport"&&t.get("symbol-placement")!=="point",a=t.get("text-keep-upright"),l=t.get("text-size");for(const u of r.bucket.features){const c=t.get("text-font").evaluate(u,{},r.canonical).join(","),h=l.evaluate(u,{},r.canonical),p=i.layoutTextSize.evaluate(u,{},r.canonical),f=i.layoutIconSize.evaluate(u,{},r.canonical),d={horizontal:{},vertical:void 0},y=u.text;let m,g=[0,0];if(y){const w=y.toString(),b=t.get("text-letter-spacing").evaluate(u,{},r.canonical)*ge,S=mh(w)?b:0,A=t.get("text-anchor").evaluate(u,{},r.canonical),C=Tu(e,u,r.canonical);if(!C){const E=t.get("text-radial-offset").evaluate(u,{},r.canonical);g=E?Vu(A,[E*ge,no]):t.get("text-offset").evaluate(u,{},r.canonical).map((T=>T*ge))}let M=o?"center":t.get("text-justify").evaluate(u,{},r.canonical);const I=t.get("symbol-placement")==="point"?t.get("text-max-width").evaluate(u,{},r.canonical)*ge:1/0,V=()=>{r.bucket.allowVerticalPlacement&&as(w)&&(d.vertical=ri(y,r.glyphMap,r.glyphPositions,r.imagePositions,c,I,s,A,"left",S,g,Ae.vertical,!0,p,h))};if(!o&&C){const E=new Set;if(M==="auto")for(let k=0;k<C.values.length;k+=2)E.add(Eu(C.values[k]));else E.add(M);let T=!1;for(const k of E)if(!d.horizontal[k])if(T)d.horizontal[k]=d.horizontal[0];else{const D=ri(y,r.glyphMap,r.glyphPositions,r.imagePositions,c,I,s,"center",k,S,g,Ae.horizontal,!1,p,h);D&&(d.horizontal[k]=D,T=D.positionedLines.length===1)}V()}else{M==="auto"&&(M=Eu(A));const E=ri(y,r.glyphMap,r.glyphPositions,r.imagePositions,c,I,s,A,M,S,g,Ae.horizontal,!1,p,h);E&&(d.horizontal[M]=E),V(),as(w)&&o&&a&&(d.vertical=ri(y,r.glyphMap,r.glyphPositions,r.imagePositions,c,I,s,A,M,S,g,Ae.vertical,!1,p,h))}}let x=!1;if(u.icon&&u.icon.name){const w=r.imageMap[u.icon.name];w&&(m=Wp(r.imagePositions[u.icon.name],t.get("icon-offset").evaluate(u,{},r.canonical),t.get("icon-anchor").evaluate(u,{},r.canonical)),x=!!w.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=x:r.bucket.sdfIcons!==x&&Ve("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(w.pixelRatio!==r.bucket.pixelRatio||t.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const v=Du(d.horizontal)||d.vertical;r.bucket.iconsInText=!!v&&v.iconsInText,(v||m)&&xf(r.bucket,u,d,m,r.imageMap,i,p,f,g,x,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()}function Eu(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function xf(r,e,t,n,i,s,o,a,l,u,c){let h=s.textMaxSize.evaluate(e,{});h===void 0&&(h=o);const p=r.layers[0].layout,f=p.get("icon-offset").evaluate(e,{},c),d=Du(t.horizontal),y=o/24,m=r.tilePixelRatio*y,g=r.tilePixelRatio*h/24,x=r.tilePixelRatio*a,v=r.tilePixelRatio*p.get("symbol-spacing"),w=p.get("text-padding")*r.tilePixelRatio,b=(function(k,D,F,j=1){const G=k.get("icon-padding").evaluate(D,{},F),U=G&&G.values;return[U[0]*j,U[1]*j,U[2]*j,U[3]*j]})(p,e,c,r.tilePixelRatio),S=p.get("text-max-angle")/180*Math.PI,A=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point",C=p.get("icon-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point",M=p.get("symbol-placement"),I=v/2,V=p.get("icon-text-fit");let E;n&&V!=="none"&&(r.allowVerticalPlacement&&t.vertical&&(E=pu(n,t.vertical,V,p.get("icon-text-fit-padding"),f,y)),d&&(n=pu(n,d,V,p.get("icon-text-fit-padding"),f,y)));const T=(k,D)=>{D.x<0||D.x>=ue||D.y<0||D.y>=ue||(function(F,j,G,U,ne,Ie,pe,re,de,L,N,ae,xe,_e,be,Me,we,Oe,Pe,Y,ee,te,Be,se,gr){const ut=F.addToLineVertexArray(j,G);let ct,Xe,je,ve,gt=0,an=0,mc=0,gc=0,_o=-1,So=-1;const xt={};let xc=Bs("");if(F.allowVerticalPlacement&&U.vertical){const Se=re.layout.get("text-rotate").evaluate(ee,{},se)+90;je=new ui(de,j,L,N,ae,U.vertical,xe,_e,be,Se),pe&&(ve=new ui(de,j,L,N,ae,pe,we,Oe,be,Se))}if(ne){const Se=re.layout.get("icon-rotate").evaluate(ee,{}),Re=re.layout.get("icon-text-fit")!=="none",Nt=Cu(ne,Se,Be,Re),Qe=pe?Cu(pe,Se,Be,Re):void 0;Xe=new ui(de,j,L,N,ae,ne,we,Oe,!1,Se),gt=4*Nt.length;const Ut=F.iconSizeData;let ht=null;Ut.kind==="source"?(ht=[jt*re.layout.get("icon-size").evaluate(ee,{})],ht[0]>St&&Ve(`${F.layerIds[0]}: Value for "icon-size" is >= ${en}. Reduce your "icon-size".`)):Ut.kind==="composite"&&(ht=[jt*te.compositeIconSizes[0].evaluate(ee,{},se),jt*te.compositeIconSizes[1].evaluate(ee,{},se)],(ht[0]>St||ht[1]>St)&&Ve(`${F.layerIds[0]}: Value for "icon-size" is >= ${en}. Reduce your "icon-size".`)),F.addSymbols(F.icon,Nt,ht,Y,Pe,ee,Ae.none,j,ut.lineStartIndex,ut.lineLength,-1,se),_o=F.icon.placedSymbolArray.length-1,Qe&&(an=4*Qe.length,F.addSymbols(F.icon,Qe,ht,Y,Pe,ee,Ae.vertical,j,ut.lineStartIndex,ut.lineLength,-1,se),So=F.icon.placedSymbolArray.length-1)}const vc=Object.keys(U.horizontal);for(const Se of vc){const Re=U.horizontal[Se];if(!ct){xc=Bs(Re.text);const Qe=re.layout.get("text-rotate").evaluate(ee,{},se);ct=new ui(de,j,L,N,ae,Re,xe,_e,be,Qe)}const Nt=Re.positionedLines.length===1;if(mc+=Fu(F,j,Re,Ie,re,be,ee,Me,ut,U.vertical?Ae.horizontal:Ae.horizontalOnly,Nt?vc:[Se],xt,_o,te,se),Nt)break}U.vertical&&(gc+=Fu(F,j,U.vertical,Ie,re,be,ee,Me,ut,Ae.vertical,["vertical"],xt,So,te,se));const Xf=ct?ct.boxStartIndex:F.collisionBoxArray.length,Hf=ct?ct.boxEndIndex:F.collisionBoxArray.length,Yf=je?je.boxStartIndex:F.collisionBoxArray.length,Jf=je?je.boxEndIndex:F.collisionBoxArray.length,Kf=Xe?Xe.boxStartIndex:F.collisionBoxArray.length,Wf=Xe?Xe.boxEndIndex:F.collisionBoxArray.length,Qf=ve?ve.boxStartIndex:F.collisionBoxArray.length,ed=ve?ve.boxEndIndex:F.collisionBoxArray.length;let We=-1;const di=(Se,Re)=>Se&&Se.circleDiameter?Math.max(Se.circleDiameter,Re):Re;We=di(ct,We),We=di(je,We),We=di(Xe,We),We=di(ve,We);const bc=We>-1?1:0;bc&&(We*=gr/ge),F.glyphOffsetArray.length>=fr.MAX_GLYPHS&&Ve("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ee.sortKey!==void 0&&F.addToSortKeyRanges(F.symbolInstances.length,ee.sortKey);const td=Tu(re,ee,se),[rd,nd]=(function(Se,Re){const Nt=Se.length,Qe=Re?.values;if(Qe?.length>0)for(let Ut=0;Ut<Qe.length;Ut+=2){const ht=Qe[Ut+1];Se.emplaceBack(ro[Qe[Ut]],ht[0],ht[1])}return[Nt,Se.length]})(F.textAnchorOffsets,td);F.symbolInstances.emplaceBack(j.x,j.y,xt.right>=0?xt.right:-1,xt.center>=0?xt.center:-1,xt.left>=0?xt.left:-1,xt.vertical||-1,_o,So,xc,Xf,Hf,Yf,Jf,Kf,Wf,Qf,ed,L,mc,gc,gt,an,bc,0,xe,We,rd,nd)})(r,D,k,t,n,i,E,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,m,[w,w,w,w],A,l,x,b,C,f,e,s,u,c,o)};if(M==="line")for(const k of(function(D,F,j,G,U){const ne=[];for(let Ie=0;Ie<D.length;Ie++){const pe=D[Ie];let re;for(let de=0;de<pe.length-1;de++){let L=pe[de],N=pe[de+1];L.x<0&&N.x<0||(L.x<0?L=new R(0,L.y+(0-L.x)/(N.x-L.x)*(N.y-L.y))._round():N.x<0&&(N=new R(0,L.y+(0-L.x)/(N.x-L.x)*(N.y-L.y))._round()),L.y<0&&N.y<0||(L.y<0?L=new R(L.x+(0-L.y)/(N.y-L.y)*(N.x-L.x),0)._round():N.y<0&&(N=new R(L.x+(0-L.y)/(N.y-L.y)*(N.x-L.x),0)._round()),L.x>=G&&N.x>=G||(L.x>=G?L=new R(G,L.y+(G-L.x)/(N.x-L.x)*(N.y-L.y))._round():N.x>=G&&(N=new R(G,L.y+(G-L.x)/(N.x-L.x)*(N.y-L.y))._round()),L.y>=U&&N.y>=U||(L.y>=U?L=new R(L.x+(U-L.y)/(N.y-L.y)*(N.x-L.x),U)._round():N.y>=U&&(N=new R(L.x+(U-L.y)/(N.y-L.y)*(N.x-L.x),U)._round()),re&&L.equals(re[re.length-1])||(re=[L],ne.push(re)),re.push(N)))))}}return ne})(e.geometry,0,0,ue,ue)){const D=ff(k,v,S,t.vertical||d,n,24,g,r.overscaling,ue);for(const F of D)d&&vf(r,d.text,I,F)||T(k,F)}else if(M==="line-center"){for(const k of e.geometry)if(k.length>1){const D=pf(k,S,t.vertical||d,n,24,g);D&&T(k,D)}}else if(e.type==="Polygon")for(const k of An(e.geometry,0)){const D=yf(k,16);T(k[0],new kt(D.x,D.y,0))}else if(e.type==="LineString")for(const k of e.geometry)T(k,new kt(k[0].x,k[0].y,0));else if(e.type==="Point")for(const k of e.geometry)for(const D of k)T([D],new kt(D.x,D.y,0))}function Fu(r,e,t,n,i,s,o,a,l,u,c,h,p,f,d){const y=(function(x,v,w,b,S,A,C,M){const I=b.layout.get("text-rotate").evaluate(A,{})*Math.PI/180,V=[];for(const E of v.positionedLines)for(const T of E.positionedGlyphs){if(!T.rect)continue;const k=T.rect||{};let D=ru+1,F=!0,j=1,G=0;const U=(S||M)&&T.vertical,ne=T.metrics.advance*T.scale/2;if(M&&v.verticalizable&&(G=E.lineOffset/2-(T.imageName?-(ge-T.metrics.width*T.scale)/2:(T.scale-1)*ge)),T.imageName){const Y=C[T.imageName];F=Y.sdf,j=Y.pixelRatio,D=ze/j}const Ie=S?[T.x+ne,T.y]:[0,0];let pe=S?[0,0]:[T.x+ne+w[0],T.y+w[1]-G],re=[0,0];U&&(re=pe,pe=[0,0]);const de=T.metrics.isDoubleResolution?2:1,L=(T.metrics.left-D)*T.scale-ne+pe[0],N=(-T.metrics.top-D)*T.scale+pe[1],ae=L+k.w/de*T.scale/j,xe=N+k.h/de*T.scale/j,_e=new R(L,N),be=new R(ae,N),Me=new R(L,xe),we=new R(ae,xe);if(U){const Y=new R(-ne,ne-Wr),ee=-Math.PI/2,te=ge/2-ne,Be=new R(5-Wr-te,-(T.imageName?te:0)),se=new R(...re);_e._rotateAround(ee,Y)._add(Be)._add(se),be._rotateAround(ee,Y)._add(Be)._add(se),Me._rotateAround(ee,Y)._add(Be)._add(se),we._rotateAround(ee,Y)._add(Be)._add(se)}if(I){const Y=Math.sin(I),ee=Math.cos(I),te=[ee,-Y,Y,ee];_e._matMult(te),be._matMult(te),Me._matMult(te),we._matMult(te)}const Oe=new R(0,0),Pe=new R(0,0);V.push({tl:_e,tr:be,bl:Me,br:we,tex:k,writingMode:v.writingMode,glyphOffset:Ie,sectionIndex:T.sectionIndex,isSDF:F,pixelOffsetTL:Oe,pixelOffsetBR:Pe,minFontScaleX:0,minFontScaleY:0})}return V})(0,t,a,i,s,o,n,r.allowVerticalPlacement),m=r.textSizeData;let g=null;m.kind==="source"?(g=[jt*i.layout.get("text-size").evaluate(o,{})],g[0]>St&&Ve(`${r.layerIds[0]}: Value for "text-size" is >= ${en}. Reduce your "text-size".`)):m.kind==="composite"&&(g=[jt*f.compositeTextSizes[0].evaluate(o,{},d),jt*f.compositeTextSizes[1].evaluate(o,{},d)],(g[0]>St||g[1]>St)&&Ve(`${r.layerIds[0]}: Value for "text-size" is >= ${en}. Reduce your "text-size".`)),r.addSymbols(r.text,y,g,a,s,o,u,e,l.lineStartIndex,l.lineLength,p,d);for(const x of c)h[x]=r.text.placedSymbolArray.length-1;return 4*y.length}function Du(r){for(const e in r)return r[e];return null}function vf(r,e,t,n){const i=r.compareText;if(e in i){const s=i[e];for(let o=s.length-1;o>=0;o--)if(n.dist(s[o])<t)return!0}else i[e]=[];return i[e].push(n),!1}class $u{constructor(e){const t={},n=[];for(const a in e){const l=e[a],u=t[a]={};for(const c in l){const h=l[+c];if(!h||h.bitmap.width===0||h.bitmap.height===0)continue;const p={x:0,y:0,w:h.bitmap.width+2,h:h.bitmap.height+2};n.push(p),u[c]={rect:p,metrics:h.metrics}}}const{w:i,h:s}=nu(n),o=new Zr({width:i||1,height:s||1});for(const a in e){const l=e[a];for(const u in l){const c=l[+u];if(!c||c.bitmap.width===0||c.bitmap.height===0)continue;const h=t[a][u].rect;Zr.copy(c.bitmap,o,{x:0,y:0},{x:h.x+1,y:h.y+1},c.bitmap)}}this.image=o,this.positions=t}}function Lu(r,e,t){var n=2*Math.PI*6378137/256/Math.pow(2,t);return[r*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}B("GlyphAtlas",$u);const Ou=63710088e-1;class Rt{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Rt((function(e,t,n){const i=((e-t)%360+360)%360+t;return i===t?180:i})(this.lng,-180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,n=this.lat*t,i=e.lat*t,s=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return Ou*Math.acos(Math.min(s,1))}static convert(e){if(e instanceof Rt)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Rt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Rt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ju=2*Math.PI*Ou;function Ru(r){return ju*Math.cos(r*Math.PI/180)}function io(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class so{constructor(e,t,n=0){this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e,t=0){const n=Rt.convert(e);return new so((180+n.lng)/360,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n.lat*Math.PI/360)))/360,(function(i,s){return i/Ru(s)})(t,n.lat))}toLngLat(){return new Rt(360*this.x-180,io(this.y))}toAltitude(){return this.z*Ru(io(this.y))}meterInMercatorCoordinateUnits(){return 1/ju*(e=io(this.y),1/Math.cos(e*Math.PI/180));var e}}class Nu{constructor(e,t,n){if(!(function(i,s,o){return!(i<0||i>25||o<0||o>=Math.pow(2,i)||s<0||s>=Math.pow(2,i))})(e,t,n))throw new Error(`x=${t}, y=${n}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=t,this.y=n,this.key=tn(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t,n){const i=(o=this.y,a=this.z,l=Lu(256*(s=this.x),256*(o=Math.pow(2,a)-o-1),a),u=Lu(256*(s+1),256*(o+1),a),l[0]+","+l[1]+","+u[0]+","+u[1]);var s,o,a,l,u;const c=(function(h,p,f){let d,y="";for(let m=h;m>0;m--)d=1<<m-1,y+=(p&d?1:0)+(f&d?2:0);return y})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,t>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,i)}isChildOf(e){const t=this.z-e.z;return t>0&&e.x===this.x>>t&&e.y===this.y>>t}getTilePoint(e){const t=Math.pow(2,this.z);return new R((e.x*t-this.x)*ue,(e.y*t-this.y)*ue)}toString(){return`${this.z}/${this.x}/${this.y}`}}class bf{constructor(e,t){this.wrap=e,this.canonical=t,this.key=tn(e,t.z,t.z,t.x,t.y)}}class Le{constructor(e,t,n,i,s){if(e<n)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${n}`);this.overscaledZ=e,this.wrap=t,this.canonical=new Nu(n,+i,+s),this.key=tn(t,e,n,i,s)}clone(){return new Le(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const t=this.canonical.z-e;return e>this.canonical.z?new Le(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Le(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?tn(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):tn(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Le(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new Le(t,this.wrap,t,n,i),new Le(t,this.wrap,t,n+1,i),new Le(t,this.wrap,t,n,i+1),new Le(t,this.wrap,t,n+1,i+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Le(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Le(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new bf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new so(e.x-this.wrap,e.y))}}function tn(r,e,t,n,i){(r*=2)<0&&(r=-1*r-1);const s=1<<t;return(s*s*r+s*i+n).toString(36)+t.toString(36)+e.toString(36)}B("CanonicalTileID",Nu),B("OverscaledTileID",Le,{omit:["posMatrix"]});class wf{constructor(e){this.tileID=new Le(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.inFlightDependencies=[]}parse(e,t,n,i){return W(this,void 0,void 0,(function*(){this.status="parsing",this.data=e,this.collisionBoxArray=new Ka;const s=new wu(Object.keys(e.layers).sort()),o=new _u(this.tileID,this.promoteId);o.bucketLayerIDs=[];const a={},l={featureIndex:o,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:n},u=t.familiesBySource[this.source];for(const b in u){const S=e.layers[b];if(!S)continue;S.version===1&&Ve(`Vector tile source "${this.source}" layer "${b}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const A=s.encode(b),C=[];for(let M=0;M<S.length;M++){const I=S.feature(M),V=o.getId(I,b);C.push({feature:I,id:V,index:M,sourceLayerIndex:A})}for(const M of u[b]){const I=M[0];I.source!==this.source&&Ve(`layer.source = ${I.source} does not equal this.source = ${this.source}`),I.minzoom&&this.zoom<Math.floor(I.minzoom)||I.maxzoom&&this.zoom>=I.maxzoom||I.visibility!=="none"&&(oo(M,this.zoom,n),(a[I.id]=I.createBucket({index:o.bucketLayerIDs.length,layers:M,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:A,sourceID:this.source})).populate(C,l,this.tileID.canonical),o.bucketLayerIDs.push(M.map((V=>V.id))))}}const c=gi(l.glyphDependencies,(b=>Object.keys(b).map(Number)));this.inFlightDependencies.forEach((b=>b?.abort())),this.inFlightDependencies=[];let h=Promise.resolve({});if(Object.keys(c).length){const b=new AbortController;this.inFlightDependencies.push(b),h=i.sendAsync({type:"GG",data:{stacks:c,source:this.source,tileID:this.tileID,type:"glyphs"}},b)}const p=Object.keys(l.iconDependencies);let f=Promise.resolve({});if(p.length){const b=new AbortController;this.inFlightDependencies.push(b),f=i.sendAsync({type:"GI",data:{icons:p,source:this.source,tileID:this.tileID,type:"icons"}},b)}const d=Object.keys(l.patternDependencies);let y=Promise.resolve({});if(d.length){const b=new AbortController;this.inFlightDependencies.push(b),y=i.sendAsync({type:"GI",data:{icons:d,source:this.source,tileID:this.tileID,type:"patterns"}},b)}const[m,g,x]=yield Promise.all([h,f,y]),v=new $u(m),w=new su(g,x);for(const b in a){const S=a[b];S instanceof fr?(oo(S.layers,this.zoom,n),gf({bucket:S,glyphMap:m,glyphPositions:v.positions,imageMap:g,imagePositions:w.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):S.hasPattern&&(S instanceof Js||S instanceof Xs||S instanceof Ys)&&(oo(S.layers,this.zoom,n),S.addFeatures(l,this.tileID.canonical,w.patternPositions))}return this.status="done",{buckets:Object.values(a).filter((b=>!b.isEmpty())),featureIndex:o,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:v.image,imageAtlas:w,glyphMap:this.returnDependencies?m:null,iconMap:this.returnDependencies?g:null,glyphPositions:this.returnDependencies?v.positions:null}}))}}function oo(r,e,t){const n=new ie(e);for(const i of r)i.recalculate(n,t)}var Uu;(function(r){r.create="create",r.load="load",r.fullLoad="fullLoad"})(Uu||(Uu={}));class qu{constructor(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let e=performance.getEntriesByName(this._marks.measure);return e.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),e=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),e}}class Zu{constructor(e,t,n){this.actor=e,this.layerIndex=t,this.availableImages=n,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(e,t){return W(this,void 0,void 0,(function*(){const n=yield((i,s)=>Ea(et(i,{type:"arrayBuffer"}),s))(e.request,t);try{return{vectorTile:new lt.VectorTile(new tu(n.data)),rawData:n.data,cacheControl:n.cacheControl,expires:n.expires}}catch(i){const s=new Uint8Array(n.data);let o=`Unable to parse the tile at ${e.request.url}, `;throw o+=s[0]===31&&s[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${i.message}`,new Error(o)}}))}loadTile(e){return W(this,void 0,void 0,(function*(){const t=e.uid,n=!!(e&&e.request&&e.request.collectResourceTiming)&&new qu(e.request),i=new wf(e);this.loading[t]=i;const s=new AbortController;i.abort=s;try{const o=yield this.loadVectorTile(e,s);if(delete this.loading[t],!o)return null;const a=o.rawData,l={};o.expires&&(l.expires=o.expires),o.cacheControl&&(l.cacheControl=o.cacheControl);const u={};if(n){const h=n.finish();h&&(u.resourceTiming=JSON.parse(JSON.stringify(h)))}i.vectorTile=o.vectorTile;const c=i.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[t]=i,this.fetching[t]={rawTileData:a,cacheControl:l,resourceTiming:u};try{const h=yield c;return et({rawTileData:a.slice(0)},h,l,u)}finally{delete this.fetching[t]}}catch(o){throw delete this.loading[t],i.status="done",this.loaded[t]=i,o}}))}reloadTile(e){return W(this,void 0,void 0,(function*(){const t=e.uid;if(!this.loaded||!this.loaded[t])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const n=this.loaded[t];if(n.showCollisionBoxes=e.showCollisionBoxes,n.status==="parsing"){const i=yield n.parse(n.vectorTile,this.layerIndex,this.availableImages,this.actor);let s;if(this.fetching[t]){const{rawTileData:o,cacheControl:a,resourceTiming:l}=this.fetching[t];delete this.fetching[t],s=et({rawTileData:o.slice(0)},i,a,l)}else s=i;return s}if(n.status==="done"&&n.vectorTile)return n.parse(n.vectorTile,this.layerIndex,this.availableImages,this.actor)}))}abortTile(e){return W(this,void 0,void 0,(function*(){const t=this.loading,n=e.uid;t&&t[n]&&t[n].abort&&(t[n].abort.abort(),delete t[n])}))}removeTile(e){return W(this,void 0,void 0,(function*(){this.loaded&&this.loaded[e.uid]&&delete this.loaded[e.uid]}))}}class Gu{constructor(e,t,n,i=1,s=1,o=1,a=0){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&!["mapbox","terrarium","custom"].includes(n))return void Ve(`"${n}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=t.height;const l=this.dim=t.height-2;switch(this.data=new Uint32Array(t.data.buffer),n){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=i,this.greenFactor=s,this.blueFactor=o,this.baseShift=a;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let u=0;u<l;u++)this.data[this._idx(-1,u)]=this.data[this._idx(0,u)],this.data[this._idx(l,u)]=this.data[this._idx(l-1,u)],this.data[this._idx(u,-1)]=this.data[this._idx(u,0)],this.data[this._idx(u,l)]=this.data[this._idx(u,l-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(l,-1)]=this.data[this._idx(l-1,0)],this.data[this._idx(-1,l)]=this.data[this._idx(0,l-1)],this.data[this._idx(l,l)]=this.data[this._idx(l-1,l-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let u=0;u<l;u++)for(let c=0;c<l;c++){const h=this.get(u,c);h>this.max&&(this.max=h),h<this.min&&(this.min=h)}}get(e,t){const n=new Uint8Array(this.data.buffer),i=4*this._idx(e,t);return this.unpack(n[i],n[i+1],n[i+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}unpack(e,t,n){return e*this.redFactor+t*this.greenFactor+n*this.blueFactor-this.baseShift}getPixels(){return new $e({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let i=t*this.dim,s=t*this.dim+this.dim,o=n*this.dim,a=n*this.dim+this.dim;switch(t){case-1:i=s-1;break;case 1:s=i+1}switch(n){case-1:o=a-1;break;case 1:a=o+1}const l=-t*this.dim,u=-n*this.dim;for(let c=o;c<a;c++)for(let h=i;h<s;h++)this.data[this._idx(h,c)]=e.data[this._idx(h+l,c+u)]}}B("DEMData",Gu);class _f{constructor(){this.loaded={}}loadTile(e){return W(this,void 0,void 0,(function*(){const{uid:t,encoding:n,rawImageData:i,redFactor:s,greenFactor:o,blueFactor:a,baseShift:l}=e,u=i.width+2,c=i.height+2,h=xi(i)?new $e({width:u,height:c},yield(function(f,d,y,m,g){return W(this,void 0,void 0,(function*(){if((function(){if(ln==null&&(ln=!1,mi==null&&(mi=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),mi)){const v=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(v){for(let b=0;b<25;b++){const S=4*b;v.fillStyle=`rgb(${S},${S+1},${S+2})`,v.fillRect(b%5,Math.floor(b/5),1,1)}const w=v.getImageData(0,0,5,5).data;for(let b=0;b<100;b++)if(b%4!=3&&w[b]!==b){ln=!0;break}}}return ln||!1})())try{return yield(function(x,v,w,b,S){return W(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const A=new VideoFrame(x,{timestamp:0});try{const C=A?.format;if(!C||!C.startsWith("BGR")&&!C.startsWith("RGB"))throw new Error(`Unrecognized format ${C}`);const M=C.startsWith("BGR"),I=new Uint8ClampedArray(b*S*4);if(yield A.copyTo(I,(function(V,E,T,k,D){const F=4*Math.max(-E,0),j=(Math.max(0,T)-T)*k*4+F,G=4*k,U=Math.max(0,E),ne=Math.max(0,T);return{rect:{x:U,y:ne,width:Math.min(V.width,E+k)-U,height:Math.min(V.height,T+D)-ne},layout:[{offset:j,stride:G}]}})(x,v,w,b,S)),M)for(let V=0;V<I.length;V+=4){const E=I[V];I[V]=I[V+2],I[V+2]=E}return I}finally{A.close()}}))})(f,d,y,m,g)}catch{}return(function(x,v,w,b,S){const A=x.width,C=x.height;vr&&br||(vr=new OffscreenCanvas(A,C),br=vr.getContext("2d",{willReadFrequently:!0})),vr.width=A,vr.height=C,br.drawImage(x,0,0,A,C);const M=br.getImageData(v,w,b,S);return br.clearRect(0,0,A,C),M.data})(f,d,y,m,g)}))})(i,-1,-1,u,c)):i,p=new Gu(t,h,n,s,o,a,l);return this.loaded=this.loaded||{},this.loaded[t]=p,p}))}removeTile(e){const t=this.loaded,n=e.uid;t&&t[n]&&delete t[n]}}function Xu(r,e){if(r.length!==0){Hu(r[0],e);for(var t=1;t<r.length;t++)Hu(r[t],!e)}}function Hu(r,e){for(var t=0,n=0,i=0,s=r.length,o=s-1;i<s;o=i++){var a=(r[i][0]-r[o][0])*(r[o][1]+r[i][1]),l=t+a;n+=Math.abs(t)>=Math.abs(a)?t-l+a:a-l+t,t=l}t+n>=0!=!!e&&r.reverse()}var Sf=qt((function r(e,t){var n,i=e&&e.type;if(i==="FeatureCollection")for(n=0;n<e.features.length;n++)r(e.features[n],t);else if(i==="GeometryCollection")for(n=0;n<e.geometries.length;n++)r(e.geometries[n],t);else if(i==="Feature")r(e.geometry,t);else if(i==="Polygon")Xu(e.coordinates,t);else if(i==="MultiPolygon")for(n=0;n<e.coordinates.length;n++)Xu(e.coordinates[n],t);return e}));const kf=lt.VectorTileFeature.prototype.toGeoJSON;var rn={exports:{}},Af=yi,If=lt.VectorTileFeature,Mf=Yu;function Yu(r,e){this.options=e||{},this.features=r,this.length=r.length}function ci(r,e){this.id=typeof r.id=="number"?r.id:void 0,this.type=r.type,this.rawGeometry=r.type===1?[r.geometry]:r.geometry,this.properties=r.tags,this.extent=e||4096}Yu.prototype.feature=function(r){return new ci(this.features[r],this.options.extent)},ci.prototype.loadGeometry=function(){var r=this.rawGeometry;this.geometry=[];for(var e=0;e<r.length;e++){for(var t=r[e],n=[],i=0;i<t.length;i++)n.push(new Af(t[i][0],t[i][1]));this.geometry.push(n)}return this.geometry},ci.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var r=this.geometry,e=1/0,t=-1/0,n=1/0,i=-1/0,s=0;s<r.length;s++)for(var o=r[s],a=0;a<o.length;a++){var l=o[a];e=Math.min(e,l.x),t=Math.max(t,l.x),n=Math.min(n,l.y),i=Math.max(i,l.y)}return[e,n,t,i]},ci.prototype.toGeoJSON=If.prototype.toGeoJSON;var zf=Hl,Ju=Mf;function ao(r){var e=new zf;return(function(t,n){for(var i in t.layers)n.writeMessage(3,Pf,t.layers[i])})(r,e),e.finish()}function Pf(r,e){var t;e.writeVarintField(15,r.version||1),e.writeStringField(1,r.name||""),e.writeVarintField(5,r.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(t=0;t<r.length;t++)n.feature=r.feature(t),e.writeMessage(2,Cf,n);var i=n.keys;for(t=0;t<i.length;t++)e.writeStringField(3,i[t]);var s=n.values;for(t=0;t<s.length;t++)e.writeMessage(4,Tf,s[t])}function Cf(r,e){var t=r.feature;t.id!==void 0&&e.writeVarintField(1,t.id),e.writeMessage(2,Bf,r),e.writeVarintField(3,t.type),e.writeMessage(4,Vf,t)}function Bf(r,e){var t=r.feature,n=r.keys,i=r.values,s=r.keycache,o=r.valuecache;for(var a in t.properties){var l=t.properties[a],u=s[a];if(l!==null){u===void 0&&(n.push(a),s[a]=u=n.length-1),e.writeVarint(u);var c=typeof l;c!=="string"&&c!=="boolean"&&c!=="number"&&(l=JSON.stringify(l));var h=c+":"+l,p=o[h];p===void 0&&(i.push(l),o[h]=p=i.length-1),e.writeVarint(p)}}}function lo(r,e){return(e<<3)+(7&r)}function Ku(r){return r<<1^r>>31}function Vf(r,e){for(var t=r.loadGeometry(),n=r.type,i=0,s=0,o=t.length,a=0;a<o;a++){var l=t[a],u=1;n===1&&(u=l.length),e.writeVarint(lo(1,u));for(var c=n===3?l.length-1:l.length,h=0;h<c;h++){h===1&&n!==1&&e.writeVarint(lo(2,c-1));var p=l[h].x-i,f=l[h].y-s;e.writeVarint(Ku(p)),e.writeVarint(Ku(f)),i+=p,s+=f}n===3&&e.writeVarint(lo(7,1))}}function Tf(r,e){var t=typeof r;t==="string"?e.writeStringField(1,r):t==="boolean"?e.writeBooleanField(7,r):t==="number"&&(r%1!=0?e.writeDoubleField(3,r):r<0?e.writeSVarintField(6,r):e.writeVarintField(5,r))}rn.exports=ao,rn.exports.fromVectorTileJs=ao,rn.exports.fromGeojsonVt=function(r,e){e=e||{};var t={};for(var n in r)t[n]=new Ju(r[n].features,e),t[n].name=n,t[n].version=e.version,t[n].extent=e.extent;return ao({layers:t})},rn.exports.GeoJSONWrapper=Ju;var Ef=qt(rn.exports);const Wu=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class uo{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,n]=new Uint8Array(e,0,2);if(t!==219)throw new Error("Data does not appear to be in a KDBush format.");const i=n>>4;if(i!==1)throw new Error(`Got v${i} data when expected v1.`);const s=Wu[15&n];if(!s)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new uo(a,o,s,e)}constructor(e,t=64,n=Float64Array,i){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const s=Wu.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,l=(8-a%8)%8;if(s<0)throw new Error(`Unexpected typed array class: ${n}.`);i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+l,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+a+l),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+l,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+s]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return co(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:s,coords:o,nodeSize:a}=this,l=[0,s.length-1,0],u=[];for(;l.length;){const c=l.pop()||0,h=l.pop()||0,p=l.pop()||0;if(h-p<=a){for(let m=p;m<=h;m++){const g=o[2*m],x=o[2*m+1];g>=e&&g<=n&&x>=t&&x<=i&&u.push(s[m])}continue}const f=p+h>>1,d=o[2*f],y=o[2*f+1];d>=e&&d<=n&&y>=t&&y<=i&&u.push(s[f]),(c===0?e<=d:t<=y)&&(l.push(p),l.push(f-1),l.push(1-c)),(c===0?n>=d:i>=y)&&(l.push(f+1),l.push(h),l.push(1-c))}return u}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:s,nodeSize:o}=this,a=[0,i.length-1,0],l=[],u=n*n;for(;a.length;){const c=a.pop()||0,h=a.pop()||0,p=a.pop()||0;if(h-p<=o){for(let m=p;m<=h;m++)ec(s[2*m],s[2*m+1],e,t)<=u&&l.push(i[m]);continue}const f=p+h>>1,d=s[2*f],y=s[2*f+1];ec(d,y,e,t)<=u&&l.push(i[f]),(c===0?e-n<=d:t-n<=y)&&(a.push(p),a.push(f-1),a.push(1-c)),(c===0?e+n>=d:t+n>=y)&&(a.push(f+1),a.push(h),a.push(1-c))}return l}}function co(r,e,t,n,i,s){if(i-n<=t)return;const o=n+i>>1;Qu(r,e,o,n,i,s),co(r,e,t,n,o-1,1-s),co(r,e,t,o+1,i,1-s)}function Qu(r,e,t,n,i,s){for(;i>n;){if(i-n>600){const u=i-n+1,c=t-n+1,h=Math.log(u),p=.5*Math.exp(2*h/3),f=.5*Math.sqrt(h*p*(u-p)/u)*(c-u/2<0?-1:1);Qu(r,e,t,Math.max(n,Math.floor(t-c*p/u+f)),Math.min(i,Math.floor(t+(u-c)*p/u+f)),s)}const o=e[2*t+s];let a=n,l=i;for(nn(r,e,n,t),e[2*i+s]>o&&nn(r,e,n,i);a<l;){for(nn(r,e,a,l),a++,l--;e[2*a+s]<o;)a++;for(;e[2*l+s]>o;)l--}e[2*n+s]===o?nn(r,e,n,l):(l++,nn(r,e,l,i)),l<=t&&(n=l+1),t<=l&&(i=l-1)}}function nn(r,e,t,n){ho(r,t,n),ho(e,2*t,2*n),ho(e,2*t+1,2*n+1)}function ho(r,e,t){const n=r[e];r[e]=r[t],r[t]=n}function ec(r,e,t,n){const i=r-t,s=e-n;return i*i+s*s}const Ff={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:r=>r},tc=Math.fround||(po=new Float32Array(1),r=>(po[0]=+r,po[0]));var po;const It=3,Mt=5,rc=6;class Df{constructor(e){this.options=Object.assign(Object.create(Ff),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:n,maxZoom:i}=this.options;t&&console.time("total time");const s=`prepare ${e.length} points`;t&&console.time(s),this.points=e;const o=[];for(let l=0;l<e.length;l++){const u=e[l];if(!u.geometry)continue;const[c,h]=u.geometry.coordinates,p=tc(hi(c)),f=tc(pi(h));o.push(p,f,1/0,l,-1,1),this.options.reduce&&o.push(0)}let a=this.trees[i+1]=this._createTree(o);t&&console.timeEnd(s);for(let l=i;l>=n;l--){const u=+Date.now();a=this.trees[l]=this._createTree(this._cluster(a,l)),t&&console.log("z%d: %d clusters in %dms",l,a.numItems,+Date.now()-u)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let s=e[2]===180?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,s=180;else if(n>s){const h=this.getClusters([n,i,180,o],t),p=this.getClusters([-180,i,s,o],t);return h.concat(p)}const a=this.trees[this._limitZoom(t)],l=a.range(hi(n),pi(o),hi(s),pi(i)),u=a.data,c=[];for(const h of l){const p=this.stride*h;c.push(u[p+Mt]>1?nc(u,p,this.clusterProps):this.points[u[p+It]])}return c}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",s=this.trees[n];if(!s)throw new Error(i);const o=s.data;if(t*this.stride>=o.length)throw new Error(i);const a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),l=s.within(o[t*this.stride],o[t*this.stride+1],a),u=[];for(const c of l){const h=c*this.stride;o[h+4]===e&&u.push(o[h+Mt]>1?nc(o,h,this.clusterProps):this.points[o[h+It]])}if(u.length===0)throw new Error(i);return u}getLeaves(e,t,n){const i=[];return this._appendLeaves(i,e,t=t||10,n=n||0,0),i}getTile(e,t,n){const i=this.trees[this._limitZoom(e)],s=Math.pow(2,e),{extent:o,radius:a}=this.options,l=a/o,u=(n-l)/s,c=(n+1+l)/s,h={features:[]};return this._addTileFeatures(i.range((t-l)/s,u,(t+1+l)/s,c),i.data,t,n,s,h),t===0&&this._addTileFeatures(i.range(1-l/s,u,1,c),i.data,s,n,s,h),t===s-1&&this._addTileFeatures(i.range(0,u,l/s,c),i.data,-1,n,s,h),h.features.length?h:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,n.length!==1)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,i,s){const o=this.getChildren(t);for(const a of o){const l=a.properties;if(l&&l.cluster?s+l.point_count<=i?s+=l.point_count:s=this._appendLeaves(e,l.cluster_id,n,i,s):s<i?s++:e.push(a),e.length===n)break}return s}_createTree(e){const t=new uo(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let n=0;n<e.length;n+=this.stride)t.add(e[n],e[n+1]);return t.finish(),t.data=e,t}_addTileFeatures(e,t,n,i,s,o){for(const a of e){const l=a*this.stride,u=t[l+Mt]>1;let c,h,p;if(u)c=ic(t,l,this.clusterProps),h=t[l],p=t[l+1];else{const y=this.points[t[l+It]];c=y.properties;const[m,g]=y.geometry.coordinates;h=hi(m),p=pi(g)}const f={type:1,geometry:[[Math.round(this.options.extent*(h*s-n)),Math.round(this.options.extent*(p*s-i))]],tags:c};let d;d=u||this.options.generateId?t[l+It]:this.points[t[l+It]].id,d!==void 0&&(f.id=d),o.features.push(f)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:n,extent:i,reduce:s,minPoints:o}=this.options,a=n/(i*Math.pow(2,t)),l=e.data,u=[],c=this.stride;for(let h=0;h<l.length;h+=c){if(l[h+2]<=t)continue;l[h+2]=t;const p=l[h],f=l[h+1],d=e.within(l[h],l[h+1],a),y=l[h+Mt];let m=y;for(const g of d){const x=g*c;l[x+2]>t&&(m+=l[x+Mt])}if(m>y&&m>=o){let g,x=p*y,v=f*y,w=-1;const b=((h/c|0)<<5)+(t+1)+this.points.length;for(const S of d){const A=S*c;if(l[A+2]<=t)continue;l[A+2]=t;const C=l[A+Mt];x+=l[A]*C,v+=l[A+1]*C,l[A+4]=b,s&&(g||(g=this._map(l,h,!0),w=this.clusterProps.length,this.clusterProps.push(g)),s(g,this._map(l,A)))}l[h+4]=b,u.push(x/m,v/m,1/0,b,-1,m),s&&u.push(w)}else{for(let g=0;g<c;g++)u.push(l[h+g]);if(m>1)for(const g of d){const x=g*c;if(!(l[x+2]<=t)){l[x+2]=t;for(let v=0;v<c;v++)u.push(l[x+v])}}}}return u}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+Mt]>1){const o=this.clusterProps[e[t+rc]];return n?Object.assign({},o):o}const i=this.points[e[t+It]].properties,s=this.options.map(i);return n&&s===i?Object.assign({},s):s}}function nc(r,e,t){return{type:"Feature",id:r[e+It],properties:ic(r,e,t),geometry:{type:"Point",coordinates:[(n=r[e],360*(n-.5)),$f(r[e+1])]}};var n}function ic(r,e,t){const n=r[e+Mt],i=n>=1e4?`${Math.round(n/1e3)}k`:n>=1e3?Math.round(n/100)/10+"k":n,s=r[e+rc],o=s===-1?{}:Object.assign({},t[s]);return Object.assign(o,{cluster:!0,cluster_id:r[e+It],point_count:n,point_count_abbreviated:i})}function hi(r){return r/360+.5}function pi(r){const e=Math.sin(r*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function $f(r){const e=(180-360*r)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function fo(r,e,t,n){let i=n;const s=e+(t-e>>1);let o,a=t-e;const l=r[e],u=r[e+1],c=r[t],h=r[t+1];for(let p=e+3;p<t;p+=3){const f=Lf(r[p],r[p+1],l,u,c,h);if(f>i)o=p,i=f;else if(f===i){const d=Math.abs(p-s);d<a&&(o=p,a=d)}}i>n&&(o-e>3&&fo(r,e,o,n),r[o+2]=i,t-o>3&&fo(r,o,t,n))}function Lf(r,e,t,n,i,s){let o=i-t,a=s-n;if(o!==0||a!==0){const l=((r-t)*o+(e-n)*a)/(o*o+a*a);l>1?(t=i,n=s):l>0&&(t+=o*l,n+=a*l)}return o=r-t,a=e-n,o*o+a*a}function sn(r,e,t,n){const i={id:r??null,type:e,geometry:t,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(e==="Point"||e==="MultiPoint"||e==="LineString")fi(i,t);else if(e==="Polygon")fi(i,t[0]);else if(e==="MultiLineString")for(const s of t)fi(i,s);else if(e==="MultiPolygon")for(const s of t)fi(i,s[0]);return i}function fi(r,e){for(let t=0;t<e.length;t+=3)r.minX=Math.min(r.minX,e[t]),r.minY=Math.min(r.minY,e[t+1]),r.maxX=Math.max(r.maxX,e[t]),r.maxY=Math.max(r.maxY,e[t+1])}function yo(r,e,t,n){if(!e.geometry)return;const i=e.geometry.coordinates;if(i&&i.length===0)return;const s=e.geometry.type,o=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2);let a=[],l=e.id;if(t.promoteId?l=e.properties[t.promoteId]:t.generateId&&(l=n||0),s==="Point")sc(i,a);else if(s==="MultiPoint")for(const u of i)sc(u,a);else if(s==="LineString")mo(i,a,o,!1);else if(s==="MultiLineString"){if(t.lineMetrics){for(const u of i)a=[],mo(u,a,o,!1),r.push(sn(l,"LineString",a,e.properties));return}go(i,a,o,!1)}else if(s==="Polygon")go(i,a,o,!0);else{if(s!=="MultiPolygon"){if(s==="GeometryCollection"){for(const u of e.geometry.geometries)yo(r,{id:l,geometry:u,properties:e.properties},t,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const u of i){const c=[];go(u,c,o,!0),a.push(c)}}r.push(sn(l,s,a,e.properties))}function sc(r,e){e.push(oc(r[0]),ac(r[1]),0)}function mo(r,e,t,n){let i,s,o=0;for(let l=0;l<r.length;l++){const u=oc(r[l][0]),c=ac(r[l][1]);e.push(u,c,0),l>0&&(o+=n?(i*c-u*s)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(c-s,2))),i=u,s=c}const a=e.length-3;e[2]=1,fo(e,0,a,t),e[a+2]=1,e.size=Math.abs(o),e.start=0,e.end=e.size}function go(r,e,t,n){for(let i=0;i<r.length;i++){const s=[];mo(r[i],s,t,n),e.push(s)}}function oc(r){return r/360+.5}function ac(r){const e=Math.sin(r*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function mt(r,e,t,n,i,s,o,a){if(n/=e,s>=(t/=e)&&o<n)return r;if(o<t||s>=n)return null;const l=[];for(const u of r){const c=u.geometry;let h=u.type;const p=i===0?u.minX:u.minY,f=i===0?u.maxX:u.maxY;if(p>=t&&f<n){l.push(u);continue}if(f<t||p>=n)continue;let d=[];if(h==="Point"||h==="MultiPoint")Of(c,d,t,n,i);else if(h==="LineString")lc(c,d,t,n,i,!1,a.lineMetrics);else if(h==="MultiLineString")xo(c,d,t,n,i,!1);else if(h==="Polygon")xo(c,d,t,n,i,!0);else if(h==="MultiPolygon")for(const y of c){const m=[];xo(y,m,t,n,i,!0),m.length&&d.push(m)}if(d.length){if(a.lineMetrics&&h==="LineString"){for(const y of d)l.push(sn(u.id,h,y,u.tags));continue}h!=="LineString"&&h!=="MultiLineString"||(d.length===1?(h="LineString",d=d[0]):h="MultiLineString"),h!=="Point"&&h!=="MultiPoint"||(h=d.length===3?"Point":"MultiPoint"),l.push(sn(u.id,h,d,u.tags))}}return l.length?l:null}function Of(r,e,t,n,i){for(let s=0;s<r.length;s+=3){const o=r[s+i];o>=t&&o<=n&&mr(e,r[s],r[s+1],r[s+2])}}function lc(r,e,t,n,i,s,o){let a=uc(r);const l=i===0?jf:Rf;let u,c,h=r.start;for(let m=0;m<r.length-3;m+=3){const g=r[m],x=r[m+1],v=r[m+2],w=r[m+3],b=r[m+4],S=i===0?g:x,A=i===0?w:b;let C=!1;o&&(u=Math.sqrt(Math.pow(g-w,2)+Math.pow(x-b,2))),S<t?A>t&&(c=l(a,g,x,w,b,t),o&&(a.start=h+u*c)):S>n?A<n&&(c=l(a,g,x,w,b,n),o&&(a.start=h+u*c)):mr(a,g,x,v),A<t&&S>=t&&(c=l(a,g,x,w,b,t),C=!0),A>n&&S<=n&&(c=l(a,g,x,w,b,n),C=!0),!s&&C&&(o&&(a.end=h+u*c),e.push(a),a=uc(r)),o&&(h+=u)}let p=r.length-3;const f=r[p],d=r[p+1],y=i===0?f:d;y>=t&&y<=n&&mr(a,f,d,r[p+2]),p=a.length-3,s&&p>=3&&(a[p]!==a[0]||a[p+1]!==a[1])&&mr(a,a[0],a[1],a[2]),a.length&&e.push(a)}function uc(r){const e=[];return e.size=r.size,e.start=r.start,e.end=r.end,e}function xo(r,e,t,n,i,s){for(const o of r)lc(o,e,t,n,i,s,!1)}function mr(r,e,t,n){r.push(e,t,n)}function jf(r,e,t,n,i,s){const o=(s-e)/(n-e);return mr(r,s,t+(i-t)*o,1),o}function Rf(r,e,t,n,i,s){const o=(s-t)/(i-t);return mr(r,e+(n-e)*o,s,1),o}function cc(r,e){const t=[];for(let n=0;n<r.length;n++){const i=r[n],s=i.type;let o;if(s==="Point"||s==="MultiPoint"||s==="LineString")o=vo(i.geometry,e);else if(s==="MultiLineString"||s==="Polygon"){o=[];for(const a of i.geometry)o.push(vo(a,e))}else if(s==="MultiPolygon"){o=[];for(const a of i.geometry){const l=[];for(const u of a)l.push(vo(u,e));o.push(l)}}t.push(sn(i.id,s,o,i.tags))}return t}function vo(r,e){const t=[];t.size=r.size,r.start!==void 0&&(t.start=r.start,t.end=r.end);for(let n=0;n<r.length;n+=3)t.push(r[n]+e,r[n+1],r[n+2]);return t}function hc(r,e){if(r.transformed)return r;const t=1<<r.z,n=r.x,i=r.y;for(const s of r.features){const o=s.geometry,a=s.type;if(s.geometry=[],a===1)for(let l=0;l<o.length;l+=2)s.geometry.push(pc(o[l],o[l+1],e,t,n,i));else for(let l=0;l<o.length;l++){const u=[];for(let c=0;c<o[l].length;c+=2)u.push(pc(o[l][c],o[l][c+1],e,t,n,i));s.geometry.push(u)}}return r.transformed=!0,r}function pc(r,e,t,n,i,s){return[Math.round(t*(r*n-i)),Math.round(t*(e*n-s))]}function Nf(r,e,t,n,i){const s=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:r.length,source:null,x:t,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const a of r)Uf(o,a,s,i);return o}function Uf(r,e,t,n){const i=e.geometry,s=e.type,o=[];if(r.minX=Math.min(r.minX,e.minX),r.minY=Math.min(r.minY,e.minY),r.maxX=Math.max(r.maxX,e.maxX),r.maxY=Math.max(r.maxY,e.maxY),s==="Point"||s==="MultiPoint")for(let a=0;a<i.length;a+=3)o.push(i[a],i[a+1]),r.numPoints++,r.numSimplified++;else if(s==="LineString")bo(o,i,r,t,!1,!1);else if(s==="MultiLineString"||s==="Polygon")for(let a=0;a<i.length;a++)bo(o,i[a],r,t,s==="Polygon",a===0);else if(s==="MultiPolygon")for(let a=0;a<i.length;a++){const l=i[a];for(let u=0;u<l.length;u++)bo(o,l[u],r,t,!0,u===0)}if(o.length){let a=e.tags||null;if(s==="LineString"&&n.lineMetrics){a={};for(const u in e.tags)a[u]=e.tags[u];a.mapbox_clip_start=i.start/i.size,a.mapbox_clip_end=i.end/i.size}const l={geometry:o,type:s==="Polygon"||s==="MultiPolygon"?3:s==="LineString"||s==="MultiLineString"?2:1,tags:a};e.id!==null&&(l.id=e.id),r.features.push(l)}}function bo(r,e,t,n,i,s){const o=n*n;if(n>0&&e.size<(i?o:n))return void(t.numPoints+=e.length/3);const a=[];for(let l=0;l<e.length;l+=3)(n===0||e[l+2]>o)&&(t.numSimplified++,a.push(e[l],e[l+1])),t.numPoints++;i&&(function(l,u){let c=0;for(let h=0,p=l.length,f=p-2;h<p;f=h,h+=2)c+=(l[h]-l[f])*(l[h+1]+l[f+1]);if(c>0===u)for(let h=0,p=l.length;h<p/2;h+=2){const f=l[h],d=l[h+1];l[h]=l[p-2-h],l[h+1]=l[p-1-h],l[p-2-h]=f,l[p-1-h]=d}})(a,s),r.push(a)}const qf={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Zf{constructor(e,t){const n=(t=this.options=(function(s,o){for(const a in o)s[a]=o[a];return s})(Object.create(qf),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");let i=(function(s,o){const a=[];if(s.type==="FeatureCollection")for(let l=0;l<s.features.length;l++)yo(a,s.features[l],o,l);else yo(a,s.type==="Feature"?s:{geometry:s},o);return a})(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=(function(s,o){const a=o.buffer/o.extent;let l=s;const u=mt(s,1,-1-a,a,0,-1,2,o),c=mt(s,1,1-a,2+a,0,-1,2,o);return(u||c)&&(l=mt(s,1,-a,1+a,0,-1,2,o)||[],u&&(l=cc(u,1).concat(l)),c&&(l=l.concat(cc(c,-1)))),l})(i,t),i.length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,t,n,i,s,o,a){const l=[e,t,n,i],u=this.options,c=u.debug;for(;l.length;){i=l.pop(),n=l.pop(),t=l.pop(),e=l.pop();const h=1<<t,p=wo(t,n,i);let f=this.tiles[p];if(!f&&(c>1&&console.time("creation"),f=this.tiles[p]=Nf(e,t,n,i,u),this.tileCoords.push({z:t,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,i,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));const C=`z${t}`;this.stats[C]=(this.stats[C]||0)+1,this.total++}if(f.source=e,s==null){if(t===u.indexMaxZoom||f.numPoints<=u.indexMaxPoints)continue}else{if(t===u.maxZoom||t===s)continue;if(s!=null){const C=s-t;if(n!==o>>C||i!==a>>C)continue}}if(f.source=null,e.length===0)continue;c>1&&console.time("clipping");const d=.5*u.buffer/u.extent,y=.5-d,m=.5+d,g=1+d;let x=null,v=null,w=null,b=null,S=mt(e,h,n-d,n+m,0,f.minX,f.maxX,u),A=mt(e,h,n+y,n+g,0,f.minX,f.maxX,u);e=null,S&&(x=mt(S,h,i-d,i+m,1,f.minY,f.maxY,u),v=mt(S,h,i+y,i+g,1,f.minY,f.maxY,u),S=null),A&&(w=mt(A,h,i-d,i+m,1,f.minY,f.maxY,u),b=mt(A,h,i+y,i+g,1,f.minY,f.maxY,u),A=null),c>1&&console.timeEnd("clipping"),l.push(x||[],t+1,2*n,2*i),l.push(v||[],t+1,2*n,2*i+1),l.push(w||[],t+1,2*n+1,2*i),l.push(b||[],t+1,2*n+1,2*i+1)}}getTile(e,t,n){e=+e,t=+t,n=+n;const i=this.options,{extent:s,debug:o}=i;if(e<0||e>24)return null;const a=1<<e,l=wo(e,t=t+a&a-1,n);if(this.tiles[l])return hc(this.tiles[l],s);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);let u,c=e,h=t,p=n;for(;!u&&c>0;)c--,h>>=1,p>>=1,u=this.tiles[wo(c,h,p)];return u&&u.source?(o>1&&(console.log("found parent tile z%d-%d-%d",c,h,p),console.time("drilling down")),this.splitTile(u.source,c,h,p,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[l]?hc(this.tiles[l],s):null):null}}function wo(r,e,t){return 32*((1<<r)*t+e)+r}function on(r,e){return e?r.properties[e]:r.id}function fc(r,e){if(r==null)return!0;if(r.type==="Feature")return on(r,e)!=null;if(r.type==="FeatureCollection"){const t=new Set;for(const n of r.features){const i=on(n,e);if(i==null||t.has(i))return!1;t.add(i)}return!0}return!1}function dc(r,e){const t=new Map;if(r!=null)if(r.type==="Feature")t.set(on(r,e),r);else for(const n of r.features)t.set(on(n,e),n);return t}class Gf extends Zu{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(e,t){return W(this,void 0,void 0,(function*(){const n=e.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return null;const s=new class{constructor(a){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=ue,this.length=a.length,this._features=a}feature(a){return new class{constructor(l){this._feature=l,this.extent=ue,this.type=l.type,this.properties=l.tags,"id"in l&&!isNaN(l.id)&&(this.id=parseInt(l.id,10))}loadGeometry(){if(this._feature.type===1){const l=[];for(const u of this._feature.geometry)l.push([new R(u[0],u[1])]);return l}{const l=[];for(const u of this._feature.geometry){const c=[];for(const h of u)c.push(new R(h[0],h[1]));l.push(c)}return l}}toGeoJSON(l,u,c){return kf.call(this,l,u,c)}}(this._features[a])}}(i.features);let o=Ef(s);return o.byteOffset===0&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),{vectorTile:s,rawData:o.buffer}}))}loadData(e){return W(this,void 0,void 0,(function*(){var t;(t=this._pendingRequest)===null||t===void 0||t.abort();const n=!!(e&&e.request&&e.request.collectResourceTiming)&&new qu(e.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(e,this._pendingRequest),this._geoJSONIndex=e.cluster?new Df((function({superclusterOptions:o,clusterProperties:a}){if(!a||!o)return o;const l={},u={},c={accumulated:null,zoom:0},h={properties:null},p=Object.keys(a);for(const f of p){const[d,y]=a[f],m=rr(y),g=rr(typeof d=="string"?[d,["accumulated"],["get",f]]:d);l[f]=m.value,u[f]=g.value}return o.map=f=>{h.properties=f;const d={};for(const y of p)d[y]=l[y].evaluate(c,h);return d},o.reduce=(f,d)=>{h.properties=d;for(const y of p)c.accumulated=f[y],f[y]=u[y].evaluate(c,h)},o})(e)).load((yield this._pendingData).features):(i=yield this._pendingData,new Zf(i,e.geojsonVtOptions)),this.loaded={};const s={};if(n){const o=n.finish();o&&(s.resourceTiming={},s.resourceTiming[e.source]=JSON.parse(JSON.stringify(o)))}return s}catch(s){if(delete this._pendingRequest,(function(o){return o.message===Ca})(s))return{abandoned:!0};throw s}var i}))}getData(){return W(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(e){const t=this.loaded;return t&&t[e.uid]?super.reloadTile(e):this.loadTile(e)}loadAndProcessGeoJSON(e,t){return W(this,void 0,void 0,(function*(){let n=yield this.loadGeoJSON(e,t);if(delete this._pendingRequest,typeof n!="object")throw new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`);if(Sf(n,!0),e.filter){const i=rr(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(i.result==="error")throw new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));n={type:"FeatureCollection",features:n.features.filter((o=>i.value.evaluate({zoom:0},o)))}}return n}))}loadGeoJSON(e,t){return W(this,void 0,void 0,(function*(){const{promoteId:n}=e;if(e.request){const i=yield((s,o)=>Ea(et(s,{type:"json"}),o))(e.request,t);return this._dataUpdateable=fc(i.data,n)?dc(i.data,n):void 0,i.data}if(typeof e.data=="string")try{const i=JSON.parse(e.data);return this._dataUpdateable=fc(i,n)?dc(i,n):void 0,i}catch{throw new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`)}if(!e.dataDiff)throw new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${e.source}`);return(function(i,s,o){var a,l,u,c;if(s.removeAll&&i.clear(),s.remove)for(const h of s.remove)i.delete(h);if(s.add)for(const h of s.add){const p=on(h,o);p!=null&&i.set(p,h)}if(s.update)for(const h of s.update){let p=i.get(h.id);if(p==null)continue;const f=!h.removeAllProperties&&(((a=h.removeProperties)===null||a===void 0?void 0:a.length)>0||((l=h.addOrUpdateProperties)===null||l===void 0?void 0:l.length)>0);if((h.newGeometry||h.removeAllProperties||f)&&(p=Object.assign({},p),i.set(h.id,p),f&&(p.properties=Object.assign({},p.properties))),h.newGeometry&&(p.geometry=h.newGeometry),h.removeAllProperties)p.properties={};else if(((u=h.removeProperties)===null||u===void 0?void 0:u.length)>0)for(const d of h.removeProperties)Object.prototype.hasOwnProperty.call(p.properties,d)&&delete p.properties[d];if(((c=h.addOrUpdateProperties)===null||c===void 0?void 0:c.length)>0)for(const{key:d,value:y}of h.addOrUpdateProperties)p.properties[d]=y}})(this._dataUpdateable,e.dataDiff,n),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(e){return W(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(e){return this._geoJSONIndex.getClusterExpansionZoom(e.clusterId)}getClusterChildren(e){return this._geoJSONIndex.getChildren(e.clusterId)}getClusterLeaves(e){return this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset)}}class yc{constructor(e){this.self=e,this.actor=new hh(e),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(t,n)=>{if(this.externalWorkerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.externalWorkerSourceTypes[t]=n},this.self.addProtocol=lh,this.self.removeProtocol=uh,this.self.registerRTLTextPlugin=t=>{if(Ce.isParsed())throw new Error("RTL text plugin already registered.");Ce.setMethods(t)},this.actor.registerMessageHandler("LDT",((t,n)=>this._getDEMWorkerSource(t,n.source).loadTile(n))),this.actor.registerMessageHandler("RDT",((t,n)=>W(this,void 0,void 0,(function*(){this._getDEMWorkerSource(t,n.source).removeTile(n)})))),this.actor.registerMessageHandler("GCEZ",((t,n)=>W(this,void 0,void 0,(function*(){return this._getWorkerSource(t,n.type,n.source).getClusterExpansionZoom(n)})))),this.actor.registerMessageHandler("GCC",((t,n)=>W(this,void 0,void 0,(function*(){return this._getWorkerSource(t,n.type,n.source).getClusterChildren(n)})))),this.actor.registerMessageHandler("GCL",((t,n)=>W(this,void 0,void 0,(function*(){return this._getWorkerSource(t,n.type,n.source).getClusterLeaves(n)})))),this.actor.registerMessageHandler("LD",((t,n)=>this._getWorkerSource(t,n.type,n.source).loadData(n))),this.actor.registerMessageHandler("GD",((t,n)=>this._getWorkerSource(t,n.type,n.source).getData())),this.actor.registerMessageHandler("LT",((t,n)=>this._getWorkerSource(t,n.type,n.source).loadTile(n))),this.actor.registerMessageHandler("RT",((t,n)=>this._getWorkerSource(t,n.type,n.source).reloadTile(n))),this.actor.registerMessageHandler("AT",((t,n)=>this._getWorkerSource(t,n.type,n.source).abortTile(n))),this.actor.registerMessageHandler("RMT",((t,n)=>this._getWorkerSource(t,n.type,n.source).removeTile(n))),this.actor.registerMessageHandler("RS",((t,n)=>W(this,void 0,void 0,(function*(){if(!this.workerSources[t]||!this.workerSources[t][n.type]||!this.workerSources[t][n.type][n.source])return;const i=this.workerSources[t][n.type][n.source];delete this.workerSources[t][n.type][n.source],i.removeSource!==void 0&&i.removeSource(n)})))),this.actor.registerMessageHandler("RM",(t=>W(this,void 0,void 0,(function*(){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t]})))),this.actor.registerMessageHandler("SR",((t,n)=>W(this,void 0,void 0,(function*(){this.referrer=n})))),this.actor.registerMessageHandler("SRPS",((t,n)=>this._syncRTLPluginState(t,n))),this.actor.registerMessageHandler("IS",((t,n)=>W(this,void 0,void 0,(function*(){this.self.importScripts(n)})))),this.actor.registerMessageHandler("SI",((t,n)=>this._setImages(t,n))),this.actor.registerMessageHandler("UL",((t,n)=>W(this,void 0,void 0,(function*(){this._getLayerIndex(t).update(n.layers,n.removedIds)})))),this.actor.registerMessageHandler("SL",((t,n)=>W(this,void 0,void 0,(function*(){this._getLayerIndex(t).replace(n)}))))}_setImages(e,t){return W(this,void 0,void 0,(function*(){this.availableImages[e]=t;for(const n in this.workerSources[e]){const i=this.workerSources[e][n];for(const s in i)i[s].availableImages=t}}))}_syncRTLPluginState(e,t){return W(this,void 0,void 0,(function*(){if(Ce.isParsed())return Ce.getState();if(t.pluginStatus!=="loading")return Ce.setState(t),t;const n=t.pluginURL;if(this.self.importScripts(n),Ce.isParsed()){const i={pluginStatus:"loaded",pluginURL:n};return Ce.setState(i),i}throw Ce.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}_getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}_getLayerIndex(e){let t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new uf),t}_getWorkerSource(e,t,n){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),!this.workerSources[e][t][n]){const i={sendAsync:(s,o)=>(s.targetMapId=e,this.actor.sendAsync(s,o))};switch(t){case"vector":this.workerSources[e][t][n]=new Zu(i,this._getLayerIndex(e),this._getAvailableImages(e));break;case"geojson":this.workerSources[e][t][n]=new Gf(i,this._getLayerIndex(e),this._getAvailableImages(e));break;default:this.workerSources[e][t][n]=new this.externalWorkerSourceTypes[t](i,this._getLayerIndex(e),this._getAvailableImages(e))}}return this.workerSources[e][t][n]}_getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new _f),this.demWorkerSources[e][t]}}return Gt(self)&&(self.worker=new yc(self)),yc})()),ko}_c()})();
